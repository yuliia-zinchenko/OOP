<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Read&amp;Watch: movie.views Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Read&amp;Watch
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('namespacemovie_1_1views.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">movie.views Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1ab29e835ab1ba12bb3bfec07645f2a1" id="r_a1ab29e835ab1ba12bb3bfec07645f2a1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1ab29e835ab1ba12bb3bfec07645f2a1">add_or_update_movie</a> (request)</td></tr>
<tr class="separator:a1ab29e835ab1ba12bb3bfec07645f2a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c45c1f0ecb93cf4d8f0450f677fdba9" id="r_a3c45c1f0ecb93cf4d8f0450f677fdba9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3c45c1f0ecb93cf4d8f0450f677fdba9">delete_movie</a> (request, movie_id)</td></tr>
<tr class="separator:a3c45c1f0ecb93cf4d8f0450f677fdba9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34827ae061a8bc02dc30f6ff079b86b9" id="r_a34827ae061a8bc02dc30f6ff079b86b9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a34827ae061a8bc02dc30f6ff079b86b9">movie_detail</a> (request, movie_id)</td></tr>
<tr class="separator:a34827ae061a8bc02dc30f6ff079b86b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e6acd351f9991e3143742198ed0a587" id="r_a8e6acd351f9991e3143742198ed0a587"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e6acd351f9991e3143742198ed0a587">movie_main</a> (request)</td></tr>
<tr class="separator:a8e6acd351f9991e3143742198ed0a587"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedbc1506c30f3bf17e340531ffd2d197" id="r_aedbc1506c30f3bf17e340531ffd2d197"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aedbc1506c30f3bf17e340531ffd2d197">movie_recommendations</a> (request)</td></tr>
<tr class="separator:aedbc1506c30f3bf17e340531ffd2d197"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85af96049b7424fc7654336406ebbd6c" id="r_a85af96049b7424fc7654336406ebbd6c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a85af96049b7424fc7654336406ebbd6c">movie_search</a> (request)</td></tr>
<tr class="separator:a85af96049b7424fc7654336406ebbd6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a1ab29e835ab1ba12bb3bfec07645f2a1" name="a1ab29e835ab1ba12bb3bfec07645f2a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ab29e835ab1ba12bb3bfec07645f2a1">&#9670;&#160;</a></span>add_or_update_movie()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">add_or_update_movie </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Adds or updates a movie for the user.

This view processes the incoming data for adding a new movie or updating an existing 
movie's status. It returns a JSON response indicating success or failure.

@param request The HTTP request object containing the movie data.
@return JSON response with a success or error message.
</pre> 
<p class="definition">Definition at line <a class="el" href="movie_2views_8py_source.html#l00098">98</a> of file <a class="el" href="movie_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   98</span><span class="keyword">def </span>add_or_update_movie(request):</div>
<div class="line"><span class="lineno">   99</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral">    @brief Adds or updates a movie for the user.</span></div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  102</span><span class="stringliteral">    This view processes the incoming data for adding a new movie or updating an existing </span></div>
<div class="line"><span class="lineno">  103</span><span class="stringliteral">    movie&#39;s status. It returns a JSON response indicating success or failure.</span></div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  105</span><span class="stringliteral">    @param request The HTTP request object containing the movie data.</span></div>
<div class="line"><span class="lineno">  106</span><span class="stringliteral">    @return JSON response with a success or error message.</span></div>
<div class="line"><span class="lineno">  107</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;POST&#39;</span>:</div>
<div class="line"><span class="lineno">  109</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  110</span> </div>
<div class="line"><span class="lineno">  111</span>            data = json.loads(request.body)</div>
<div class="line"><span class="lineno">  112</span>            user = request.user</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>            movie_id = data.get(<span class="stringliteral">&#39;movie_id&#39;</span>)</div>
<div class="line"><span class="lineno">  115</span>            title = data.get(<span class="stringliteral">&#39;title&#39;</span>)</div>
<div class="line"><span class="lineno">  116</span>            release_year = data.get(<span class="stringliteral">&#39;release_year&#39;</span>)</div>
<div class="line"><span class="lineno">  117</span>            description = data.get(<span class="stringliteral">&#39;description&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><span class="lineno">  118</span>            poster_url = data.get(<span class="stringliteral">&#39;poster_url&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><span class="lineno">  119</span>            status = data.get(<span class="stringliteral">&#39;status&#39;</span>) </div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> movie_id <span class="keywordflow">or</span> <span class="keywordflow">not</span> isinstance(movie_id, int):</div>
<div class="line"><span class="lineno">  122</span>                <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&quot;error&quot;</span>: <span class="stringliteral">&quot;Valid movie ID is required&quot;</span>}, status=400)</div>
<div class="line"><span class="lineno">  123</span>            movie, created = Movie.objects.get_or_create(</div>
<div class="line"><span class="lineno">  124</span>                user=user,</div>
<div class="line"><span class="lineno">  125</span>                movie_id=movie_id,</div>
<div class="line"><span class="lineno">  126</span>                defaults={</div>
<div class="line"><span class="lineno">  127</span>                    <span class="stringliteral">&#39;title&#39;</span>: title,</div>
<div class="line"><span class="lineno">  128</span>                    <span class="stringliteral">&#39;release_year&#39;</span>: release_year,</div>
<div class="line"><span class="lineno">  129</span>                    <span class="stringliteral">&#39;description&#39;</span>: description,</div>
<div class="line"><span class="lineno">  130</span>                    <span class="stringliteral">&#39;poster_url&#39;</span>: poster_url,</div>
<div class="line"><span class="lineno">  131</span>                    <span class="stringliteral">&#39;status&#39;</span>: status,</div>
<div class="line"><span class="lineno">  132</span>                }</div>
<div class="line"><span class="lineno">  133</span>            )</div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> created:</div>
<div class="line"><span class="lineno">  136</span>                <span class="comment"># Оновлюємо статус</span></div>
<div class="line"><span class="lineno">  137</span>                movie.status = status</div>
<div class="line"><span class="lineno">  138</span>                movie.save()</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>            <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;message&#39;</span>: <span class="stringliteral">&#39;Movie added or updated successfully&#39;</span>, <span class="stringliteral">&#39;status&#39;</span>: movie.status})</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>        <span class="keywordflow">except</span> json.JSONDecodeError:</div>
<div class="line"><span class="lineno">  143</span>            <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;error&#39;</span>: <span class="stringliteral">&#39;Invalid JSON data&#39;</span>}, status=400)</div>
<div class="line"><span class="lineno">  144</span>        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><span class="lineno">  145</span>            <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;error&#39;</span>: str(e)}, status=500)</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;error&#39;</span>: <span class="stringliteral">&#39;Invalid request&#39;</span>}, status=400)</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span><span class="preprocessor">@login_required</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3c45c1f0ecb93cf4d8f0450f677fdba9" name="a3c45c1f0ecb93cf4d8f0450f677fdba9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c45c1f0ecb93cf4d8f0450f677fdba9">&#9670;&#160;</a></span>delete_movie()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">delete_movie </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>movie_id</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Deletes a movie for the user.

This view deletes a movie from the user's list. It returns a JSON response 
indicating success or failure.

@param request The HTTP request object.
@param movie_id The ID of the movie to delete.
@return JSON response with a success or error message.
</pre> 
<p class="definition">Definition at line <a class="el" href="movie_2views_8py_source.html#l00190">190</a> of file <a class="el" href="movie_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  190</span><span class="keyword">def </span>delete_movie(request, movie_id):</div>
<div class="line"><span class="lineno">  191</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  192</span><span class="stringliteral">    @brief Deletes a movie for the user.</span></div>
<div class="line"><span class="lineno">  193</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  194</span><span class="stringliteral">    This view deletes a movie from the user&#39;s list. It returns a JSON response </span></div>
<div class="line"><span class="lineno">  195</span><span class="stringliteral">    indicating success or failure.</span></div>
<div class="line"><span class="lineno">  196</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  197</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  198</span><span class="stringliteral">    @param movie_id The ID of the movie to delete.</span></div>
<div class="line"><span class="lineno">  199</span><span class="stringliteral">    @return JSON response with a success or error message.</span></div>
<div class="line"><span class="lineno">  200</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  201</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;DELETE&#39;</span>:</div>
<div class="line"><span class="lineno">  202</span>        movie = get_object_or_404(Movie, user=request.user, movie_id=movie_id)</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>        movie.delete()</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>        <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;message&#39;</span>: <span class="stringliteral">&#39;Movie deleted successfully&#39;</span>}, status=200)</div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;error&#39;</span>: <span class="stringliteral">&#39;Invalid request&#39;</span>}, status=400)</div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span><span class="preprocessor">@login_required</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a34827ae061a8bc02dc30f6ff079b86b9" name="a34827ae061a8bc02dc30f6ff079b86b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34827ae061a8bc02dc30f6ff079b86b9">&#9670;&#160;</a></span>movie_detail()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">movie_detail </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>movie_id</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Displays the details of a specific movie.

This view either retrieves movie details from the database if the user has added 
it or fetches data from an external API. It also adds the movie to the user's recently viewed list.

@param request The HTTP request object.
@param movie_id The ID of the movie.
@return Renders the movie detail page with the movie data.
</pre> 
<p class="definition">Definition at line <a class="el" href="movie_2views_8py_source.html#l00054">54</a> of file <a class="el" href="movie_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   54</span><span class="keyword">def </span>movie_detail(request, movie_id):</div>
<div class="line"><span class="lineno">   55</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   56</span><span class="stringliteral">    @brief Displays the details of a specific movie.</span></div>
<div class="line"><span class="lineno">   57</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   58</span><span class="stringliteral">    This view either retrieves movie details from the database if the user has added </span></div>
<div class="line"><span class="lineno">   59</span><span class="stringliteral">    it or fetches data from an external API. It also adds the movie to the user&#39;s recently viewed list.</span></div>
<div class="line"><span class="lineno">   60</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   61</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">   62</span><span class="stringliteral">    @param movie_id The ID of the movie.</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">    @return Renders the movie detail page with the movie data.</span></div>
<div class="line"><span class="lineno">   64</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   65</span>    user = request.user</div>
<div class="line"><span class="lineno">   66</span>    movie = Movie.objects.filter(user=request.user, movie_id=movie_id).first()</div>
<div class="line"><span class="lineno">   67</span> </div>
<div class="line"><span class="lineno">   68</span>    <span class="keywordflow">if</span> movie:</div>
<div class="line"><span class="lineno">   69</span>        movie_data = {</div>
<div class="line"><span class="lineno">   70</span>            <span class="stringliteral">&#39;id&#39;</span>: movie.movie_id,</div>
<div class="line"><span class="lineno">   71</span>            <span class="stringliteral">&#39;title&#39;</span>: movie.title,</div>
<div class="line"><span class="lineno">   72</span>            <span class="stringliteral">&#39;release_date&#39;</span>: movie.release_year,</div>
<div class="line"><span class="lineno">   73</span>            <span class="stringliteral">&#39;overview&#39;</span>: movie.description,</div>
<div class="line"><span class="lineno">   74</span>            <span class="stringliteral">&#39;poster_path&#39;</span>: movie.poster_url,</div>
<div class="line"><span class="lineno">   75</span>        }</div>
<div class="line"><span class="lineno">   76</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>        api_data = get_movie_from_api(movie_id)</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>        <span class="keywordflow">if</span> api_data <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">   81</span>            <span class="keywordflow">raise</span> Http404(<span class="stringliteral">&quot;Фільм не знайдено або недоступний&quot;</span>)</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>        movie_data = {</div>
<div class="line"><span class="lineno">   84</span>            <span class="stringliteral">&#39;id&#39;</span>: api_data.get(<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;Немає ID&#39;</span>),</div>
<div class="line"><span class="lineno">   85</span>            <span class="stringliteral">&#39;title&#39;</span>: api_data.get(<span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;Немає назви&#39;</span>),</div>
<div class="line"><span class="lineno">   86</span>            <span class="stringliteral">&#39;release_date&#39;</span>: api_data.get(<span class="stringliteral">&#39;release_date&#39;</span>, <span class="stringliteral">&#39;Невідомо&#39;</span>),</div>
<div class="line"><span class="lineno">   87</span>            <span class="stringliteral">&#39;overview&#39;</span>: api_data.get(<span class="stringliteral">&#39;overview&#39;</span>, <span class="stringliteral">&#39;Опис недоступний&#39;</span>),</div>
<div class="line"><span class="lineno">   88</span>            <span class="stringliteral">&#39;poster_path&#39;</span>: f<span class="stringliteral">&quot;https://image.tmdb.org/t/p/w500{api_data.get(&#39;poster_path&#39;)}&quot;</span> <span class="keywordflow">if</span> api_data.get(<span class="stringliteral">&#39;poster_path&#39;</span>) <span class="keywordflow">else</span> <span class="keywordtype">None</span>,</div>
<div class="line"><span class="lineno">   89</span>        }</div>
<div class="line"><span class="lineno">   90</span>        cover_image_url = f<span class="stringliteral">&quot;https://image.tmdb.org/t/p/w500{api_data.get(&#39;poster_path&#39;)}&quot;</span> <span class="keywordflow">if</span> api_data.get(<span class="stringliteral">&#39;poster_path&#39;</span>) <span class="keywordflow">else</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   91</span>        add_to_recently_viewed(user, <span class="stringliteral">&#39;movie&#39;</span>, movie_data[<span class="stringliteral">&#39;id&#39;</span>], movie_data[<span class="stringliteral">&#39;title&#39;</span>], cover_image_url)</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;movie/movie_detail.html&#39;</span>, {<span class="stringliteral">&#39;movie&#39;</span>: movie_data})</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span><span class="preprocessor">@login_required</span></div>
<div class="line"><span class="lineno">   97</span><span class="preprocessor">@csrf_exempt</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e6acd351f9991e3143742198ed0a587" name="a8e6acd351f9991e3143742198ed0a587"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e6acd351f9991e3143742198ed0a587">&#9670;&#160;</a></span>movie_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">movie_main </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Displays the main movie page with a list of user's movies.

This view renders a list of movies that the user has added, with the option to 
filter by status and sort by title or date. It also includes a random quote for the day.

@param request The HTTP request object.
@return Renders the main page with the user's movies, sorted and filtered.
</pre> 
<p class="definition">Definition at line <a class="el" href="movie_2views_8py_source.html#l00151">151</a> of file <a class="el" href="movie_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  151</span><span class="keyword">def </span>movie_main(request):</div>
<div class="line"><span class="lineno">  152</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  153</span><span class="stringliteral">    @brief Displays the main movie page with a list of user&#39;s movies.</span></div>
<div class="line"><span class="lineno">  154</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  155</span><span class="stringliteral">    This view renders a list of movies that the user has added, with the option to </span></div>
<div class="line"><span class="lineno">  156</span><span class="stringliteral">    filter by status and sort by title or date. It also includes a random quote for the day.</span></div>
<div class="line"><span class="lineno">  157</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  158</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  159</span><span class="stringliteral">    @return Renders the main page with the user&#39;s movies, sorted and filtered.</span></div>
<div class="line"><span class="lineno">  160</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  161</span>    user = request.user</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>    status = request.GET.get(<span class="stringliteral">&#39;status&#39;</span>)</div>
<div class="line"><span class="lineno">  164</span>    sort_by = request.GET.get(<span class="stringliteral">&#39;sort_by&#39;</span>, <span class="stringliteral">&#39;added_at&#39;</span>) </div>
<div class="line"><span class="lineno">  165</span>    total_quotes = Quote.objects.count()</div>
<div class="line"><span class="lineno">  166</span>    <span class="keywordflow">if</span> total_quotes &gt; 0:</div>
<div class="line"><span class="lineno">  167</span>        quote = Quote.objects.all()[date.today().day % total_quotes] </div>
<div class="line"><span class="lineno">  168</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  169</span>        quote = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  170</span> </div>
<div class="line"><span class="lineno">  171</span>    movies = Movie.objects.filter(user=user)</div>
<div class="line"><span class="lineno">  172</span>    <span class="keywordflow">if</span> status:</div>
<div class="line"><span class="lineno">  173</span>        movies = movies.filter(status=status)</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>    <span class="keywordflow">if</span> sort_by == <span class="stringliteral">&#39;title&#39;</span>:</div>
<div class="line"><span class="lineno">  177</span>        movies = movies.order_by(<span class="stringliteral">&#39;title&#39;</span>) </div>
<div class="line"><span class="lineno">  178</span>    <span class="keywordflow">elif</span> sort_by == <span class="stringliteral">&#39;date&#39;</span>:</div>
<div class="line"><span class="lineno">  179</span>        movies = movies.order_by(<span class="stringliteral">&#39;-last_updated&#39;</span>) </div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>    context = {</div>
<div class="line"><span class="lineno">  182</span>        <span class="stringliteral">&#39;movies&#39;</span>: movies,</div>
<div class="line"><span class="lineno">  183</span>        <span class="stringliteral">&#39;status&#39;</span>: status,</div>
<div class="line"><span class="lineno">  184</span>        <span class="stringliteral">&#39;sort_by&#39;</span>: sort_by, </div>
<div class="line"><span class="lineno">  185</span>        <span class="stringliteral">&#39;quote&#39;</span>: quote, </div>
<div class="line"><span class="lineno">  186</span>    }</div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;movie/movie_main.html&#39;</span>, context)</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aedbc1506c30f3bf17e340531ffd2d197" name="aedbc1506c30f3bf17e340531ffd2d197"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedbc1506c30f3bf17e340531ffd2d197">&#9670;&#160;</a></span>movie_recommendations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">movie_recommendations </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Displays movie recommendations based on genre and sorting options.

This view retrieves movies based on the selected genre and sort criteria, 
filtering out movies the user has already added to their list. The results are 
cached to improve performance.

@param request The HTTP request object containing the genre and sorting options.
@return Renders the recommendations page with a list of filtered movies.
</pre> 
<p class="definition">Definition at line <a class="el" href="movie_2views_8py_source.html#l00212">212</a> of file <a class="el" href="movie_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  212</span><span class="keyword">def </span>movie_recommendations(request):</div>
<div class="line"><span class="lineno">  213</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  214</span><span class="stringliteral">    @brief Displays movie recommendations based on genre and sorting options.</span></div>
<div class="line"><span class="lineno">  215</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  216</span><span class="stringliteral">    This view retrieves movies based on the selected genre and sort criteria, </span></div>
<div class="line"><span class="lineno">  217</span><span class="stringliteral">    filtering out movies the user has already added to their list. The results are </span></div>
<div class="line"><span class="lineno">  218</span><span class="stringliteral">    cached to improve performance.</span></div>
<div class="line"><span class="lineno">  219</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  220</span><span class="stringliteral">    @param request The HTTP request object containing the genre and sorting options.</span></div>
<div class="line"><span class="lineno">  221</span><span class="stringliteral">    @return Renders the recommendations page with a list of filtered movies.</span></div>
<div class="line"><span class="lineno">  222</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  223</span>    genre_id = request.GET.get(<span class="stringliteral">&#39;genre&#39;</span>, <span class="stringliteral">&#39;28&#39;</span>)  </div>
<div class="line"><span class="lineno">  224</span>    sort_by = request.GET.get(<span class="stringliteral">&#39;sort_by&#39;</span>, <span class="stringliteral">&#39;vote_average.desc&#39;</span>) </div>
<div class="line"><span class="lineno">  225</span>    page = int(request.GET.get(<span class="stringliteral">&#39;page&#39;</span>, 1))  </div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span>    <span class="keywordflow">if</span> page &lt; 1: </div>
<div class="line"><span class="lineno">  228</span>        page = 1</div>
<div class="line"><span class="lineno">  229</span>    cache_key = f<span class="stringliteral">&quot;movies_{genre_id}_{sort_by}_{page}&quot;</span></div>
<div class="line"><span class="lineno">  230</span> </div>
<div class="line"><span class="lineno">  231</span>    cached_movies = cache.get(cache_key)</div>
<div class="line"><span class="lineno">  232</span> </div>
<div class="line"><span class="lineno">  233</span>    <span class="keywordflow">if</span> cached_movies <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  234</span>        movies = cached_movies</div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  236</span> </div>
<div class="line"><span class="lineno">  237</span>        user_movie_ids = set(Movie.objects.filter(user=request.user).values_list(<span class="stringliteral">&#39;movie_id&#39;</span>, flat=<span class="keyword">True</span>))</div>
<div class="line"><span class="lineno">  238</span> </div>
<div class="line"><span class="lineno">  239</span>        movies = get_movies_by_genre(genre_id, sort_by=sort_by, page=page)</div>
<div class="line"><span class="lineno">  240</span> </div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>        movies = [movie <span class="keywordflow">for</span> movie <span class="keywordflow">in</span> movies <span class="keywordflow">if</span> movie[<span class="stringliteral">&#39;id&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> user_movie_ids]</div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">while</span> len(movies) &lt; 20:</div>
<div class="line"><span class="lineno">  244</span>            page += 1  </div>
<div class="line"><span class="lineno">  245</span>            more_movies = get_movies_by_genre(genre_id, sort_by=sort_by, page=page)</div>
<div class="line"><span class="lineno">  246</span>            </div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>            more_movies = [movie <span class="keywordflow">for</span> movie <span class="keywordflow">in</span> more_movies <span class="keywordflow">if</span> movie[<span class="stringliteral">&#39;id&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> user_movie_ids]</div>
<div class="line"><span class="lineno">  249</span>            </div>
<div class="line"><span class="lineno">  250</span> </div>
<div class="line"><span class="lineno">  251</span>            movies.extend(more_movies)</div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>        movies = movies[:20]</div>
<div class="line"><span class="lineno">  254</span>        cache.set(cache_key, movies, timeout=600)</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>    genre_choices = [</div>
<div class="line"><span class="lineno">  257</span>        {<span class="stringliteral">&#39;id&#39;</span>: <span class="stringliteral">&#39;28&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>: <span class="stringliteral">&#39;Action&#39;</span>},</div>
<div class="line"><span class="lineno">  258</span>        {<span class="stringliteral">&#39;id&#39;</span>: <span class="stringliteral">&#39;35&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>: <span class="stringliteral">&#39;Comedy&#39;</span>},</div>
<div class="line"><span class="lineno">  259</span>        {<span class="stringliteral">&#39;id&#39;</span>: <span class="stringliteral">&#39;18&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>: <span class="stringliteral">&#39;Drama&#39;</span>},</div>
<div class="line"><span class="lineno">  260</span>        {<span class="stringliteral">&#39;id&#39;</span>: <span class="stringliteral">&#39;27&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>: <span class="stringliteral">&#39;Horror&#39;</span>},</div>
<div class="line"><span class="lineno">  261</span>    ]</div>
<div class="line"><span class="lineno">  262</span> </div>
<div class="line"><span class="lineno">  263</span>    sort_choices = [</div>
<div class="line"><span class="lineno">  264</span>        {<span class="stringliteral">&#39;id&#39;</span>: <span class="stringliteral">&#39;vote_average.desc&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>: <span class="stringliteral">&#39;Top Rated&#39;</span>},</div>
<div class="line"><span class="lineno">  265</span>        {<span class="stringliteral">&#39;id&#39;</span>: <span class="stringliteral">&#39;release_date.desc&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>: <span class="stringliteral">&#39;Latest Releases&#39;</span>},</div>
<div class="line"><span class="lineno">  266</span>    ]</div>
<div class="line"><span class="lineno">  267</span> </div>
<div class="line"><span class="lineno">  268</span>    selected_genre = next((g[<span class="stringliteral">&#39;name&#39;</span>] <span class="keywordflow">for</span> g <span class="keywordflow">in</span> genre_choices <span class="keywordflow">if</span> g[<span class="stringliteral">&#39;id&#39;</span>] == genre_id), <span class="stringliteral">&quot;Unknown Genre&quot;</span>)</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;movie/movie_recommendations.html&#39;</span>, {</div>
<div class="line"><span class="lineno">  271</span>        <span class="stringliteral">&#39;movies&#39;</span>: movies,</div>
<div class="line"><span class="lineno">  272</span>        <span class="stringliteral">&#39;genre_choices&#39;</span>: genre_choices,</div>
<div class="line"><span class="lineno">  273</span>        <span class="stringliteral">&#39;sort_choices&#39;</span>: sort_choices,</div>
<div class="line"><span class="lineno">  274</span>        <span class="stringliteral">&#39;selected_genre&#39;</span>: selected_genre,</div>
<div class="line"><span class="lineno">  275</span>        <span class="stringliteral">&#39;current_genre&#39;</span>: genre_id,</div>
<div class="line"><span class="lineno">  276</span>        <span class="stringliteral">&#39;current_sort&#39;</span>: sort_by,</div>
<div class="line"><span class="lineno">  277</span>        <span class="stringliteral">&#39;page&#39;</span>: page, </div>
<div class="line"><span class="lineno">  278</span>    })</div>
<div class="line"><span class="lineno">  279</span> </div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a85af96049b7424fc7654336406ebbd6c" name="a85af96049b7424fc7654336406ebbd6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85af96049b7424fc7654336406ebbd6c">&#9670;&#160;</a></span>movie_search()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">movie_search </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Handles the movie search functionality.

This view allows users to search for movies based on a query. It retrieves results 
from an external API and displays them, along with the user's recently viewed movies.

@param request The HTTP request object.
@return Renders the movie search page with search results and recent movies.
</pre> 
<p class="definition">Definition at line <a class="el" href="movie_2views_8py_source.html#l00021">21</a> of file <a class="el" href="movie_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   21</span><span class="keyword">def </span>movie_search(request):</div>
<div class="line"><span class="lineno">   22</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   23</span><span class="stringliteral">    @brief Handles the movie search functionality.</span></div>
<div class="line"><span class="lineno">   24</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   25</span><span class="stringliteral">    This view allows users to search for movies based on a query. It retrieves results </span></div>
<div class="line"><span class="lineno">   26</span><span class="stringliteral">    from an external API and displays them, along with the user&#39;s recently viewed movies.</span></div>
<div class="line"><span class="lineno">   27</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   28</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">   29</span><span class="stringliteral">    @return Renders the movie search page with search results and recent movies.</span></div>
<div class="line"><span class="lineno">   30</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   31</span>    results = []</div>
<div class="line"><span class="lineno">   32</span>    recently_viewed_movies = RecentlyViewed.objects.filter(user=request.user, content_type=<span class="stringliteral">&#39;movie&#39;</span>).order_by(<span class="stringliteral">&#39;-viewed_at&#39;</span>)[:20]</div>
<div class="line"><span class="lineno">   33</span>    form_data = request.GET.get(<span class="stringliteral">&#39;query&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)  </div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span>    <span class="keywordflow">if</span> form_data:</div>
<div class="line"><span class="lineno">   36</span> </div>
<div class="line"><span class="lineno">   37</span>        load_dotenv()</div>
<div class="line"><span class="lineno">   38</span>        api_key = os.getenv(<span class="stringliteral">&#39;TMDB_API_KEY&#39;</span>)</div>
<div class="line"><span class="lineno">   39</span> </div>
<div class="line"><span class="lineno">   40</span>        url = f<span class="stringliteral">&quot;https://api.themoviedb.org/3/search/movie?query={form_data}&amp;api_key={api_key}&amp;language=en-US&quot;</span></div>
<div class="line"><span class="lineno">   41</span> </div>
<div class="line"><span class="lineno">   42</span> </div>
<div class="line"><span class="lineno">   43</span>        response = requests.get(url)</div>
<div class="line"><span class="lineno">   44</span>        <span class="keywordflow">if</span> response.status_code == 200:</div>
<div class="line"><span class="lineno">   45</span>            data = response.json()</div>
<div class="line"><span class="lineno">   46</span>            results = data.get(<span class="stringliteral">&#39;results&#39;</span>, [])</div>
<div class="line"><span class="lineno">   47</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   48</span>            print(<span class="stringliteral">&quot;API Error:&quot;</span>, response.status_code)</div>
<div class="line"><span class="lineno">   49</span> </div>
<div class="line"><span class="lineno">   50</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;movie/movie_search.html&#39;</span>, {<span class="stringliteral">&#39;results&#39;</span>: results, <span class="stringliteral">&#39;query&#39;</span>: form_data, <span class="stringliteral">&#39;recently_viewed_movies&#39;</span>: recently_viewed_movies})</div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span> </div>
<div class="line"><span class="lineno">   53</span><span class="preprocessor">@login_required</span></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemovie.html">movie</a></li><li class="navelem"><a class="el" href="namespacemovie_1_1views.html">views</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
