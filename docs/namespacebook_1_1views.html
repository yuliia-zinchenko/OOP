<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Read&amp;Watch: book.views Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Read&amp;Watch
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('namespacebook_1_1views.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">book.views Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a38048a85b1ccbd39d36a6f88f64df140" id="r_a38048a85b1ccbd39d36a6f88f64df140"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a38048a85b1ccbd39d36a6f88f64df140">add_to_list</a> (request)</td></tr>
<tr class="separator:a38048a85b1ccbd39d36a6f88f64df140"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dbb69bd669542c497eb8f2f6d75cc06" id="r_a5dbb69bd669542c497eb8f2f6d75cc06"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5dbb69bd669542c497eb8f2f6d75cc06">book_detail</a> (request, book_id)</td></tr>
<tr class="separator:a5dbb69bd669542c497eb8f2f6d75cc06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7a521a3a3c085d694fb5da3f22ee01f" id="r_ab7a521a3a3c085d694fb5da3f22ee01f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab7a521a3a3c085d694fb5da3f22ee01f">book_search</a> (request)</td></tr>
<tr class="separator:ab7a521a3a3c085d694fb5da3f22ee01f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa988d00e6c599743272a2589cb5704a8" id="r_aa988d00e6c599743272a2589cb5704a8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa988d00e6c599743272a2589cb5704a8">delete_book</a> (request, book_id)</td></tr>
<tr class="separator:aa988d00e6c599743272a2589cb5704a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf00a89f257c08161bfbbdedc7694a2e" id="r_aaf00a89f257c08161bfbbdedc7694a2e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaf00a89f257c08161bfbbdedc7694a2e">index</a> (request)</td></tr>
<tr class="separator:aaf00a89f257c08161bfbbdedc7694a2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03022a80c28fc2568d7fefb17053b6f4" id="r_a03022a80c28fc2568d7fefb17053b6f4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a03022a80c28fc2568d7fefb17053b6f4">manual_book_add</a> (request)</td></tr>
<tr class="separator:a03022a80c28fc2568d7fefb17053b6f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe7a73ec12d71d322770fa832afaf230" id="r_afe7a73ec12d71d322770fa832afaf230"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe7a73ec12d71d322770fa832afaf230">recommendations</a> (request)</td></tr>
<tr class="separator:afe7a73ec12d71d322770fa832afaf230"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a203c0b16b74b245c1b750f4bbc16f568" id="r_a203c0b16b74b245c1b750f4bbc16f568"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a203c0b16b74b245c1b750f4bbc16f568">update_status</a> (request, book_id)</td></tr>
<tr class="separator:a203c0b16b74b245c1b750f4bbc16f568"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a38048a85b1ccbd39d36a6f88f64df140" name="a38048a85b1ccbd39d36a6f88f64df140"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38048a85b1ccbd39d36a6f88f64df140">&#9670;&#160;</a></span>add_to_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">add_to_list </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Adds or updates a book in the user's library.

This view allows the user to add a book to their collection or update its status if it's already in the library.

@param request The HTTP request object.
@return A JSON response indicating the success or failure of the operation.
</pre> 
<p class="definition">Definition at line <a class="el" href="book_2views_8py_source.html#l00172">172</a> of file <a class="el" href="book_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  172</span><span class="keyword">def </span>add_to_list(request):</div>
<div class="line"><span class="lineno">  173</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  174</span><span class="stringliteral">    @brief Adds or updates a book in the user&#39;s library.</span></div>
<div class="line"><span class="lineno">  175</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  176</span><span class="stringliteral">    This view allows the user to add a book to their collection or update its status if it&#39;s already in the library.</span></div>
<div class="line"><span class="lineno">  177</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  178</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  179</span><span class="stringliteral">    @return A JSON response indicating the success or failure of the operation.</span></div>
<div class="line"><span class="lineno">  180</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  181</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&quot;POST&quot;</span> <span class="keywordflow">and</span> request.user.is_authenticated:</div>
<div class="line"><span class="lineno">  182</span>        data = json.loads(request.body)</div>
<div class="line"><span class="lineno">  183</span>        book_id = data.get(<span class="stringliteral">&#39;book_id&#39;</span>)</div>
<div class="line"><span class="lineno">  184</span>        title = data.get(<span class="stringliteral">&#39;title&#39;</span>)</div>
<div class="line"><span class="lineno">  185</span>        title = unescape(title)</div>
<div class="line"><span class="lineno">  186</span>        author = data.get(<span class="stringliteral">&#39;author&#39;</span>)</div>
<div class="line"><span class="lineno">  187</span>        status = data.get(<span class="stringliteral">&#39;status&#39;</span>)</div>
<div class="line"><span class="lineno">  188</span>        genre = data.get(<span class="stringliteral">&#39;genre&#39;</span>)</div>
<div class="line"><span class="lineno">  189</span>        cover_image_url = data.get(<span class="stringliteral">&#39;cover_image_url&#39;</span>, <span class="keywordtype">None</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;default_url&quot;</span></div>
<div class="line"><span class="lineno">  190</span>        cover_image_url = unescape(cover_image_url)</div>
<div class="line"><span class="lineno">  191</span>        description = data.get(<span class="stringliteral">&#39;description&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><span class="lineno">  192</span>        description = unescape(description)</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> book_id <span class="keywordflow">or</span> <span class="keywordflow">not</span> status:</div>
<div class="line"><span class="lineno">  195</span>            <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;error&#39;</span>: <span class="stringliteral">&#39;Invalid data&#39;</span>}, status=400)</div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>        <span class="keywordflow">if</span> book_id.isdigit() <span class="keywordflow">and</span> <span class="keywordflow">not</span> book_id.startswith(<span class="stringliteral">&#39;user-&#39;</span>):</div>
<div class="line"><span class="lineno">  198</span>            book_id = f<span class="stringliteral">&quot;user-{book_id}&quot;</span></div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  201</span>            book = UserBook.objects.get(user=request.user, book_id=book_id)</div>
<div class="line"><span class="lineno">  202</span>            book.status = status</div>
<div class="line"><span class="lineno">  203</span>            book.last_updated = now()</div>
<div class="line"><span class="lineno">  204</span>            book.description = description</div>
<div class="line"><span class="lineno">  205</span>            book.save()</div>
<div class="line"><span class="lineno">  206</span>            message = <span class="stringliteral">&#39;Book status updated successfully&#39;</span></div>
<div class="line"><span class="lineno">  207</span>        <span class="keywordflow">except</span> UserBook.DoesNotExist:</div>
<div class="line"><span class="lineno">  208</span>            book = UserBook.objects.create(</div>
<div class="line"><span class="lineno">  209</span>                user=request.user,</div>
<div class="line"><span class="lineno">  210</span>                book_id=book_id,</div>
<div class="line"><span class="lineno">  211</span>                title=title,</div>
<div class="line"><span class="lineno">  212</span>                author=author,</div>
<div class="line"><span class="lineno">  213</span>                status=status,</div>
<div class="line"><span class="lineno">  214</span>                genre=genre,</div>
<div class="line"><span class="lineno">  215</span>                cover_image_url=cover_image_url,</div>
<div class="line"><span class="lineno">  216</span>                description=description,  </div>
<div class="line"><span class="lineno">  217</span>                last_updated=now(),</div>
<div class="line"><span class="lineno">  218</span>            )</div>
<div class="line"><span class="lineno">  219</span>            message = <span class="stringliteral">&#39;Book added successfully&#39;</span></div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>        <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;message&#39;</span>: message, <span class="stringliteral">&#39;status&#39;</span>: status}, status=200)</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>    <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;error&#39;</span>: <span class="stringliteral">&#39;Unauthorized or invalid request&#39;</span>}, status=403)</div>
<div class="line"><span class="lineno">  224</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a5dbb69bd669542c497eb8f2f6d75cc06" name="a5dbb69bd669542c497eb8f2f6d75cc06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dbb69bd669542c497eb8f2f6d75cc06">&#9670;&#160;</a></span>book_detail()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">book_detail </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>book_id</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Displays the detailed page of a book.

This view fetches the details of a specific book, either from the user's collection or the Google Books API.

@param request The HTTP request object.
@param book_id The unique identifier for the book.
@return Renders the book detail page with detailed information about the book.
</pre> 
<p class="definition">Definition at line <a class="el" href="book_2views_8py_source.html#l00136">136</a> of file <a class="el" href="book_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  136</span><span class="keyword">def </span>book_detail(request, book_id):</div>
<div class="line"><span class="lineno">  137</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  138</span><span class="stringliteral">    @brief Displays the detailed page of a book.</span></div>
<div class="line"><span class="lineno">  139</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  140</span><span class="stringliteral">    This view fetches the details of a specific book, either from the user&#39;s collection or the Google Books API.</span></div>
<div class="line"><span class="lineno">  141</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  142</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  143</span><span class="stringliteral">    @param book_id The unique identifier for the book.</span></div>
<div class="line"><span class="lineno">  144</span><span class="stringliteral">    @return Renders the book detail page with detailed information about the book.</span></div>
<div class="line"><span class="lineno">  145</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  146</span>    user = request.user</div>
<div class="line"><span class="lineno">  147</span>    <span class="keywordflow">if</span> book_id.startswith(<span class="stringliteral">&quot;user-&quot;</span>):</div>
<div class="line"><span class="lineno">  148</span>        <span class="keywordflow">try</span>:    </div>
<div class="line"><span class="lineno">  149</span>            book = UserBook.objects.get(book_id=book_id)</div>
<div class="line"><span class="lineno">  150</span>        <span class="keywordflow">except</span> UserBook.DoesNotExist:</div>
<div class="line"><span class="lineno">  151</span>            <span class="keywordflow">raise</span> Http404(<span class="stringliteral">&quot;User book not found&quot;</span>)</div>
<div class="line"><span class="lineno">  152</span> </div>
<div class="line"><span class="lineno">  153</span>        <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;book/book_detail.html&#39;</span>, {<span class="stringliteral">&#39;book&#39;</span>: book})</div>
<div class="line"><span class="lineno">  154</span> </div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>    response = requests.get(f<span class="stringliteral">&quot;https://www.googleapis.com/books/v1/volumes/{book_id}&quot;</span>)</div>
<div class="line"><span class="lineno">  157</span>    <span class="keywordflow">if</span> response.status_code != 200:</div>
<div class="line"><span class="lineno">  158</span>        <span class="keywordflow">raise</span> Http404(<span class="stringliteral">&quot;Book not found&quot;</span>)</div>
<div class="line"><span class="lineno">  159</span> </div>
<div class="line"><span class="lineno">  160</span>    book_data = response.json()</div>
<div class="line"><span class="lineno">  161</span>    cover_image_url = book_data.get(<span class="stringliteral">&#39;volumeInfo&#39;</span>, {}).get(<span class="stringliteral">&#39;imageLinks&#39;</span>, {}).get(<span class="stringliteral">&#39;thumbnail&#39;</span>, <span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">  162</span>    title = book_data.get(<span class="stringliteral">&#39;volumeInfo&#39;</span>, {}).get(<span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;Unknown Title&#39;</span>)</div>
<div class="line"><span class="lineno">  163</span>    add_to_recently_viewed(user, <span class="stringliteral">&#39;book&#39;</span>, book_id, title, cover_image_url)</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;book/book_detail.html&#39;</span>, {<span class="stringliteral">&#39;book&#39;</span>: book_data})</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span> </div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span><span class="preprocessor">@login_required</span></div>
<div class="line"><span class="lineno">  171</span><span class="preprocessor">@csrf_exempt</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab7a521a3a3c085d694fb5da3f22ee01f" name="ab7a521a3a3c085d694fb5da3f22ee01f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7a521a3a3c085d694fb5da3f22ee01f">&#9670;&#160;</a></span>book_search()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">book_search </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Handles the book search functionality.

This view allows the user to search for books based on the selected search criteria (e.g., title, author).
It integrates with the Google Books API to fetch external book data based on the search query.

@param request The HTTP request object.
@return Renders the book search page with the search form and the search results.
</pre> 
<p class="definition">Definition at line <a class="el" href="book_2views_8py_source.html#l00095">95</a> of file <a class="el" href="book_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   95</span><span class="keyword">def </span>book_search(request):</div>
<div class="line"><span class="lineno">   96</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   97</span><span class="stringliteral">    @brief Handles the book search functionality.</span></div>
<div class="line"><span class="lineno">   98</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   99</span><span class="stringliteral">    This view allows the user to search for books based on the selected search criteria (e.g., title, author).</span></div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral">    It integrates with the Google Books API to fetch external book data based on the search query.</span></div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  102</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  103</span><span class="stringliteral">    @return Renders the book search page with the search form and the search results.</span></div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  105</span>    results = []</div>
<div class="line"><span class="lineno">  106</span>    recently_viewed_books = RecentlyViewed.objects.filter(user=request.user, content_type=<span class="stringliteral">&#39;book&#39;</span>).order_by(<span class="stringliteral">&#39;-viewed_at&#39;</span>)[:20]</div>
<div class="line"><span class="lineno">  107</span>    form = BookSearchForm(request.GET)</div>
<div class="line"><span class="lineno">  108</span>    </div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordflow">if</span> form.is_valid():</div>
<div class="line"><span class="lineno">  110</span>        query = form.cleaned_data[<span class="stringliteral">&#39;query&#39;</span>]</div>
<div class="line"><span class="lineno">  111</span>        search_by = form.cleaned_data[<span class="stringliteral">&#39;search_by&#39;</span>]</div>
<div class="line"><span class="lineno">  112</span>        load_dotenv()</div>
<div class="line"><span class="lineno">  113</span>        api_key = os.getenv(<span class="stringliteral">&#39;api_key&#39;</span>)</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>        url = f<span class="stringliteral">&#39;https://www.googleapis.com/books/v1/volumes&#39;</span></div>
<div class="line"><span class="lineno">  116</span>        params = {</div>
<div class="line"><span class="lineno">  117</span>            <span class="stringliteral">&#39;q&#39;</span>: f<span class="stringliteral">&#39;{search_by}:{query}&#39;</span>,</div>
<div class="line"><span class="lineno">  118</span>            <span class="stringliteral">&#39;langRestrict&#39;</span>: <span class="stringliteral">&#39;en&#39;</span>,</div>
<div class="line"><span class="lineno">  119</span>            <span class="stringliteral">&#39;key&#39;</span>: api_key,</div>
<div class="line"><span class="lineno">  120</span>            <span class="stringliteral">&#39;maxResults&#39;</span>: 40 </div>
<div class="line"><span class="lineno">  121</span>        }</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>        response = requests.get(url, params=params)</div>
<div class="line"><span class="lineno">  124</span>        </div>
<div class="line"><span class="lineno">  125</span>        <span class="keywordflow">if</span> response.status_code == 200:</div>
<div class="line"><span class="lineno">  126</span>            data = response.json()</div>
<div class="line"><span class="lineno">  127</span>            results = data.get(<span class="stringliteral">&#39;items&#39;</span>, [])</div>
<div class="line"><span class="lineno">  128</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  129</span>            print(<span class="stringliteral">&quot;Error:&quot;</span>, response.status_code)</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;book/book_search.html&#39;</span>, {<span class="stringliteral">&#39;form&#39;</span>: form, <span class="stringliteral">&#39;results&#39;</span>: results, <span class="stringliteral">&#39;recently_viewed_books&#39;</span>: recently_viewed_books})</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span><span class="preprocessor">@login_required</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aa988d00e6c599743272a2589cb5704a8" name="aa988d00e6c599743272a2589cb5704a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa988d00e6c599743272a2589cb5704a8">&#9670;&#160;</a></span>delete_book()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">delete_book </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>book_id</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Deletes a book from the user's collection.

This view removes a book from the user's library.

@param request The HTTP request object.
@param book_id The unique identifier for the book.
@return A JSON response indicating success or failure of the deletion.
</pre> 
<p class="definition">Definition at line <a class="el" href="book_2views_8py_source.html#l00256">256</a> of file <a class="el" href="book_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  256</span><span class="keyword">def </span>delete_book(request, book_id):</div>
<div class="line"><span class="lineno">  257</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  258</span><span class="stringliteral">    @brief Deletes a book from the user&#39;s collection.</span></div>
<div class="line"><span class="lineno">  259</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  260</span><span class="stringliteral">    This view removes a book from the user&#39;s library.</span></div>
<div class="line"><span class="lineno">  261</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  262</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  263</span><span class="stringliteral">    @param book_id The unique identifier for the book.</span></div>
<div class="line"><span class="lineno">  264</span><span class="stringliteral">    @return A JSON response indicating success or failure of the deletion.</span></div>
<div class="line"><span class="lineno">  265</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  266</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;DELETE&#39;</span>:</div>
<div class="line"><span class="lineno">  267</span>        book = get_object_or_404(UserBook, user=request.user, book_id=book_id)</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>        book.delete()</div>
<div class="line"><span class="lineno">  270</span> </div>
<div class="line"><span class="lineno">  271</span>        <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;message&#39;</span>: <span class="stringliteral">&#39;Book deleted successfully&#39;</span>}, status=200)</div>
<div class="line"><span class="lineno">  272</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  273</span>        <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&#39;error&#39;</span>: <span class="stringliteral">&#39;Invalid request&#39;</span>}, status=400)</div>
<div class="line"><span class="lineno">  274</span>    </div>
<div class="line"><span class="lineno">  275</span> </div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aaf00a89f257c08161bfbbdedc7694a2e" name="aaf00a89f257c08161bfbbdedc7694a2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf00a89f257c08161bfbbdedc7694a2e">&#9670;&#160;</a></span>index()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">index </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Handles the main page view for the user's library.

This view fetches the user's books, movies, and TV shows and allows for search and filtering based on status and title.
Additionally, it displays a random quote of the day if available.

@param request The HTTP request object.
@return Renders the main page template with the user's library data and filters applied.
</pre> 
<p class="definition">Definition at line <a class="el" href="book_2views_8py_source.html#l00027">27</a> of file <a class="el" href="book_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   27</span><span class="keyword">def </span>index(request):</div>
<div class="line"><span class="lineno">   28</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   29</span><span class="stringliteral">    @brief Handles the main page view for the user&#39;s library.</span></div>
<div class="line"><span class="lineno">   30</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   31</span><span class="stringliteral">    This view fetches the user&#39;s books, movies, and TV shows and allows for search and filtering based on status and title.</span></div>
<div class="line"><span class="lineno">   32</span><span class="stringliteral">    Additionally, it displays a random quote of the day if available.</span></div>
<div class="line"><span class="lineno">   33</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   34</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">   35</span><span class="stringliteral">    @return Renders the main page template with the user&#39;s library data and filters applied.</span></div>
<div class="line"><span class="lineno">   36</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   37</span>    user = request.user</div>
<div class="line"><span class="lineno">   38</span>    query = request.GET.get(<span class="stringliteral">&#39;q&#39;</span>, <span class="stringliteral">&#39;&#39;</span>).strip()  </div>
<div class="line"><span class="lineno">   39</span>    sort_by = request.GET.get(<span class="stringliteral">&#39;sort_by&#39;</span>, <span class="stringliteral">&#39;date&#39;</span>)  </div>
<div class="line"><span class="lineno">   40</span>    status = request.GET.get(<span class="stringliteral">&#39;status&#39;</span>) </div>
<div class="line"><span class="lineno">   41</span>    total_quotes = Quote.objects.count()</div>
<div class="line"><span class="lineno">   42</span>    <span class="keywordflow">if</span> total_quotes &gt; 0:</div>
<div class="line"><span class="lineno">   43</span>        quote = Quote.objects.all()[date.today().day % total_quotes] </div>
<div class="line"><span class="lineno">   44</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   45</span>        quote = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>    books = UserBook.objects.filter(user=user).exclude(title__isnull=<span class="keyword">True</span>).exclude(title__exact=<span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><span class="lineno">   48</span>    movies = Movie.objects.filter(user=user)</div>
<div class="line"><span class="lineno">   49</span>    tvshows = TVshow.objects.filter(user=user)</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>    <span class="keywordflow">if</span> query:</div>
<div class="line"><span class="lineno">   52</span>        books = books.filter(</div>
<div class="line"><span class="lineno">   53</span>            Q(title__icontains=query) | Q(author__icontains=query)</div>
<div class="line"><span class="lineno">   54</span>        )</div>
<div class="line"><span class="lineno">   55</span>        movies = movies.filter(</div>
<div class="line"><span class="lineno">   56</span>            Q(title__icontains=query) | Q(release_year__icontains=query)</div>
<div class="line"><span class="lineno">   57</span>        )</div>
<div class="line"><span class="lineno">   58</span>        tvshows = tvshows.filter(</div>
<div class="line"><span class="lineno">   59</span>            Q(title__icontains=query) | Q(first_air_date__icontains=query)</div>
<div class="line"><span class="lineno">   60</span>        )</div>
<div class="line"><span class="lineno">   61</span>        </div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>        results = sorted(</div>
<div class="line"><span class="lineno">   64</span>            list(chain(books, movies, tvshows)),</div>
<div class="line"><span class="lineno">   65</span>            key=<span class="keyword">lambda</span> x: x.title <span class="keywordflow">if</span> hasattr(x, <span class="stringliteral">&#39;title&#39;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><span class="lineno">   66</span>        )</div>
<div class="line"><span class="lineno">   67</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>        results = []</div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>    <span class="comment"># Сортування книг</span></div>
<div class="line"><span class="lineno">   72</span>    <span class="keywordflow">if</span> sort_by == <span class="stringliteral">&#39;title&#39;</span>:</div>
<div class="line"><span class="lineno">   73</span>        books = books.order_by(<span class="stringliteral">&#39;title&#39;</span>)</div>
<div class="line"><span class="lineno">   74</span>    <span class="keywordflow">elif</span> sort_by == <span class="stringliteral">&#39;author&#39;</span>:</div>
<div class="line"><span class="lineno">   75</span>        books = books.order_by(<span class="stringliteral">&#39;author&#39;</span>)</div>
<div class="line"><span class="lineno">   76</span>    <span class="keywordflow">elif</span> sort_by == <span class="stringliteral">&#39;date&#39;</span>:</div>
<div class="line"><span class="lineno">   77</span>        books = books.order_by(<span class="stringliteral">&#39;-last_updated&#39;</span>)</div>
<div class="line"><span class="lineno">   78</span> </div>
<div class="line"><span class="lineno">   79</span>    <span class="comment"># Фільтрація за статусом</span></div>
<div class="line"><span class="lineno">   80</span>    <span class="keywordflow">if</span> status:</div>
<div class="line"><span class="lineno">   81</span>        books = books.filter(status=status)</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;book/index.html&#39;</span>, {</div>
<div class="line"><span class="lineno">   84</span>        <span class="stringliteral">&#39;books&#39;</span>: books,  </div>
<div class="line"><span class="lineno">   85</span>        <span class="stringliteral">&#39;movies&#39;</span>: movies,  </div>
<div class="line"><span class="lineno">   86</span>        <span class="stringliteral">&#39;results&#39;</span>: results, </div>
<div class="line"><span class="lineno">   87</span>        <span class="stringliteral">&#39;sort_by&#39;</span>: sort_by,</div>
<div class="line"><span class="lineno">   88</span>        <span class="stringliteral">&#39;status&#39;</span>: status,</div>
<div class="line"><span class="lineno">   89</span>        <span class="stringliteral">&#39;query&#39;</span>: query,</div>
<div class="line"><span class="lineno">   90</span>        <span class="stringliteral">&#39;quote&#39;</span>: quote,</div>
<div class="line"><span class="lineno">   91</span>    })</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span><span class="preprocessor">@login_required</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a03022a80c28fc2568d7fefb17053b6f4" name="a03022a80c28fc2568d7fefb17053b6f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03022a80c28fc2568d7fefb17053b6f4">&#9670;&#160;</a></span>manual_book_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">manual_book_add </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Manually adds a book to the user's library.

This view allows the user to manually enter details for a book to add to their library.

@param request The HTTP request object.
@return Renders the book index page with the form or redirects after a successful add.
</pre> 
<p class="definition">Definition at line <a class="el" href="book_2views_8py_source.html#l00278">278</a> of file <a class="el" href="book_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  278</span><span class="keyword">def </span>manual_book_add(request):</div>
<div class="line"><span class="lineno">  279</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  280</span><span class="stringliteral">    @brief Manually adds a book to the user&#39;s library.</span></div>
<div class="line"><span class="lineno">  281</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  282</span><span class="stringliteral">    This view allows the user to manually enter details for a book to add to their library.</span></div>
<div class="line"><span class="lineno">  283</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  284</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  285</span><span class="stringliteral">    @return Renders the book index page with the form or redirects after a successful add.</span></div>
<div class="line"><span class="lineno">  286</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  287</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&quot;POST&quot;</span>:</div>
<div class="line"><span class="lineno">  288</span>        form = ManualBookForm(request.POST)</div>
<div class="line"><span class="lineno">  289</span>        <span class="keywordflow">if</span> form.is_valid():</div>
<div class="line"><span class="lineno">  290</span>            title = form.cleaned_data[<span class="stringliteral">&#39;title&#39;</span>]</div>
<div class="line"><span class="lineno">  291</span>            author = form.cleaned_data[<span class="stringliteral">&#39;author&#39;</span>]</div>
<div class="line"><span class="lineno">  292</span>            genre = form.cleaned_data[<span class="stringliteral">&#39;genre&#39;</span>]</div>
<div class="line"><span class="lineno">  293</span>            status = form.cleaned_data[<span class="stringliteral">&#39;status&#39;</span>]</div>
<div class="line"><span class="lineno">  294</span> </div>
<div class="line"><span class="lineno">  295</span>            existing_book = UserBook.objects.filter(title=title, author=author).first()</div>
<div class="line"><span class="lineno">  296</span>            <span class="keywordflow">if</span> existing_book:</div>
<div class="line"><span class="lineno">  297</span>                existing_book.status = status</div>
<div class="line"><span class="lineno">  298</span>                existing_book.save()</div>
<div class="line"><span class="lineno">  299</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  300</span>                book = UserBook(</div>
<div class="line"><span class="lineno">  301</span>                    user=request.user,</div>
<div class="line"><span class="lineno">  302</span>                    title=title,</div>
<div class="line"><span class="lineno">  303</span>                    author=author,</div>
<div class="line"><span class="lineno">  304</span>                    genre=genre,</div>
<div class="line"><span class="lineno">  305</span>                    status=status,</div>
<div class="line"><span class="lineno">  306</span>                )</div>
<div class="line"><span class="lineno">  307</span>                book.save() </div>
<div class="line"><span class="lineno">  308</span>                message = f<span class="stringliteral">&quot;Book successfully added with ID {book.book_id}!&quot;</span></div>
<div class="line"><span class="lineno">  309</span>            </div>
<div class="line"><span class="lineno">  310</span>            <span class="keywordflow">return</span> redirect(<span class="stringliteral">&#39;book_main&#39;</span>) </div>
<div class="line"><span class="lineno">  311</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  312</span>        form = ManualBookForm()</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;book/index.html&#39;</span>, {<span class="stringliteral">&#39;form&#39;</span>: form})</div>
<div class="line"><span class="lineno">  315</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="afe7a73ec12d71d322770fa832afaf230" name="afe7a73ec12d71d322770fa832afaf230"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe7a73ec12d71d322770fa832afaf230">&#9670;&#160;</a></span>recommendations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">recommendations </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Displays book recommendations for the user.

This view suggests books based on the user's genre preferences and past behavior.

@param request The HTTP request object.
@return Renders the recommendations page with the suggested books.
</pre> 
<p class="definition">Definition at line <a class="el" href="book_2views_8py_source.html#l00316">316</a> of file <a class="el" href="book_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  316</span><span class="keyword">def </span>recommendations(request):</div>
<div class="line"><span class="lineno">  317</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  318</span><span class="stringliteral">    @brief Displays book recommendations for the user.</span></div>
<div class="line"><span class="lineno">  319</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  320</span><span class="stringliteral">    This view suggests books based on the user&#39;s genre preferences and past behavior.</span></div>
<div class="line"><span class="lineno">  321</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  322</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  323</span><span class="stringliteral">    @return Renders the recommendations page with the suggested books.</span></div>
<div class="line"><span class="lineno">  324</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  325</span>    user = request.user</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>    top_genres = get_top_genres(user)</div>
<div class="line"><span class="lineno">  328</span>    recommended_books = get_recommendations_from_google_books(top_genres, min_rating=4.0, max_results=5)</div>
<div class="line"><span class="lineno">  329</span> </div>
<div class="line"><span class="lineno">  330</span>    author_based = get_author_based_recommendations_with_api(user)</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>    best_sellers = get_bestsellers_with_google_info() </div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>    error_message = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  335</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> best_sellers:</div>
<div class="line"><span class="lineno">  336</span>        error_message = <span class="stringliteral">&#39;No bestsellers found&#39;</span></div>
<div class="line"><span class="lineno">  337</span>    </div>
<div class="line"><span class="lineno">  338</span>    <span class="keywordflow">return</span> render(request, <span class="stringliteral">&#39;book/recommendations.html&#39;</span>, {</div>
<div class="line"><span class="lineno">  339</span>        <span class="stringliteral">&#39;recommended_books&#39;</span>: recommended_books,</div>
<div class="line"><span class="lineno">  340</span>        <span class="stringliteral">&#39;author_based&#39;</span>: author_based,</div>
<div class="line"><span class="lineno">  341</span>        <span class="stringliteral">&#39;best_sellers&#39;</span>: best_sellers,</div>
<div class="line"><span class="lineno">  342</span>        <span class="stringliteral">&#39;error_message&#39;</span>: error_message,</div>
<div class="line"><span class="lineno">  343</span>    })</div>
<div class="line"><span class="lineno">  344</span> </div>
<div class="line"><span class="lineno">  345</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a203c0b16b74b245c1b750f4bbc16f568" name="a203c0b16b74b245c1b750f4bbc16f568"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a203c0b16b74b245c1b750f4bbc16f568">&#9670;&#160;</a></span>update_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">update_status </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>request</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>book_id</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Updates the status of a book in the user's collection.

This view allows the user to change the status of a book.

@param request The HTTP request object.
@param book_id The unique identifier for the book.
@return A JSON response with the updated status.
</pre> 
<p class="definition">Definition at line <a class="el" href="book_2views_8py_source.html#l00225">225</a> of file <a class="el" href="book_2views_8py_source.html">views.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  225</span><span class="keyword">def </span>update_status(request, book_id):</div>
<div class="line"><span class="lineno">  226</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  227</span><span class="stringliteral">    @brief Updates the status of a book in the user&#39;s collection.</span></div>
<div class="line"><span class="lineno">  228</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  229</span><span class="stringliteral">    This view allows the user to change the status of a book.</span></div>
<div class="line"><span class="lineno">  230</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  231</span><span class="stringliteral">    @param request The HTTP request object.</span></div>
<div class="line"><span class="lineno">  232</span><span class="stringliteral">    @param book_id The unique identifier for the book.</span></div>
<div class="line"><span class="lineno">  233</span><span class="stringliteral">    @return A JSON response with the updated status.</span></div>
<div class="line"><span class="lineno">  234</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&quot;POST&quot;</span>:</div>
<div class="line"><span class="lineno">  236</span>        data = json.loads(request.body)</div>
<div class="line"><span class="lineno">  237</span>        book_id = data[<span class="stringliteral">&#39;book_id&#39;</span>]</div>
<div class="line"><span class="lineno">  238</span>        status = data[<span class="stringliteral">&#39;status&#39;</span>]</div>
<div class="line"><span class="lineno">  239</span> </div>
<div class="line"><span class="lineno">  240</span>        <span class="keywordflow">if</span> book_id.isdigit():</div>
<div class="line"><span class="lineno">  241</span>            book_id = f<span class="stringliteral">&quot;user_{book_id}&quot;</span></div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>            book = UserBook.objects.get(book_id=book_id)</div>
<div class="line"><span class="lineno">  246</span>        <span class="keywordflow">except</span> UserBook.DoesNotExist:</div>
<div class="line"><span class="lineno">  247</span>            <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&quot;error&quot;</span>: <span class="stringliteral">&quot;Book not found&quot;</span>}, status=404)</div>
<div class="line"><span class="lineno">  248</span> </div>
<div class="line"><span class="lineno">  249</span>        book.status = status</div>
<div class="line"><span class="lineno">  250</span>        book.save()</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>        <span class="keywordflow">return</span> JsonResponse({<span class="stringliteral">&quot;status&quot;</span>: status})</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span> </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacebook.html">book</a></li><li class="navelem"><a class="el" href="namespacebook_1_1views.html">views</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
