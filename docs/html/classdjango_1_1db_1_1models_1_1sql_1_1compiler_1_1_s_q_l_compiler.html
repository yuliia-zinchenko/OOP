<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Read&amp;Watch: django.db.models.sql.compiler.SQLCompiler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Read&amp;Watch<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_compiler.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_compiler-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">django.db.models.sql.compiler.SQLCompiler Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for django.db.models.sql.compiler.SQLCompiler:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_compiler.png" usemap="#django.db.models.sql.compiler.SQLCompiler_map" alt=""/>
  <map id="django.db.models.sql.compiler.SQLCompiler_map" name="django.db.models.sql.compiler.SQLCompiler_map">
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_compiler.html" alt="django.db.backends.mysql.compiler.SQLCompiler" shape="rect" coords="0,56,351,80"/>
<area href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_aggregate_compiler.html" alt="django.db.models.sql.compiler.SQLAggregateCompiler" shape="rect" coords="722,56,1073,80"/>
<area href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_delete_compiler.html" alt="django.db.models.sql.compiler.SQLDeleteCompiler" shape="rect" coords="1083,56,1434,80"/>
<area href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_insert_compiler.html" alt="django.db.models.sql.compiler.SQLInsertCompiler" shape="rect" coords="1444,56,1795,80"/>
<area href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_update_compiler.html" alt="django.db.models.sql.compiler.SQLUpdateCompiler" shape="rect" coords="1805,56,2156,80"/>
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_aggregate_compiler.html" alt="django.db.backends.mysql.compiler.SQLAggregateCompiler" shape="rect" coords="361,112,712,136"/>
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_delete_compiler.html" alt="django.db.backends.mysql.compiler.SQLDeleteCompiler" shape="rect" coords="361,168,712,192"/>
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_insert_compiler.html" alt="django.db.backends.mysql.compiler.SQLInsertCompiler" shape="rect" coords="361,224,712,248"/>
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_update_compiler.html" alt="django.db.backends.mysql.compiler.SQLUpdateCompiler" shape="rect" coords="361,280,712,304"/>
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_aggregate_compiler.html" alt="django.db.backends.mysql.compiler.SQLAggregateCompiler" shape="rect" coords="722,112,1073,136"/>
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_delete_compiler.html" alt="django.db.backends.mysql.compiler.SQLDeleteCompiler" shape="rect" coords="1083,112,1434,136"/>
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_insert_compiler.html" alt="django.db.backends.mysql.compiler.SQLInsertCompiler" shape="rect" coords="1444,112,1795,136"/>
<area href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_update_compiler.html" alt="django.db.backends.mysql.compiler.SQLUpdateCompiler" shape="rect" coords="1805,112,2156,136"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a89d30adf386e85859a19d6dc69f6f3eb" id="r_a89d30adf386e85859a19d6dc69f6f3eb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a89d30adf386e85859a19d6dc69f6f3eb">__init__</a> (self, <a class="el" href="#a46a3cece6bcd7f5bb21882128edd4cbb">query</a>, <a class="el" href="#a89cb97382b1f2aeeb9df5689e1743d6d">connection</a>, <a class="el" href="#a348fe92525c8429db7aebc5d026878ad">using</a>, <a class="el" href="#a5d64266303ab2403b147d4c4928c6b73">elide_empty</a>=True)</td></tr>
<tr class="separator:a89d30adf386e85859a19d6dc69f6f3eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0548370aacbfad8fece60fdbe44f967" id="r_ac0548370aacbfad8fece60fdbe44f967"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac0548370aacbfad8fece60fdbe44f967">__repr__</a> (self)</td></tr>
<tr class="separator:ac0548370aacbfad8fece60fdbe44f967"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8a6cc3fb92bdd9c50431c79734ae9ca" id="r_ab8a6cc3fb92bdd9c50431c79734ae9ca"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab8a6cc3fb92bdd9c50431c79734ae9ca">setup_query</a> (self, with_col_aliases=False)</td></tr>
<tr class="separator:ab8a6cc3fb92bdd9c50431c79734ae9ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b43e91f203b2db610967351ce6e7d2e" id="r_a1b43e91f203b2db610967351ce6e7d2e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1b43e91f203b2db610967351ce6e7d2e">pre_sql_setup</a> (self, with_col_aliases=False)</td></tr>
<tr class="separator:a1b43e91f203b2db610967351ce6e7d2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a952d33943d1a7920e1884ce273e96e53" id="r_a952d33943d1a7920e1884ce273e96e53"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a952d33943d1a7920e1884ce273e96e53">get_group_by</a> (self, <a class="el" href="#a8376432a6364ad4e09f274311faae015">select</a>, order_by)</td></tr>
<tr class="separator:a952d33943d1a7920e1884ce273e96e53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb77eb703de6a68ffbbf0e3bfc75fff3" id="r_aeb77eb703de6a68ffbbf0e3bfc75fff3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeb77eb703de6a68ffbbf0e3bfc75fff3">collapse_group_by</a> (self, expressions, <a class="el" href="#a592d23e45a13ff9617aeee95a5fde16f">having</a>)</td></tr>
<tr class="separator:aeb77eb703de6a68ffbbf0e3bfc75fff3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae45920438395e09bd0e2211c58a50e04" id="r_ae45920438395e09bd0e2211c58a50e04"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae45920438395e09bd0e2211c58a50e04">get_select</a> (self, with_col_aliases=False)</td></tr>
<tr class="separator:ae45920438395e09bd0e2211c58a50e04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85a625d03b1e87e5dc6f2ea7e93fef1a" id="r_a85a625d03b1e87e5dc6f2ea7e93fef1a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a85a625d03b1e87e5dc6f2ea7e93fef1a">get_order_by</a> (self)</td></tr>
<tr class="separator:a85a625d03b1e87e5dc6f2ea7e93fef1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93cf0b3ee93507769a47085242c92e21" id="r_a93cf0b3ee93507769a47085242c92e21"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a93cf0b3ee93507769a47085242c92e21">get_extra_select</a> (self, order_by, <a class="el" href="#a8376432a6364ad4e09f274311faae015">select</a>)</td></tr>
<tr class="separator:a93cf0b3ee93507769a47085242c92e21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee1ca8fa1097490d7dde9458af2087a2" id="r_aee1ca8fa1097490d7dde9458af2087a2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aee1ca8fa1097490d7dde9458af2087a2">quote_name_unless_alias</a> (self, name)</td></tr>
<tr class="separator:aee1ca8fa1097490d7dde9458af2087a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa04036f15ac7916f9be1c43e8ace807a" id="r_aa04036f15ac7916f9be1c43e8ace807a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa04036f15ac7916f9be1c43e8ace807a">compile</a> (self, node)</td></tr>
<tr class="separator:aa04036f15ac7916f9be1c43e8ace807a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f2bb7c08e1627240b5f2e46ab5623d2" id="r_a2f2bb7c08e1627240b5f2e46ab5623d2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2f2bb7c08e1627240b5f2e46ab5623d2">get_combinator_sql</a> (self, combinator, all)</td></tr>
<tr class="separator:a2f2bb7c08e1627240b5f2e46ab5623d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdb00329e7a13cfc55825ceb0302bb93" id="r_afdb00329e7a13cfc55825ceb0302bb93"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afdb00329e7a13cfc55825ceb0302bb93">get_qualify_sql</a> (self)</td></tr>
<tr class="separator:afdb00329e7a13cfc55825ceb0302bb93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3918d4acd4c4e25eaf039479facdc7db" id="r_a3918d4acd4c4e25eaf039479facdc7db"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3918d4acd4c4e25eaf039479facdc7db">as_sql</a> (self, with_limits=True, with_col_aliases=False)</td></tr>
<tr class="separator:a3918d4acd4c4e25eaf039479facdc7db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd79e7a3d13813fed13e69862f37770" id="r_a1fd79e7a3d13813fed13e69862f37770"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1fd79e7a3d13813fed13e69862f37770">get_default_columns</a> (self, select_mask, start_alias=None, opts=None, from_parent=None)</td></tr>
<tr class="separator:a1fd79e7a3d13813fed13e69862f37770"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5afc8cd4e50abc7c5a9f8ca83beba4d4" id="r_a5afc8cd4e50abc7c5a9f8ca83beba4d4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5afc8cd4e50abc7c5a9f8ca83beba4d4">get_distinct</a> (self)</td></tr>
<tr class="separator:a5afc8cd4e50abc7c5a9f8ca83beba4d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af700709c03bb6c5cd212d3602e909e3a" id="r_af700709c03bb6c5cd212d3602e909e3a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af700709c03bb6c5cd212d3602e909e3a">find_ordering_name</a> (self, name, opts, alias=None, default_order=&quot;ASC&quot;, already_seen=None)</td></tr>
<tr class="separator:af700709c03bb6c5cd212d3602e909e3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83d303ccaad416a1714f4ce46f691473" id="r_a83d303ccaad416a1714f4ce46f691473"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a83d303ccaad416a1714f4ce46f691473">get_from_clause</a> (self)</td></tr>
<tr class="separator:a83d303ccaad416a1714f4ce46f691473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee7015626498e3df6714612271bb2b00" id="r_aee7015626498e3df6714612271bb2b00"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aee7015626498e3df6714612271bb2b00">get_related_selections</a> (self, <a class="el" href="#a8376432a6364ad4e09f274311faae015">select</a>, select_mask, opts=None, root_alias=None, cur_depth=1, requested=None, restricted=None)</td></tr>
<tr class="separator:aee7015626498e3df6714612271bb2b00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc146258b1413bd96cd04cad1855dd94" id="r_acc146258b1413bd96cd04cad1855dd94"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acc146258b1413bd96cd04cad1855dd94">get_select_for_update_of_arguments</a> (self)</td></tr>
<tr class="separator:acc146258b1413bd96cd04cad1855dd94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5af4ddf5413beaf2d91b0bb5c1bf5d2" id="r_ad5af4ddf5413beaf2d91b0bb5c1bf5d2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad5af4ddf5413beaf2d91b0bb5c1bf5d2">get_converters</a> (self, expressions)</td></tr>
<tr class="separator:ad5af4ddf5413beaf2d91b0bb5c1bf5d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5481aadf9c49f6e887361de6bc20e507" id="r_a5481aadf9c49f6e887361de6bc20e507"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5481aadf9c49f6e887361de6bc20e507">apply_converters</a> (self, rows, converters)</td></tr>
<tr class="separator:a5481aadf9c49f6e887361de6bc20e507"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae75172de9cb1885c3c8e9842460ee1a6" id="r_ae75172de9cb1885c3c8e9842460ee1a6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae75172de9cb1885c3c8e9842460ee1a6">results_iter</a> (self, results=None, tuple_expected=False, chunked_fetch=False, chunk_size=GET_ITERATOR_CHUNK_SIZE)</td></tr>
<tr class="separator:ae75172de9cb1885c3c8e9842460ee1a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a730571b9b54a4d28aed6af579018b5d4" id="r_a730571b9b54a4d28aed6af579018b5d4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a730571b9b54a4d28aed6af579018b5d4">has_results</a> (self)</td></tr>
<tr class="separator:a730571b9b54a4d28aed6af579018b5d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07cbbc7958a72203f8ebe9ba29b9356f" id="r_a07cbbc7958a72203f8ebe9ba29b9356f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a07cbbc7958a72203f8ebe9ba29b9356f">execute_sql</a> (self, result_type=MULTI, chunked_fetch=False, chunk_size=GET_ITERATOR_CHUNK_SIZE)</td></tr>
<tr class="separator:a07cbbc7958a72203f8ebe9ba29b9356f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78bdce11e05140ed74db8f5463bedfce" id="r_a78bdce11e05140ed74db8f5463bedfce"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a78bdce11e05140ed74db8f5463bedfce">as_subquery_condition</a> (self, alias, columns, compiler)</td></tr>
<tr class="separator:a78bdce11e05140ed74db8f5463bedfce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae37702aee3a2c220b0d45022bece3120" id="r_ae37702aee3a2c220b0d45022bece3120"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae37702aee3a2c220b0d45022bece3120">explain_query</a> (self)</td></tr>
<tr class="separator:ae37702aee3a2c220b0d45022bece3120"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a46a3cece6bcd7f5bb21882128edd4cbb" id="r_a46a3cece6bcd7f5bb21882128edd4cbb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a46a3cece6bcd7f5bb21882128edd4cbb">query</a> = query</td></tr>
<tr class="separator:a46a3cece6bcd7f5bb21882128edd4cbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89cb97382b1f2aeeb9df5689e1743d6d" id="r_a89cb97382b1f2aeeb9df5689e1743d6d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a89cb97382b1f2aeeb9df5689e1743d6d">connection</a> = connection</td></tr>
<tr class="separator:a89cb97382b1f2aeeb9df5689e1743d6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a348fe92525c8429db7aebc5d026878ad" id="r_a348fe92525c8429db7aebc5d026878ad"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a348fe92525c8429db7aebc5d026878ad">using</a> = using</td></tr>
<tr class="separator:a348fe92525c8429db7aebc5d026878ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d64266303ab2403b147d4c4928c6b73" id="r_a5d64266303ab2403b147d4c4928c6b73"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5d64266303ab2403b147d4c4928c6b73">elide_empty</a> = elide_empty</td></tr>
<tr class="separator:a5d64266303ab2403b147d4c4928c6b73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cf6c5b29a716283d527c8ff66445ea4" id="r_a8cf6c5b29a716283d527c8ff66445ea4"><td class="memItemLeft" align="right" valign="top">dict&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8cf6c5b29a716283d527c8ff66445ea4">quote_cache</a> = {&quot;*&quot;: &quot;*&quot;}</td></tr>
<tr class="separator:a8cf6c5b29a716283d527c8ff66445ea4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8376432a6364ad4e09f274311faae015" id="r_a8376432a6364ad4e09f274311faae015"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8376432a6364ad4e09f274311faae015">select</a> = None</td></tr>
<tr class="separator:a8376432a6364ad4e09f274311faae015"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed00a9e6e1ed1364231a5fc4adb08962" id="r_aed00a9e6e1ed1364231a5fc4adb08962"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed00a9e6e1ed1364231a5fc4adb08962">annotation_col_map</a> = None</td></tr>
<tr class="separator:aed00a9e6e1ed1364231a5fc4adb08962"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c0bd8f7b828e9ea5e5bc7ff43ed2b0e" id="r_a8c0bd8f7b828e9ea5e5bc7ff43ed2b0e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8c0bd8f7b828e9ea5e5bc7ff43ed2b0e">klass_info</a> = None</td></tr>
<tr class="separator:a8c0bd8f7b828e9ea5e5bc7ff43ed2b0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2eb6e33fdbd088980f3ff08a95498f0" id="r_aa2eb6e33fdbd088980f3ff08a95498f0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa2eb6e33fdbd088980f3ff08a95498f0">col_count</a> = len(self.select)</td></tr>
<tr class="separator:aa2eb6e33fdbd088980f3ff08a95498f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af21b78f80b16870af227f7d4c86bf60d" id="r_af21b78f80b16870af227f7d4c86bf60d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af21b78f80b16870af227f7d4c86bf60d">where</a></td></tr>
<tr class="separator:af21b78f80b16870af227f7d4c86bf60d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a592d23e45a13ff9617aeee95a5fde16f" id="r_a592d23e45a13ff9617aeee95a5fde16f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a592d23e45a13ff9617aeee95a5fde16f">having</a></td></tr>
<tr class="separator:a592d23e45a13ff9617aeee95a5fde16f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bdcdd7f91079ec8c23746fc41ad9189" id="r_a0bdcdd7f91079ec8c23746fc41ad9189"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0bdcdd7f91079ec8c23746fc41ad9189">qualify</a></td></tr>
<tr class="separator:a0bdcdd7f91079ec8c23746fc41ad9189"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacc8cc950543aa605e45e4a0c3d7ff0b" id="r_aacc8cc950543aa605e45e4a0c3d7ff0b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aacc8cc950543aa605e45e4a0c3d7ff0b">has_extra_select</a> = bool(extra_select)</td></tr>
<tr class="separator:aacc8cc950543aa605e45e4a0c3d7ff0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-attribs" name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:acb6143d6d626f4ee09f3abcf8ed43a52" id="r_acb6143d6d626f4ee09f3abcf8ed43a52"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acb6143d6d626f4ee09f3abcf8ed43a52">ordering_parts</a></td></tr>
<tr class="separator:acb6143d6d626f4ee09f3abcf8ed43a52"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:aadc45c88889716b107b99e9f2e76f591" id="r_aadc45c88889716b107b99e9f2e76f591"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aadc45c88889716b107b99e9f2e76f591">_order_by_pairs</a> (self)</td></tr>
<tr class="separator:aadc45c88889716b107b99e9f2e76f591"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c7c0abac7cd55c295b175b2a6e58f94" id="r_a6c7c0abac7cd55c295b175b2a6e58f94"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6c7c0abac7cd55c295b175b2a6e58f94">_setup_joins</a> (self, pieces, opts, alias)</td></tr>
<tr class="separator:a6c7c0abac7cd55c295b175b2a6e58f94"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a69f3df8bbdbbc7ede376f161a6705975" id="r_a69f3df8bbdbbc7ede376f161a6705975"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a69f3df8bbdbbc7ede376f161a6705975">_meta_ordering</a> = None</td></tr>
<tr class="separator:a69f3df8bbdbbc7ede376f161a6705975"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00039">39</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a89d30adf386e85859a19d6dc69f6f3eb" name="a89d30adf386e85859a19d6dc69f6f3eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89d30adf386e85859a19d6dc69f6f3eb">&#9670;&#160;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.__init__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>query</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>connection</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>using</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>elide_empty</em></span><span class="paramdefsep"> = </span><span class="paramdefval">True</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00046">46</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   46</span>    <span class="keyword">def </span>__init__(self, query, connection, using, elide_empty=True):</div>
<div class="line"><span class="lineno">   47</span>        self.query = query</div>
<div class="line"><span class="lineno">   48</span>        self.connection = connection</div>
<div class="line"><span class="lineno">   49</span>        self.using = using</div>
<div class="line"><span class="lineno">   50</span>        <span class="comment"># Some queries, e.g. coalesced aggregation, need to be executed even if</span></div>
<div class="line"><span class="lineno">   51</span>        <span class="comment"># they would return an empty result set.</span></div>
<div class="line"><span class="lineno">   52</span>        self.elide_empty = elide_empty</div>
<div class="line"><span class="lineno">   53</span>        self.quote_cache = {<span class="stringliteral">&quot;*&quot;</span>: <span class="stringliteral">&quot;*&quot;</span>}</div>
<div class="line"><span class="lineno">   54</span>        <span class="comment"># The select, klass_info, and annotations are needed by QuerySet.iterator()</span></div>
<div class="line"><span class="lineno">   55</span>        <span class="comment"># these are set as a side-effect of executing the query. Note that we calculate</span></div>
<div class="line"><span class="lineno">   56</span>        <span class="comment"># separately a list of extra select columns needed for grammatical correctness</span></div>
<div class="line"><span class="lineno">   57</span>        <span class="comment"># of the query, but these columns are not included in self.select.</span></div>
<div class="line"><span class="lineno">   58</span>        self.select = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   59</span>        self.annotation_col_map = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   60</span>        self.klass_info = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   61</span>        self._meta_ordering = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   62</span> </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="typing__extensions_8py_source.html#l02793">pip._vendor.typing_extensions.deprecated.__call__()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ac0548370aacbfad8fece60fdbe44f967" name="ac0548370aacbfad8fece60fdbe44f967"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0548370aacbfad8fece60fdbe44f967">&#9670;&#160;</a></span>__repr__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.__repr__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00063">63</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>    <span class="keyword">def </span>__repr__(self):</div>
<div class="line"><span class="lineno">   64</span>        <span class="keywordflow">return</span> (</div>
<div class="line"><span class="lineno">   65</span>            f<span class="stringliteral">&quot;&lt;{self.__class__.__qualname__} &quot;</span></div>
<div class="line"><span class="lineno">   66</span>            f<span class="stringliteral">&quot;model={self.query.model.__qualname__} &quot;</span></div>
<div class="line"><span class="lineno">   67</span>            f<span class="stringliteral">&quot;connection={self.connection!r} using={self.using!r}&gt;&quot;</span></div>
<div class="line"><span class="lineno">   68</span>        )</div>
<div class="line"><span class="lineno">   69</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aadc45c88889716b107b99e9f2e76f591" name="aadc45c88889716b107b99e9f2e76f591"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadc45c88889716b107b99e9f2e76f591">&#9670;&#160;</a></span>_order_by_pairs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler._order_by_pairs </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00316">316</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  316</span>    <span class="keyword">def </span>_order_by_pairs(self):</div>
<div class="line"><span class="lineno">  317</span>        <span class="keywordflow">if</span> self.query.extra_order_by:</div>
<div class="line"><span class="lineno">  318</span>            ordering = self.query.extra_order_by</div>
<div class="line"><span class="lineno">  319</span>        <span class="keywordflow">elif</span> <span class="keywordflow">not</span> self.query.default_ordering:</div>
<div class="line"><span class="lineno">  320</span>            ordering = self.query.order_by</div>
<div class="line"><span class="lineno">  321</span>        <span class="keywordflow">elif</span> self.query.order_by:</div>
<div class="line"><span class="lineno">  322</span>            ordering = self.query.order_by</div>
<div class="line"><span class="lineno">  323</span>        <span class="keywordflow">elif</span> (meta := self.query.get_meta()) <span class="keywordflow">and</span> meta.ordering:</div>
<div class="line"><span class="lineno">  324</span>            ordering = meta.ordering</div>
<div class="line"><span class="lineno">  325</span>            self._meta_ordering = ordering</div>
<div class="line"><span class="lineno">  326</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  327</span>            ordering = []</div>
<div class="line"><span class="lineno">  328</span>        <span class="keywordflow">if</span> self.query.standard_ordering:</div>
<div class="line"><span class="lineno">  329</span>            default_order, _ = ORDER_DIR[<span class="stringliteral">&quot;ASC&quot;</span>]</div>
<div class="line"><span class="lineno">  330</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  331</span>            default_order, _ = ORDER_DIR[<span class="stringliteral">&quot;DESC&quot;</span>]</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>        selected_exprs = {}</div>
<div class="line"><span class="lineno">  334</span>        <span class="comment"># Avoid computing `selected_exprs` if there is no `ordering` as it&#39;s</span></div>
<div class="line"><span class="lineno">  335</span>        <span class="comment"># relatively expensive.</span></div>
<div class="line"><span class="lineno">  336</span>        <span class="keywordflow">if</span> ordering <span class="keywordflow">and</span> (select := self.select):</div>
<div class="line"><span class="lineno">  337</span>            <span class="keywordflow">for</span> ordinal, (expr, _, alias) <span class="keywordflow">in</span> enumerate(select, start=1):</div>
<div class="line"><span class="lineno">  338</span>                pos_expr = PositionRef(ordinal, alias, expr)</div>
<div class="line"><span class="lineno">  339</span>                <span class="keywordflow">if</span> alias:</div>
<div class="line"><span class="lineno">  340</span>                    selected_exprs[alias] = pos_expr</div>
<div class="line"><span class="lineno">  341</span>                selected_exprs[expr] = pos_expr</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>        <span class="keywordflow">for</span> field <span class="keywordflow">in</span> ordering:</div>
<div class="line"><span class="lineno">  344</span>            <span class="keywordflow">if</span> hasattr(field, <span class="stringliteral">&quot;resolve_expression&quot;</span>):</div>
<div class="line"><span class="lineno">  345</span>                <span class="keywordflow">if</span> isinstance(field, Value):</div>
<div class="line"><span class="lineno">  346</span>                    <span class="comment"># output_field must be resolved for constants.</span></div>
<div class="line"><span class="lineno">  347</span>                    field = Cast(field, field.output_field)</div>
<div class="line"><span class="lineno">  348</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(field, OrderBy):</div>
<div class="line"><span class="lineno">  349</span>                    field = field.asc()</div>
<div class="line"><span class="lineno">  350</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.query.standard_ordering:</div>
<div class="line"><span class="lineno">  351</span>                    field = field.copy()</div>
<div class="line"><span class="lineno">  352</span>                    field.reverse_ordering()</div>
<div class="line"><span class="lineno">  353</span>                select_ref = selected_exprs.get(field.expression)</div>
<div class="line"><span class="lineno">  354</span>                <span class="keywordflow">if</span> select_ref <span class="keywordflow">or</span> (</div>
<div class="line"><span class="lineno">  355</span>                    isinstance(field.expression, F)</div>
<div class="line"><span class="lineno">  356</span>                    <span class="keywordflow">and</span> (select_ref := selected_exprs.get(field.expression.name))</div>
<div class="line"><span class="lineno">  357</span>                ):</div>
<div class="line"><span class="lineno">  358</span>                    <span class="comment"># Emulation of NULLS (FIRST|LAST) cannot be combined with</span></div>
<div class="line"><span class="lineno">  359</span>                    <span class="comment"># the usage of ordering by position.</span></div>
<div class="line"><span class="lineno">  360</span>                    <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  361</span>                        field.nulls_first <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> field.nulls_last <span class="keywordflow">is</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  362</span>                    ) <span class="keywordflow">or</span> self.connection.features.supports_order_by_nulls_modifier:</div>
<div class="line"><span class="lineno">  363</span>                        field = field.copy()</div>
<div class="line"><span class="lineno">  364</span>                        field.expression = select_ref</div>
<div class="line"><span class="lineno">  365</span>                    <span class="comment"># Alias collisions are not possible when dealing with</span></div>
<div class="line"><span class="lineno">  366</span>                    <span class="comment"># combined queries so fallback to it if emulation of NULLS</span></div>
<div class="line"><span class="lineno">  367</span>                    <span class="comment"># handling is required.</span></div>
<div class="line"><span class="lineno">  368</span>                    <span class="keywordflow">elif</span> self.query.combinator:</div>
<div class="line"><span class="lineno">  369</span>                        field = field.copy()</div>
<div class="line"><span class="lineno">  370</span>                        field.expression = Ref(select_ref.refs, select_ref.source)</div>
<div class="line"><span class="lineno">  371</span>                <span class="keywordflow">yield</span> field, select_ref <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  372</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  373</span>            <span class="keywordflow">if</span> field == <span class="stringliteral">&quot;?&quot;</span>:  <span class="comment"># random</span></div>
<div class="line"><span class="lineno">  374</span>                <span class="keywordflow">yield</span> OrderBy(Random()), <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  375</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>            col, order = get_order_dir(field, default_order)</div>
<div class="line"><span class="lineno">  378</span>            descending = order == <span class="stringliteral">&quot;DESC&quot;</span></div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>            <span class="keywordflow">if</span> select_ref := selected_exprs.get(col):</div>
<div class="line"><span class="lineno">  381</span>                <span class="comment"># Reference to expression in SELECT clause</span></div>
<div class="line"><span class="lineno">  382</span>                <span class="keywordflow">yield</span> (</div>
<div class="line"><span class="lineno">  383</span>                    OrderBy(</div>
<div class="line"><span class="lineno">  384</span>                        select_ref,</div>
<div class="line"><span class="lineno">  385</span>                        descending=descending,</div>
<div class="line"><span class="lineno">  386</span>                    ),</div>
<div class="line"><span class="lineno">  387</span>                    <span class="keyword">True</span>,</div>
<div class="line"><span class="lineno">  388</span>                )</div>
<div class="line"><span class="lineno">  389</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>            <span class="keywordflow">if</span> expr := self.query.annotations.get(col):</div>
<div class="line"><span class="lineno">  392</span>                ref = col</div>
<div class="line"><span class="lineno">  393</span>                transforms = []</div>
<div class="line"><span class="lineno">  394</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  395</span>                ref, *transforms = col.split(LOOKUP_SEP)</div>
<div class="line"><span class="lineno">  396</span>                expr = self.query.annotations.get(ref)</div>
<div class="line"><span class="lineno">  397</span>            <span class="keywordflow">if</span> expr:</div>
<div class="line"><span class="lineno">  398</span>                <span class="keywordflow">if</span> self.query.combinator <span class="keywordflow">and</span> self.select:</div>
<div class="line"><span class="lineno">  399</span>                    <span class="keywordflow">if</span> transforms:</div>
<div class="line"><span class="lineno">  400</span>                        <span class="keywordflow">raise</span> NotImplementedError(</div>
<div class="line"><span class="lineno">  401</span>                            <span class="stringliteral">&quot;Ordering combined queries by transforms is not &quot;</span></div>
<div class="line"><span class="lineno">  402</span>                            <span class="stringliteral">&quot;implemented.&quot;</span></div>
<div class="line"><span class="lineno">  403</span>                        )</div>
<div class="line"><span class="lineno">  404</span>                    <span class="comment"># Don&#39;t use the resolved annotation because other</span></div>
<div class="line"><span class="lineno">  405</span>                    <span class="comment"># combined queries might define it differently.</span></div>
<div class="line"><span class="lineno">  406</span>                    expr = F(ref)</div>
<div class="line"><span class="lineno">  407</span>                <span class="keywordflow">if</span> transforms:</div>
<div class="line"><span class="lineno">  408</span>                    <span class="keywordflow">for</span> name <span class="keywordflow">in</span> transforms:</div>
<div class="line"><span class="lineno">  409</span>                        expr = self.query.try_transform(expr, name)</div>
<div class="line"><span class="lineno">  410</span>                <span class="keywordflow">if</span> isinstance(expr, Value):</div>
<div class="line"><span class="lineno">  411</span>                    <span class="comment"># output_field must be resolved for constants.</span></div>
<div class="line"><span class="lineno">  412</span>                    expr = Cast(expr, expr.output_field)</div>
<div class="line"><span class="lineno">  413</span>                <span class="keywordflow">yield</span> OrderBy(expr, descending=descending), <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  414</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span>            <span class="keywordflow">if</span> <span class="stringliteral">&quot;.&quot;</span> <span class="keywordflow">in</span> field:</div>
<div class="line"><span class="lineno">  417</span>                <span class="comment"># This came in through an extra(order_by=...) addition. Pass it</span></div>
<div class="line"><span class="lineno">  418</span>                <span class="comment"># on verbatim.</span></div>
<div class="line"><span class="lineno">  419</span>                table, col = col.split(<span class="stringliteral">&quot;.&quot;</span>, 1)</div>
<div class="line"><span class="lineno">  420</span>                <span class="keywordflow">yield</span> (</div>
<div class="line"><span class="lineno">  421</span>                    OrderBy(</div>
<div class="line"><span class="lineno">  422</span>                        RawSQL(</div>
<div class="line"><span class="lineno">  423</span>                            <span class="stringliteral">&quot;%s.%s&quot;</span> % (self.quote_name_unless_alias(table), col), []</div>
<div class="line"><span class="lineno">  424</span>                        ),</div>
<div class="line"><span class="lineno">  425</span>                        descending=descending,</div>
<div class="line"><span class="lineno">  426</span>                    ),</div>
<div class="line"><span class="lineno">  427</span>                    <span class="keyword">False</span>,</div>
<div class="line"><span class="lineno">  428</span>                )</div>
<div class="line"><span class="lineno">  429</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>            <span class="keywordflow">if</span> self.query.extra <span class="keywordflow">and</span> col <span class="keywordflow">in</span> self.query.extra:</div>
<div class="line"><span class="lineno">  432</span>                <span class="keywordflow">if</span> col <span class="keywordflow">in</span> self.query.extra_select:</div>
<div class="line"><span class="lineno">  433</span>                    <span class="keywordflow">yield</span> (</div>
<div class="line"><span class="lineno">  434</span>                        OrderBy(</div>
<div class="line"><span class="lineno">  435</span>                            Ref(col, RawSQL(*self.query.extra[col])),</div>
<div class="line"><span class="lineno">  436</span>                            descending=descending,</div>
<div class="line"><span class="lineno">  437</span>                        ),</div>
<div class="line"><span class="lineno">  438</span>                        <span class="keyword">True</span>,</div>
<div class="line"><span class="lineno">  439</span>                    )</div>
<div class="line"><span class="lineno">  440</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  441</span>                    <span class="keywordflow">yield</span> (</div>
<div class="line"><span class="lineno">  442</span>                        OrderBy(RawSQL(*self.query.extra[col]), descending=descending),</div>
<div class="line"><span class="lineno">  443</span>                        <span class="keyword">False</span>,</div>
<div class="line"><span class="lineno">  444</span>                    )</div>
<div class="line"><span class="lineno">  445</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  446</span>                <span class="keywordflow">if</span> self.query.combinator <span class="keywordflow">and</span> self.select:</div>
<div class="line"><span class="lineno">  447</span>                    <span class="comment"># Don&#39;t use the first model&#39;s field because other</span></div>
<div class="line"><span class="lineno">  448</span>                    <span class="comment"># combinated queries might define it differently.</span></div>
<div class="line"><span class="lineno">  449</span>                    <span class="keywordflow">yield</span> OrderBy(F(col), descending=descending), <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  450</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  451</span>                    <span class="comment"># &#39;col&#39; is of the form &#39;field&#39; or &#39;field1__field2&#39; or</span></div>
<div class="line"><span class="lineno">  452</span>                    <span class="comment"># &#39;-field1__field2__field&#39;, etc.</span></div>
<div class="line"><span class="lineno">  453</span>                    <span class="keywordflow">yield</span> <span class="keyword">from</span> self.find_ordering_name(</div>
<div class="line"><span class="lineno">  454</span>                        field,</div>
<div class="line"><span class="lineno">  455</span>                        self.query.get_meta(),</div>
<div class="line"><span class="lineno">  456</span>                        default_order=default_order,</div>
<div class="line"><span class="lineno">  457</span>                    )</div>
<div class="line"><span class="lineno">  458</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l00061">_meta_ordering</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01041">find_ordering_name()</a>, <a class="el" href="sql_2query_8py_source.html#l02632">django.db.models.sql.query.get_order_dir()</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00530">quote_name_unless_alias()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00020">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00099">django.contrib.gis.db.backends.oracle.operations.OracleOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2postgis_2operations_8py_source.html#l00167">django.contrib.gis.db.backends.postgis.operations.PostGISOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00066">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.select</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00058">select</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00459">get_order_by()</a>.</p>

</div>
</div>
<a id="a6c7c0abac7cd55c295b175b2a6e58f94" name="a6c7c0abac7cd55c295b175b2a6e58f94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c7c0abac7cd55c295b175b2a6e58f94">&#9670;&#160;</a></span>_setup_joins()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler._setup_joins </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>pieces</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>opts</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>alias</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Helper method for get_order_by() and get_distinct().

get_ordering() and get_distinct() must produce same target columns on
same input, as the prefixes of get_ordering() and get_distinct() must
match. Executing SQL where this is not true is an error.
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01104">1104</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1104</span>    <span class="keyword">def </span>_setup_joins(self, pieces, opts, alias):</div>
<div class="line"><span class="lineno"> 1105</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1106</span><span class="stringliteral">        Helper method for get_order_by() and get_distinct().</span></div>
<div class="line"><span class="lineno"> 1107</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno"> 1108</span><span class="stringliteral">        get_ordering() and get_distinct() must produce same target columns on</span></div>
<div class="line"><span class="lineno"> 1109</span><span class="stringliteral">        same input, as the prefixes of get_ordering() and get_distinct() must</span></div>
<div class="line"><span class="lineno"> 1110</span><span class="stringliteral">        match. Executing SQL where this is not true is an error.</span></div>
<div class="line"><span class="lineno"> 1111</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1112</span>        alias = alias <span class="keywordflow">or</span> self.query.get_initial_alias()</div>
<div class="line"><span class="lineno"> 1113</span>        field, targets, opts, joins, path, transform_function = self.query.setup_joins(</div>
<div class="line"><span class="lineno"> 1114</span>            pieces, opts, alias</div>
<div class="line"><span class="lineno"> 1115</span>        )</div>
<div class="line"><span class="lineno"> 1116</span>        alias = joins[-1]</div>
<div class="line"><span class="lineno"> 1117</span>        <span class="keywordflow">return</span> field, targets, alias, joins, path, opts, transform_function</div>
<div class="line"><span class="lineno"> 1118</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01041">find_ordering_name()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01013">get_distinct()</a>.</p>

</div>
</div>
<a id="a5481aadf9c49f6e887361de6bc20e507" name="a5481aadf9c49f6e887361de6bc20e507"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5481aadf9c49f6e887361de6bc20e507">&#9670;&#160;</a></span>apply_converters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.apply_converters </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>rows</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>converters</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01505">1505</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1505</span>    <span class="keyword">def </span>apply_converters(self, rows, converters):</div>
<div class="line"><span class="lineno"> 1506</span>        connection = self.connection</div>
<div class="line"><span class="lineno"> 1507</span>        converters = list(converters.items())</div>
<div class="line"><span class="lineno"> 1508</span>        <span class="keywordflow">for</span> row <span class="keywordflow">in</span> map(list, rows):</div>
<div class="line"><span class="lineno"> 1509</span>            <span class="keywordflow">for</span> pos, (convs, expression) <span class="keywordflow">in</span> converters:</div>
<div class="line"><span class="lineno"> 1510</span>                value = row[pos]</div>
<div class="line"><span class="lineno"> 1511</span>                <span class="keywordflow">for</span> converter <span class="keywordflow">in</span> convs:</div>
<div class="line"><span class="lineno"> 1512</span>                    value = converter(value, expression, connection)</div>
<div class="line"><span class="lineno"> 1513</span>                row[pos] = value</div>
<div class="line"><span class="lineno"> 1514</span>            <span class="keywordflow">yield</span> row</div>
<div class="line"><span class="lineno"> 1515</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01825">django.db.models.sql.compiler.SQLInsertCompiler.execute_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01522">results_iter()</a>.</p>

</div>
</div>
<a id="a3918d4acd4c4e25eaf039479facdc7db" name="a3918d4acd4c4e25eaf039479facdc7db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3918d4acd4c4e25eaf039479facdc7db">&#9670;&#160;</a></span>as_sql()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.as_sql </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>with_limits</em></span><span class="paramdefsep"> = </span><span class="paramdefval">True</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>with_col_aliases</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Create the SQL for this query. Return the SQL string and list of
parameters.

If 'with_limits' is False, any limit/offset information is not included
in the query.
</pre> 
<p>Reimplemented in <a class="el" href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_delete_compiler.html#a71d0cb490cf857ffa3af19927999a391">django.db.backends.mysql.compiler.SQLDeleteCompiler</a>, <a class="el" href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_update_compiler.html#a6a7dd775b5cf1da0496f37d18d26ba8c">django.db.backends.mysql.compiler.SQLUpdateCompiler</a>, <a class="el" href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_aggregate_compiler.html#a02a1d58598346a16727d513adc5236d4">django.db.models.sql.compiler.SQLAggregateCompiler</a>, <a class="el" href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_delete_compiler.html#a2a8f42bcd6e5d28c6c4645e5f2ce3b17">django.db.models.sql.compiler.SQLDeleteCompiler</a>, <a class="el" href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_insert_compiler.html#ae612f9bb390c7242417bb6237a93835d">django.db.models.sql.compiler.SQLInsertCompiler</a>, and <a class="el" href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_update_compiler.html#ac3739d321fa085552f9cf39416522f73">django.db.models.sql.compiler.SQLUpdateCompiler</a>.</p>

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">736</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  736</span>    <span class="keyword">def </span>as_sql(self, with_limits=True, with_col_aliases=False):</div>
<div class="line"><span class="lineno">  737</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  738</span><span class="stringliteral">        Create the SQL for this query. Return the SQL string and list of</span></div>
<div class="line"><span class="lineno">  739</span><span class="stringliteral">        parameters.</span></div>
<div class="line"><span class="lineno">  740</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  741</span><span class="stringliteral">        If &#39;with_limits&#39; is False, any limit/offset information is not included</span></div>
<div class="line"><span class="lineno">  742</span><span class="stringliteral">        in the query.</span></div>
<div class="line"><span class="lineno">  743</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  744</span>        refcounts_before = self.query.alias_refcount.copy()</div>
<div class="line"><span class="lineno">  745</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  746</span>            combinator = self.query.combinator</div>
<div class="line"><span class="lineno">  747</span>            extra_select, order_by, group_by = self.pre_sql_setup(</div>
<div class="line"><span class="lineno">  748</span>                with_col_aliases=with_col_aliases <span class="keywordflow">or</span> bool(combinator),</div>
<div class="line"><span class="lineno">  749</span>            )</div>
<div class="line"><span class="lineno">  750</span>            for_update_part = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  751</span>            <span class="comment"># Is a LIMIT/OFFSET clause needed?</span></div>
<div class="line"><span class="lineno">  752</span>            with_limit_offset = with_limits <span class="keywordflow">and</span> self.query.is_sliced</div>
<div class="line"><span class="lineno">  753</span>            combinator = self.query.combinator</div>
<div class="line"><span class="lineno">  754</span>            features = self.connection.features</div>
<div class="line"><span class="lineno">  755</span>            <span class="keywordflow">if</span> combinator:</div>
<div class="line"><span class="lineno">  756</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> getattr(features, <span class="stringliteral">&quot;supports_select_{}&quot;</span>.format(combinator)):</div>
<div class="line"><span class="lineno">  757</span>                    <span class="keywordflow">raise</span> NotSupportedError(</div>
<div class="line"><span class="lineno">  758</span>                        <span class="stringliteral">&quot;{} is not supported on this database backend.&quot;</span>.format(</div>
<div class="line"><span class="lineno">  759</span>                            combinator</div>
<div class="line"><span class="lineno">  760</span>                        )</div>
<div class="line"><span class="lineno">  761</span>                    )</div>
<div class="line"><span class="lineno">  762</span>                result, params = self.get_combinator_sql(</div>
<div class="line"><span class="lineno">  763</span>                    combinator, self.query.combinator_all</div>
<div class="line"><span class="lineno">  764</span>                )</div>
<div class="line"><span class="lineno">  765</span>            <span class="keywordflow">elif</span> self.qualify:</div>
<div class="line"><span class="lineno">  766</span>                result, params = self.get_qualify_sql()</div>
<div class="line"><span class="lineno">  767</span>                order_by = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  768</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  769</span>                distinct_fields, distinct_params = self.get_distinct()</div>
<div class="line"><span class="lineno">  770</span>                <span class="comment"># This must come after &#39;select&#39;, &#39;ordering&#39;, and &#39;distinct&#39;</span></div>
<div class="line"><span class="lineno">  771</span>                <span class="comment"># (see docstring of get_from_clause() for details).</span></div>
<div class="line"><span class="lineno">  772</span>                from_, f_params = self.get_from_clause()</div>
<div class="line"><span class="lineno">  773</span>                <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  774</span>                    where, w_params = (</div>
<div class="line"><span class="lineno">  775</span>                        self.compile(self.where) <span class="keywordflow">if</span> self.where <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> (<span class="stringliteral">&quot;&quot;</span>, [])</div>
<div class="line"><span class="lineno">  776</span>                    )</div>
<div class="line"><span class="lineno">  777</span>                <span class="keywordflow">except</span> EmptyResultSet:</div>
<div class="line"><span class="lineno">  778</span>                    <span class="keywordflow">if</span> self.elide_empty:</div>
<div class="line"><span class="lineno">  779</span>                        <span class="keywordflow">raise</span></div>
<div class="line"><span class="lineno">  780</span>                    <span class="comment"># Use a predicate that&#39;s always False.</span></div>
<div class="line"><span class="lineno">  781</span>                    where, w_params = <span class="stringliteral">&quot;0 = 1&quot;</span>, []</div>
<div class="line"><span class="lineno">  782</span>                <span class="keywordflow">except</span> FullResultSet:</div>
<div class="line"><span class="lineno">  783</span>                    where, w_params = <span class="stringliteral">&quot;&quot;</span>, []</div>
<div class="line"><span class="lineno">  784</span>                <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  785</span>                    having, h_params = (</div>
<div class="line"><span class="lineno">  786</span>                        self.compile(self.having)</div>
<div class="line"><span class="lineno">  787</span>                        <span class="keywordflow">if</span> self.having <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  788</span>                        <span class="keywordflow">else</span> (<span class="stringliteral">&quot;&quot;</span>, [])</div>
<div class="line"><span class="lineno">  789</span>                    )</div>
<div class="line"><span class="lineno">  790</span>                <span class="keywordflow">except</span> FullResultSet:</div>
<div class="line"><span class="lineno">  791</span>                    having, h_params = <span class="stringliteral">&quot;&quot;</span>, []</div>
<div class="line"><span class="lineno">  792</span>                result = [<span class="stringliteral">&quot;SELECT&quot;</span>]</div>
<div class="line"><span class="lineno">  793</span>                params = []</div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>                <span class="keywordflow">if</span> self.query.distinct:</div>
<div class="line"><span class="lineno">  796</span>                    distinct_result, distinct_params = self.connection.ops.distinct_sql(</div>
<div class="line"><span class="lineno">  797</span>                        distinct_fields,</div>
<div class="line"><span class="lineno">  798</span>                        distinct_params,</div>
<div class="line"><span class="lineno">  799</span>                    )</div>
<div class="line"><span class="lineno">  800</span>                    result += distinct_result</div>
<div class="line"><span class="lineno">  801</span>                    params += distinct_params</div>
<div class="line"><span class="lineno">  802</span> </div>
<div class="line"><span class="lineno">  803</span>                out_cols = []</div>
<div class="line"><span class="lineno">  804</span>                <span class="keywordflow">for</span> _, (s_sql, s_params), alias <span class="keywordflow">in</span> self.select + extra_select:</div>
<div class="line"><span class="lineno">  805</span>                    <span class="keywordflow">if</span> alias:</div>
<div class="line"><span class="lineno">  806</span>                        s_sql = <span class="stringliteral">&quot;%s AS %s&quot;</span> % (</div>
<div class="line"><span class="lineno">  807</span>                            s_sql,</div>
<div class="line"><span class="lineno">  808</span>                            self.connection.ops.quote_name(alias),</div>
<div class="line"><span class="lineno">  809</span>                        )</div>
<div class="line"><span class="lineno">  810</span>                    params.extend(s_params)</div>
<div class="line"><span class="lineno">  811</span>                    out_cols.append(s_sql)</div>
<div class="line"><span class="lineno">  812</span> </div>
<div class="line"><span class="lineno">  813</span>                result += [<span class="stringliteral">&quot;, &quot;</span>.join(out_cols)]</div>
<div class="line"><span class="lineno">  814</span>                <span class="keywordflow">if</span> from_:</div>
<div class="line"><span class="lineno">  815</span>                    result += [<span class="stringliteral">&quot;FROM&quot;</span>, *from_]</div>
<div class="line"><span class="lineno">  816</span>                <span class="keywordflow">elif</span> self.connection.features.bare_select_suffix:</div>
<div class="line"><span class="lineno">  817</span>                    result += [self.connection.features.bare_select_suffix]</div>
<div class="line"><span class="lineno">  818</span>                params.extend(f_params)</div>
<div class="line"><span class="lineno">  819</span> </div>
<div class="line"><span class="lineno">  820</span>                <span class="keywordflow">if</span> self.query.select_for_update <span class="keywordflow">and</span> features.has_select_for_update:</div>
<div class="line"><span class="lineno">  821</span>                    <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  822</span>                        self.connection.get_autocommit()</div>
<div class="line"><span class="lineno">  823</span>                        <span class="comment"># Don&#39;t raise an exception when database doesn&#39;t</span></div>
<div class="line"><span class="lineno">  824</span>                        <span class="comment"># support transactions, as it&#39;s a noop.</span></div>
<div class="line"><span class="lineno">  825</span>                        <span class="keywordflow">and</span> features.supports_transactions</div>
<div class="line"><span class="lineno">  826</span>                    ):</div>
<div class="line"><span class="lineno">  827</span>                        <span class="keywordflow">raise</span> TransactionManagementError(</div>
<div class="line"><span class="lineno">  828</span>                            <span class="stringliteral">&quot;select_for_update cannot be used outside of a transaction.&quot;</span></div>
<div class="line"><span class="lineno">  829</span>                        )</div>
<div class="line"><span class="lineno">  830</span> </div>
<div class="line"><span class="lineno">  831</span>                    <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  832</span>                        with_limit_offset</div>
<div class="line"><span class="lineno">  833</span>                        <span class="keywordflow">and</span> <span class="keywordflow">not</span> features.supports_select_for_update_with_limit</div>
<div class="line"><span class="lineno">  834</span>                    ):</div>
<div class="line"><span class="lineno">  835</span>                        <span class="keywordflow">raise</span> NotSupportedError(</div>
<div class="line"><span class="lineno">  836</span>                            <span class="stringliteral">&quot;LIMIT/OFFSET is not supported with &quot;</span></div>
<div class="line"><span class="lineno">  837</span>                            <span class="stringliteral">&quot;select_for_update on this database backend.&quot;</span></div>
<div class="line"><span class="lineno">  838</span>                        )</div>
<div class="line"><span class="lineno">  839</span>                    nowait = self.query.select_for_update_nowait</div>
<div class="line"><span class="lineno">  840</span>                    skip_locked = self.query.select_for_update_skip_locked</div>
<div class="line"><span class="lineno">  841</span>                    of = self.query.select_for_update_of</div>
<div class="line"><span class="lineno">  842</span>                    no_key = self.query.select_for_no_key_update</div>
<div class="line"><span class="lineno">  843</span>                    <span class="comment"># If it&#39;s a NOWAIT/SKIP LOCKED/OF/NO KEY query but the</span></div>
<div class="line"><span class="lineno">  844</span>                    <span class="comment"># backend doesn&#39;t support it, raise NotSupportedError to</span></div>
<div class="line"><span class="lineno">  845</span>                    <span class="comment"># prevent a possible deadlock.</span></div>
<div class="line"><span class="lineno">  846</span>                    <span class="keywordflow">if</span> nowait <span class="keywordflow">and</span> <span class="keywordflow">not</span> features.has_select_for_update_nowait:</div>
<div class="line"><span class="lineno">  847</span>                        <span class="keywordflow">raise</span> NotSupportedError(</div>
<div class="line"><span class="lineno">  848</span>                            <span class="stringliteral">&quot;NOWAIT is not supported on this database backend.&quot;</span></div>
<div class="line"><span class="lineno">  849</span>                        )</div>
<div class="line"><span class="lineno">  850</span>                    <span class="keywordflow">elif</span> skip_locked <span class="keywordflow">and</span> <span class="keywordflow">not</span> features.has_select_for_update_skip_locked:</div>
<div class="line"><span class="lineno">  851</span>                        <span class="keywordflow">raise</span> NotSupportedError(</div>
<div class="line"><span class="lineno">  852</span>                            <span class="stringliteral">&quot;SKIP LOCKED is not supported on this database backend.&quot;</span></div>
<div class="line"><span class="lineno">  853</span>                        )</div>
<div class="line"><span class="lineno">  854</span>                    <span class="keywordflow">elif</span> of <span class="keywordflow">and</span> <span class="keywordflow">not</span> features.has_select_for_update_of:</div>
<div class="line"><span class="lineno">  855</span>                        <span class="keywordflow">raise</span> NotSupportedError(</div>
<div class="line"><span class="lineno">  856</span>                            <span class="stringliteral">&quot;FOR UPDATE OF is not supported on this database backend.&quot;</span></div>
<div class="line"><span class="lineno">  857</span>                        )</div>
<div class="line"><span class="lineno">  858</span>                    <span class="keywordflow">elif</span> no_key <span class="keywordflow">and</span> <span class="keywordflow">not</span> features.has_select_for_no_key_update:</div>
<div class="line"><span class="lineno">  859</span>                        <span class="keywordflow">raise</span> NotSupportedError(</div>
<div class="line"><span class="lineno">  860</span>                            <span class="stringliteral">&quot;FOR NO KEY UPDATE is not supported on this &quot;</span></div>
<div class="line"><span class="lineno">  861</span>                            <span class="stringliteral">&quot;database backend.&quot;</span></div>
<div class="line"><span class="lineno">  862</span>                        )</div>
<div class="line"><span class="lineno">  863</span>                    for_update_part = self.connection.ops.for_update_sql(</div>
<div class="line"><span class="lineno">  864</span>                        nowait=nowait,</div>
<div class="line"><span class="lineno">  865</span>                        skip_locked=skip_locked,</div>
<div class="line"><span class="lineno">  866</span>                        of=self.get_select_for_update_of_arguments(),</div>
<div class="line"><span class="lineno">  867</span>                        no_key=no_key,</div>
<div class="line"><span class="lineno">  868</span>                    )</div>
<div class="line"><span class="lineno">  869</span> </div>
<div class="line"><span class="lineno">  870</span>                <span class="keywordflow">if</span> for_update_part <span class="keywordflow">and</span> features.for_update_after_from:</div>
<div class="line"><span class="lineno">  871</span>                    result.append(for_update_part)</div>
<div class="line"><span class="lineno">  872</span> </div>
<div class="line"><span class="lineno">  873</span>                <span class="keywordflow">if</span> where:</div>
<div class="line"><span class="lineno">  874</span>                    result.append(<span class="stringliteral">&quot;WHERE %s&quot;</span> % where)</div>
<div class="line"><span class="lineno">  875</span>                    params.extend(w_params)</div>
<div class="line"><span class="lineno">  876</span> </div>
<div class="line"><span class="lineno">  877</span>                grouping = []</div>
<div class="line"><span class="lineno">  878</span>                <span class="keywordflow">for</span> g_sql, g_params <span class="keywordflow">in</span> group_by:</div>
<div class="line"><span class="lineno">  879</span>                    grouping.append(g_sql)</div>
<div class="line"><span class="lineno">  880</span>                    params.extend(g_params)</div>
<div class="line"><span class="lineno">  881</span>                <span class="keywordflow">if</span> grouping:</div>
<div class="line"><span class="lineno">  882</span>                    <span class="keywordflow">if</span> distinct_fields:</div>
<div class="line"><span class="lineno">  883</span>                        <span class="keywordflow">raise</span> NotImplementedError(</div>
<div class="line"><span class="lineno">  884</span>                            <span class="stringliteral">&quot;annotate() + distinct(fields) is not implemented.&quot;</span></div>
<div class="line"><span class="lineno">  885</span>                        )</div>
<div class="line"><span class="lineno">  886</span>                    order_by = order_by <span class="keywordflow">or</span> self.connection.ops.force_no_ordering()</div>
<div class="line"><span class="lineno">  887</span>                    result.append(<span class="stringliteral">&quot;GROUP BY %s&quot;</span> % <span class="stringliteral">&quot;, &quot;</span>.join(grouping))</div>
<div class="line"><span class="lineno">  888</span>                    <span class="keywordflow">if</span> self._meta_ordering:</div>
<div class="line"><span class="lineno">  889</span>                        order_by = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  890</span>                <span class="keywordflow">if</span> having:</div>
<div class="line"><span class="lineno">  891</span>                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> grouping:</div>
<div class="line"><span class="lineno">  892</span>                        result.extend(self.connection.ops.force_group_by())</div>
<div class="line"><span class="lineno">  893</span>                    result.append(<span class="stringliteral">&quot;HAVING %s&quot;</span> % having)</div>
<div class="line"><span class="lineno">  894</span>                    params.extend(h_params)</div>
<div class="line"><span class="lineno">  895</span> </div>
<div class="line"><span class="lineno">  896</span>            <span class="keywordflow">if</span> self.query.explain_info:</div>
<div class="line"><span class="lineno">  897</span>                result.insert(</div>
<div class="line"><span class="lineno">  898</span>                    0,</div>
<div class="line"><span class="lineno">  899</span>                    self.connection.ops.explain_query_prefix(</div>
<div class="line"><span class="lineno">  900</span>                        self.query.explain_info.format,</div>
<div class="line"><span class="lineno">  901</span>                        **self.query.explain_info.options,</div>
<div class="line"><span class="lineno">  902</span>                    ),</div>
<div class="line"><span class="lineno">  903</span>                )</div>
<div class="line"><span class="lineno">  904</span> </div>
<div class="line"><span class="lineno">  905</span>            <span class="keywordflow">if</span> order_by:</div>
<div class="line"><span class="lineno">  906</span>                ordering = []</div>
<div class="line"><span class="lineno">  907</span>                <span class="keywordflow">for</span> _, (o_sql, o_params, _) <span class="keywordflow">in</span> order_by:</div>
<div class="line"><span class="lineno">  908</span>                    ordering.append(o_sql)</div>
<div class="line"><span class="lineno">  909</span>                    params.extend(o_params)</div>
<div class="line"><span class="lineno">  910</span>                order_by_sql = <span class="stringliteral">&quot;ORDER BY %s&quot;</span> % <span class="stringliteral">&quot;, &quot;</span>.join(ordering)</div>
<div class="line"><span class="lineno">  911</span>                <span class="keywordflow">if</span> combinator <span class="keywordflow">and</span> features.requires_compound_order_by_subquery:</div>
<div class="line"><span class="lineno">  912</span>                    result = [<span class="stringliteral">&quot;SELECT * FROM (&quot;</span>, *result, <span class="stringliteral">&quot;)&quot;</span>, order_by_sql]</div>
<div class="line"><span class="lineno">  913</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  914</span>                    result.append(order_by_sql)</div>
<div class="line"><span class="lineno">  915</span> </div>
<div class="line"><span class="lineno">  916</span>            <span class="keywordflow">if</span> with_limit_offset:</div>
<div class="line"><span class="lineno">  917</span>                result.append(</div>
<div class="line"><span class="lineno">  918</span>                    self.connection.ops.limit_offset_sql(</div>
<div class="line"><span class="lineno">  919</span>                        self.query.low_mark, self.query.high_mark</div>
<div class="line"><span class="lineno">  920</span>                    )</div>
<div class="line"><span class="lineno">  921</span>                )</div>
<div class="line"><span class="lineno">  922</span> </div>
<div class="line"><span class="lineno">  923</span>            <span class="keywordflow">if</span> for_update_part <span class="keywordflow">and</span> <span class="keywordflow">not</span> features.for_update_after_from:</div>
<div class="line"><span class="lineno">  924</span>                result.append(for_update_part)</div>
<div class="line"><span class="lineno">  925</span> </div>
<div class="line"><span class="lineno">  926</span>            <span class="keywordflow">if</span> self.query.subquery <span class="keywordflow">and</span> extra_select:</div>
<div class="line"><span class="lineno">  927</span>                <span class="comment"># If the query is used as a subquery, the extra selects would</span></div>
<div class="line"><span class="lineno">  928</span>                <span class="comment"># result in more columns than the left-hand side expression is</span></div>
<div class="line"><span class="lineno">  929</span>                <span class="comment"># expecting. This can happen when a subquery uses a combination</span></div>
<div class="line"><span class="lineno">  930</span>                <span class="comment"># of order_by() and distinct(), forcing the ordering expressions</span></div>
<div class="line"><span class="lineno">  931</span>                <span class="comment"># to be selected as well. Wrap the query in another subquery</span></div>
<div class="line"><span class="lineno">  932</span>                <span class="comment"># to exclude extraneous selects.</span></div>
<div class="line"><span class="lineno">  933</span>                sub_selects = []</div>
<div class="line"><span class="lineno">  934</span>                sub_params = []</div>
<div class="line"><span class="lineno">  935</span>                <span class="keywordflow">for</span> index, (select, _, alias) <span class="keywordflow">in</span> enumerate(self.select, start=1):</div>
<div class="line"><span class="lineno">  936</span>                    <span class="keywordflow">if</span> alias:</div>
<div class="line"><span class="lineno">  937</span>                        sub_selects.append(</div>
<div class="line"><span class="lineno">  938</span>                            <span class="stringliteral">&quot;%s.%s&quot;</span></div>
<div class="line"><span class="lineno">  939</span>                            % (</div>
<div class="line"><span class="lineno">  940</span>                                self.connection.ops.quote_name(<span class="stringliteral">&quot;subquery&quot;</span>),</div>
<div class="line"><span class="lineno">  941</span>                                self.connection.ops.quote_name(alias),</div>
<div class="line"><span class="lineno">  942</span>                            )</div>
<div class="line"><span class="lineno">  943</span>                        )</div>
<div class="line"><span class="lineno">  944</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  945</span>                        select_clone = select.relabeled_clone(</div>
<div class="line"><span class="lineno">  946</span>                            {select.alias: <span class="stringliteral">&quot;subquery&quot;</span>}</div>
<div class="line"><span class="lineno">  947</span>                        )</div>
<div class="line"><span class="lineno">  948</span>                        subselect, subparams = select_clone.as_sql(</div>
<div class="line"><span class="lineno">  949</span>                            self, self.connection</div>
<div class="line"><span class="lineno">  950</span>                        )</div>
<div class="line"><span class="lineno">  951</span>                        sub_selects.append(subselect)</div>
<div class="line"><span class="lineno">  952</span>                        sub_params.extend(subparams)</div>
<div class="line"><span class="lineno">  953</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;SELECT %s FROM (%s) subquery&quot;</span> % (</div>
<div class="line"><span class="lineno">  954</span>                    <span class="stringliteral">&quot;, &quot;</span>.join(sub_selects),</div>
<div class="line"><span class="lineno">  955</span>                    <span class="stringliteral">&quot; &quot;</span>.join(result),</div>
<div class="line"><span class="lineno">  956</span>                ), tuple(sub_params + params)</div>
<div class="line"><span class="lineno">  957</span> </div>
<div class="line"><span class="lineno">  958</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot; &quot;</span>.join(result), tuple(params)</div>
<div class="line"><span class="lineno">  959</span>        <span class="keywordflow">finally</span>:</div>
<div class="line"><span class="lineno">  960</span>            <span class="comment"># Finally do cleanup - get rid of the joins we created above.</span></div>
<div class="line"><span class="lineno">  961</span>            self.query.reset_refcounts(refcounts_before)</div>
<div class="line"><span class="lineno">  962</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l00061">_meta_ordering</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00052">elide_empty</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00560">get_combinator_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01013">get_distinct()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01119">get_from_clause()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01389">get_select_for_update_of_arguments()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">having</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00078">pre_sql_setup()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">qualify</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00020">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00099">django.contrib.gis.db.backends.oracle.operations.OracleOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2postgis_2operations_8py_source.html#l00167">django.contrib.gis.db.backends.postgis.operations.PostGISOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00066">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.select</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00058">select</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">where</a>.</p>

<p class="reference">Referenced by <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00028">django.db.models.expressions.SQLiteNumericMixin.as_sqlite()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00007">django.db.backends.mysql.compiler.SQLCompiler.as_subquery_condition()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01610">as_subquery_condition()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01546">execute_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01825">django.db.models.sql.compiler.SQLInsertCompiler.execute_sql()</a>.</p>

</div>
</div>
<a id="a78bdce11e05140ed74db8f5463bedfce" name="a78bdce11e05140ed74db8f5463bedfce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78bdce11e05140ed74db8f5463bedfce">&#9670;&#160;</a></span>as_subquery_condition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.as_subquery_condition </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>alias</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>columns</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>compiler</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reimplemented in <a class="el" href="classdjango_1_1db_1_1backends_1_1mysql_1_1compiler_1_1_s_q_l_compiler.html#ab79da4712a24ed75ce13002a54fe8d46">django.db.backends.mysql.compiler.SQLCompiler</a>.</p>

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01610">1610</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1610</span>    <span class="keyword">def </span>as_subquery_condition(self, alias, columns, compiler):</div>
<div class="line"><span class="lineno"> 1611</span>        qn = compiler.quote_name_unless_alias</div>
<div class="line"><span class="lineno"> 1612</span>        qn2 = self.connection.ops.quote_name</div>
<div class="line"><span class="lineno"> 1613</span> </div>
<div class="line"><span class="lineno"> 1614</span>        <span class="keywordflow">for</span> index, select_col <span class="keywordflow">in</span> enumerate(self.query.select):</div>
<div class="line"><span class="lineno"> 1615</span>            lhs_sql, lhs_params = self.compile(select_col)</div>
<div class="line"><span class="lineno"> 1616</span>            rhs = <span class="stringliteral">&quot;%s.%s&quot;</span> % (qn(alias), qn2(columns[index]))</div>
<div class="line"><span class="lineno"> 1617</span>            self.query.where.add(RawSQL(<span class="stringliteral">&quot;%s = %s&quot;</span> % (lhs_sql, rhs), lhs_params), AND)</div>
<div class="line"><span class="lineno"> 1618</span> </div>
<div class="line"><span class="lineno"> 1619</span>        sql, params = self.as_sql()</div>
<div class="line"><span class="lineno"> 1620</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;EXISTS (%s)&quot;</span> % sql, params</div>
<div class="line"><span class="lineno"> 1621</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00052">django.contrib.gis.db.backends.oracle.operations.SDORelate.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2backends_2postgis_2operations_8py_source.html#l00040">django.contrib.gis.db.backends.postgis.operations.PostGISOperator.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00020">django.contrib.gis.db.backends.spatialite.operations.SpatialiteNullCheckOperator.as_sql()</a>, <a class="el" href="_e_n_v_2_lib_2site-packages_2django_2contrib_2gis_2db_2backends_2utils_8py_source.html#l00025">django.contrib.gis.db.backends.utils.SpatialOperator.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2aggregates_8py_source.html#l00021">django.contrib.gis.db.models.aggregates.GeoAggregate.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2functions_8py_source.html#l00164">django.contrib.gis.db.models.functions.Area.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2functions_8py_source.html#l00065">django.contrib.gis.db.models.functions.GeoFuncMixin.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2functions_8py_source.html#l00445">django.contrib.gis.db.models.functions.Length.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2lookups_8py_source.html#l00359">django.contrib.gis.db.models.lookups.DistanceLookupFromFunction.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2lookups_8py_source.html#l00078">django.contrib.gis.db.models.lookups.GISLookup.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2lookups_8py_source.html#l00010">django.contrib.gis.db.models.lookups.RasterBandTransform.as_sql()</a>, <a class="el" href="contrib_2postgres_2aggregates_2mixins_8py_source.html#l00027">django.contrib.postgres.aggregates.mixins.OrderableAggMixin.as_sql()</a>, <a class="el" href="fields_2array_8py_source.html#l00300">django.contrib.postgres.fields.array.ArrayLenTransform.as_sql()</a>, <a class="el" href="fields_2array_8py_source.html#l00332">django.contrib.postgres.fields.array.IndexTransform.as_sql()</a>, <a class="el" href="fields_2array_8py_source.html#l00358">django.contrib.postgres.fields.array.SliceTransform.as_sql()</a>, <a class="el" href="fields_2hstore_8py_source.html#l00088">django.contrib.postgres.fields.hstore.KeyTransform.as_sql()</a>, <a class="el" href="fields_2ranges_8py_source.html#l00036">django.contrib.postgres.fields.ranges.RangeBoundary.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00066">django.contrib.postgres.search.SearchConfig.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00317">django.contrib.postgres.search.SearchHeadline.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00218">django.contrib.postgres.search.SearchQuery.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00114">django.contrib.postgres.search.SearchVector.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00025">django.contrib.postgres.search.SearchVectorExact.as_sql()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00026">django.db.backends.mysql.compiler.SQLDeleteCompiler.as_sql()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00056">django.db.backends.mysql.compiler.SQLUpdateCompiler.as_sql()</a>, <a class="el" href="db_2models_2aggregates_8py_source.html#l00117">django.db.models.aggregates.Aggregate.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00218">django.db.models.expressions.BaseExpression.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01644">django.db.models.expressions.Case.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01306">django.db.models.expressions.Col.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00736">django.db.models.expressions.CombinedExpression.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01285">django.db.models.expressions.DatabaseDefault.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00814">django.db.models.expressions.DurationExpression.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01756">django.db.models.expressions.Exists.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01383">django.db.models.expressions.ExpressionList.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01441">django.db.models.expressions.ExpressionWrapper.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01086">django.db.models.expressions.Func.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01461">django.db.models.expressions.NegatedExpression.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01795">django.db.models.expressions.OrderBy.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01221">django.db.models.expressions.RawSQL.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01364">django.db.models.expressions.Ref.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00927">django.db.models.expressions.ResolvedOuterRef.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01248">django.db.models.expressions.Star.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01725">django.db.models.expressions.Subquery.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00859">django.db.models.expressions.TemporalSubtraction.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01152">django.db.models.expressions.Value.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01556">django.db.models.expressions.When.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01914">django.db.models.expressions.Window.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l02019">django.db.models.expressions.WindowFrame.as_sql()</a>, <a class="el" href="django_2db_2models_2fields_2json_8py_source.html#l00178">django.db.models.fields.json.ContainedBy.as_sql()</a>, <a class="el" href="django_2db_2models_2fields_2json_8py_source.html#l00163">django.db.models.fields.json.DataContains.as_sql()</a>, <a class="el" href="django_2db_2models_2fields_2json_8py_source.html#l00196">django.db.models.fields.json.HasKeyLookup.as_sql()</a>, <a class="el" href="related__lookups_8py_source.html#l00100">django.db.models.fields.related_lookups.RelatedIn.as_sql()</a>, <a class="el" href="related__lookups_8py_source.html#l00160">django.db.models.fields.related_lookups.RelatedLookupMixin.as_sql()</a>, <a class="el" href="comparison_8py_source.html#l00019">django.db.models.functions.comparison.Cast.as_sql()</a>, <a class="el" href="comparison_8py_source.html#l00120">django.db.models.functions.comparison.Collate.as_sql()</a>, <a class="el" href="comparison_8py_source.html#l00156">django.db.models.functions.comparison.JSONObject.as_sql()</a>, <a class="el" href="django_2db_2models_2functions_2datetime_8py_source.html#l00053">django.db.models.functions.datetime.Extract.as_sql()</a>, <a class="el" href="django_2db_2models_2functions_2datetime_8py_source.html#l00259">django.db.models.functions.datetime.TruncBase.as_sql()</a>, <a class="el" href="django_2db_2models_2functions_2datetime_8py_source.html#l00407">django.db.models.functions.datetime.TruncDate.as_sql()</a>, <a class="el" href="django_2db_2models_2functions_2datetime_8py_source.html#l00419">django.db.models.functions.datetime.TruncTime.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00244">django.db.models.lookups.BuiltinLookup.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00371">django.db.models.lookups.Exact.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00528">django.db.models.lookups.In.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00637">django.db.models.lookups.IsNull.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00663">django.db.models.lookups.Regex.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00696">django.db.models.lookups.YearLookup.as_sql()</a>, <a class="el" href="query__utils_8py_source.html#l00485">django.db.models.query_utils.FilteredRelation.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00035">django.db.models.sql.compiler.PositionRef.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

</div>
</div>
<a id="aeb77eb703de6a68ffbbf0e3bfc75fff3" name="aeb77eb703de6a68ffbbf0e3bfc75fff3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb77eb703de6a68ffbbf0e3bfc75fff3">&#9670;&#160;</a></span>collapse_group_by()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.collapse_group_by </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>expressions</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>having</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00197">197</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  197</span>    <span class="keyword">def </span>collapse_group_by(self, expressions, having):</div>
<div class="line"><span class="lineno">  198</span>        <span class="comment"># If the database supports group by functional dependence reduction,</span></div>
<div class="line"><span class="lineno">  199</span>        <span class="comment"># then the expressions can be reduced to the set of selected table</span></div>
<div class="line"><span class="lineno">  200</span>        <span class="comment"># primary keys as all other columns are functionally dependent on them.</span></div>
<div class="line"><span class="lineno">  201</span>        <span class="keywordflow">if</span> self.connection.features.allows_group_by_selected_pks:</div>
<div class="line"><span class="lineno">  202</span>            <span class="comment"># Filter out all expressions associated with a table&#39;s primary key</span></div>
<div class="line"><span class="lineno">  203</span>            <span class="comment"># present in the grouped columns. This is done by identifying all</span></div>
<div class="line"><span class="lineno">  204</span>            <span class="comment"># tables that have their primary key included in the grouped</span></div>
<div class="line"><span class="lineno">  205</span>            <span class="comment"># columns and removing non-primary key columns referring to them.</span></div>
<div class="line"><span class="lineno">  206</span>            <span class="comment"># Unmanaged models are excluded because they could be representing</span></div>
<div class="line"><span class="lineno">  207</span>            <span class="comment"># database views on which the optimization might not be allowed.</span></div>
<div class="line"><span class="lineno">  208</span>            pks = {</div>
<div class="line"><span class="lineno">  209</span>                expr</div>
<div class="line"><span class="lineno">  210</span>                <span class="keywordflow">for</span> expr <span class="keywordflow">in</span> expressions</div>
<div class="line"><span class="lineno">  211</span>                <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  212</span>                    hasattr(expr, <span class="stringliteral">&quot;target&quot;</span>)</div>
<div class="line"><span class="lineno">  213</span>                    <span class="keywordflow">and</span> expr.target.primary_key</div>
<div class="line"><span class="lineno">  214</span>                    <span class="keywordflow">and</span> self.connection.features.allows_group_by_selected_pks_on_model(</div>
<div class="line"><span class="lineno">  215</span>                        expr.target.model</div>
<div class="line"><span class="lineno">  216</span>                    )</div>
<div class="line"><span class="lineno">  217</span>                )</div>
<div class="line"><span class="lineno">  218</span>            }</div>
<div class="line"><span class="lineno">  219</span>            aliases = {expr.alias <span class="keywordflow">for</span> expr <span class="keywordflow">in</span> pks}</div>
<div class="line"><span class="lineno">  220</span>            expressions = [</div>
<div class="line"><span class="lineno">  221</span>                expr</div>
<div class="line"><span class="lineno">  222</span>                <span class="keywordflow">for</span> expr <span class="keywordflow">in</span> expressions</div>
<div class="line"><span class="lineno">  223</span>                <span class="keywordflow">if</span> expr <span class="keywordflow">in</span> pks</div>
<div class="line"><span class="lineno">  224</span>                <span class="keywordflow">or</span> expr <span class="keywordflow">in</span> having</div>
<div class="line"><span class="lineno">  225</span>                <span class="keywordflow">or</span> getattr(expr, <span class="stringliteral">&quot;alias&quot;</span>, <span class="keywordtype">None</span>) <span class="keywordflow">not</span> <span class="keywordflow">in</span> aliases</div>
<div class="line"><span class="lineno">  226</span>            ]</div>
<div class="line"><span class="lineno">  227</span>        <span class="keywordflow">return</span> expressions</div>
<div class="line"><span class="lineno">  228</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00094">get_group_by()</a>.</p>

</div>
</div>
<a id="aa04036f15ac7916f9be1c43e8ace807a" name="aa04036f15ac7916f9be1c43e8ace807a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa04036f15ac7916f9be1c43e8ace807a">&#9670;&#160;</a></span>compile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.compile </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>node</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">552</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  552</span>    <span class="keyword">def </span>compile(self, node):</div>
<div class="line"><span class="lineno">  553</span>        vendor_impl = getattr(node, <span class="stringliteral">&quot;as_&quot;</span> + self.connection.vendor, <span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">  554</span>        <span class="keywordflow">if</span> vendor_impl:</div>
<div class="line"><span class="lineno">  555</span>            sql, params = vendor_impl(self, self.connection)</div>
<div class="line"><span class="lineno">  556</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  557</span>            sql, params = node.as_sql(self, self.connection)</div>
<div class="line"><span class="lineno">  558</span>        <span class="keywordflow">return</span> sql, params</div>
<div class="line"><span class="lineno">  559</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01898">django.db.models.sql.compiler.SQLDeleteCompiler._as_sql()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00026">django.db.backends.mysql.compiler.SQLDeleteCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l02082">django.db.models.sql.compiler.SQLAggregateCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01932">django.db.models.sql.compiler.SQLUpdateCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01610">as_subquery_condition()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01640">django.db.models.sql.compiler.SQLInsertCompiler.field_as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01013">get_distinct()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01119">get_from_clause()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00094">get_group_by()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00459">get_order_by()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00229">get_select()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01389">get_select_for_update_of_arguments()</a>, and <a class="el" href="_font_file_8py_source.html#l00113">PIL.FontFile.FontFile.save()</a>.</p>

</div>
</div>
<a id="a07cbbc7958a72203f8ebe9ba29b9356f" name="a07cbbc7958a72203f8ebe9ba29b9356f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07cbbc7958a72203f8ebe9ba29b9356f">&#9670;&#160;</a></span>execute_sql()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.execute_sql </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>result_type</em></span><span class="paramdefsep"> = </span><span class="paramdefval">MULTI</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>chunked_fetch</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>chunk_size</em></span><span class="paramdefsep"> = </span><span class="paramdefval">GET_ITERATOR_CHUNK_SIZE</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Run the query against the database and return the result(s). The
return value is a single data item if result_type is SINGLE, or an
iterator over the results if the result_type is MULTI.

result_type is either MULTI (use fetchmany() to retrieve all rows),
SINGLE (only retrieve a single row), or None. In this last case, the
cursor is returned if any query is executed, since it's used by
subclasses such as InsertQuery). It's possible, however, that no query
is needed, as the filters describe an empty set. In that case, None is
returned, to avoid any unnecessary database interaction.
</pre> 
<p>Reimplemented in <a class="el" href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_insert_compiler.html#a59b977e6c439adafa1c3b0092dd7074f">django.db.models.sql.compiler.SQLInsertCompiler</a>, and <a class="el" href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_update_compiler.html#a84724c5297d03c262688a039f6b41b63">django.db.models.sql.compiler.SQLUpdateCompiler</a>.</p>

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01544">1544</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1546</span>    ):</div>
<div class="line"><span class="lineno"> 1547</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1548</span><span class="stringliteral">        Run the query against the database and return the result(s). The</span></div>
<div class="line"><span class="lineno"> 1549</span><span class="stringliteral">        return value is a single data item if result_type is SINGLE, or an</span></div>
<div class="line"><span class="lineno"> 1550</span><span class="stringliteral">        iterator over the results if the result_type is MULTI.</span></div>
<div class="line"><span class="lineno"> 1551</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno"> 1552</span><span class="stringliteral">        result_type is either MULTI (use fetchmany() to retrieve all rows),</span></div>
<div class="line"><span class="lineno"> 1553</span><span class="stringliteral">        SINGLE (only retrieve a single row), or None. In this last case, the</span></div>
<div class="line"><span class="lineno"> 1554</span><span class="stringliteral">        cursor is returned if any query is executed, since it&#39;s used by</span></div>
<div class="line"><span class="lineno"> 1555</span><span class="stringliteral">        subclasses such as InsertQuery). It&#39;s possible, however, that no query</span></div>
<div class="line"><span class="lineno"> 1556</span><span class="stringliteral">        is needed, as the filters describe an empty set. In that case, None is</span></div>
<div class="line"><span class="lineno"> 1557</span><span class="stringliteral">        returned, to avoid any unnecessary database interaction.</span></div>
<div class="line"><span class="lineno"> 1558</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1559</span>        result_type = result_type <span class="keywordflow">or</span> NO_RESULTS</div>
<div class="line"><span class="lineno"> 1560</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno"> 1561</span>            sql, params = self.as_sql()</div>
<div class="line"><span class="lineno"> 1562</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> sql:</div>
<div class="line"><span class="lineno"> 1563</span>                <span class="keywordflow">raise</span> EmptyResultSet</div>
<div class="line"><span class="lineno"> 1564</span>        <span class="keywordflow">except</span> EmptyResultSet:</div>
<div class="line"><span class="lineno"> 1565</span>            <span class="keywordflow">if</span> result_type == MULTI:</div>
<div class="line"><span class="lineno"> 1566</span>                <span class="keywordflow">return</span> iter([])</div>
<div class="line"><span class="lineno"> 1567</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1568</span>                <span class="keywordflow">return</span></div>
<div class="line"><span class="lineno"> 1569</span>        <span class="keywordflow">if</span> chunked_fetch:</div>
<div class="line"><span class="lineno"> 1570</span>            cursor = self.connection.chunked_cursor()</div>
<div class="line"><span class="lineno"> 1571</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1572</span>            cursor = self.connection.cursor()</div>
<div class="line"><span class="lineno"> 1573</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno"> 1574</span>            cursor.execute(sql, params)</div>
<div class="line"><span class="lineno"> 1575</span>        <span class="keywordflow">except</span> Exception:</div>
<div class="line"><span class="lineno"> 1576</span>            <span class="comment"># Might fail for server-side cursors (e.g. connection closed)</span></div>
<div class="line"><span class="lineno"> 1577</span>            cursor.close()</div>
<div class="line"><span class="lineno"> 1578</span>            <span class="keywordflow">raise</span></div>
<div class="line"><span class="lineno"> 1579</span> </div>
<div class="line"><span class="lineno"> 1580</span>        <span class="keywordflow">if</span> result_type == CURSOR:</div>
<div class="line"><span class="lineno"> 1581</span>            <span class="comment"># Give the caller the cursor to process and close.</span></div>
<div class="line"><span class="lineno"> 1582</span>            <span class="keywordflow">return</span> cursor</div>
<div class="line"><span class="lineno"> 1583</span>        <span class="keywordflow">if</span> result_type == SINGLE:</div>
<div class="line"><span class="lineno"> 1584</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno"> 1585</span>                val = cursor.fetchone()</div>
<div class="line"><span class="lineno"> 1586</span>                <span class="keywordflow">if</span> val:</div>
<div class="line"><span class="lineno"> 1587</span>                    <span class="keywordflow">return</span> val[0 : self.col_count]</div>
<div class="line"><span class="lineno"> 1588</span>                <span class="keywordflow">return</span> val</div>
<div class="line"><span class="lineno"> 1589</span>            <span class="keywordflow">finally</span>:</div>
<div class="line"><span class="lineno"> 1590</span>                <span class="comment"># done with the cursor</span></div>
<div class="line"><span class="lineno"> 1591</span>                cursor.close()</div>
<div class="line"><span class="lineno"> 1592</span>        <span class="keywordflow">if</span> result_type == NO_RESULTS:</div>
<div class="line"><span class="lineno"> 1593</span>            cursor.close()</div>
<div class="line"><span class="lineno"> 1594</span>            <span class="keywordflow">return</span></div>
<div class="line"><span class="lineno"> 1595</span> </div>
<div class="line"><span class="lineno"> 1596</span>        result = cursor_iter(</div>
<div class="line"><span class="lineno"> 1597</span>            cursor,</div>
<div class="line"><span class="lineno"> 1598</span>            self.connection.features.empty_fetchmany_value,</div>
<div class="line"><span class="lineno"> 1599</span>            self.col_count <span class="keywordflow">if</span> self.has_extra_select <span class="keywordflow">else</span> <span class="keywordtype">None</span>,</div>
<div class="line"><span class="lineno"> 1600</span>            chunk_size,</div>
<div class="line"><span class="lineno"> 1601</span>        )</div>
<div class="line"><span class="lineno"> 1602</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> chunked_fetch <span class="keywordflow">or</span> <span class="keywordflow">not</span> self.connection.features.can_use_chunked_reads:</div>
<div class="line"><span class="lineno"> 1603</span>            <span class="comment"># If we are using non-chunked reads, we return the same data</span></div>
<div class="line"><span class="lineno"> 1604</span>            <span class="comment"># structure as normally, but ensure it is all read into memory</span></div>
<div class="line"><span class="lineno"> 1605</span>            <span class="comment"># before going any further. Use chunked_fetch if requested,</span></div>
<div class="line"><span class="lineno"> 1606</span>            <span class="comment"># unless the database doesn&#39;t support it.</span></div>
<div class="line"><span class="lineno"> 1607</span>            <span class="keywordflow">return</span> list(result)</div>
<div class="line"><span class="lineno"> 1608</span>        <span class="keywordflow">return</span> result</div>
<div class="line"><span class="lineno"> 1609</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00052">django.contrib.gis.db.backends.oracle.operations.SDORelate.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2backends_2postgis_2operations_8py_source.html#l00040">django.contrib.gis.db.backends.postgis.operations.PostGISOperator.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00020">django.contrib.gis.db.backends.spatialite.operations.SpatialiteNullCheckOperator.as_sql()</a>, <a class="el" href="_e_n_v_2_lib_2site-packages_2django_2contrib_2gis_2db_2backends_2utils_8py_source.html#l00025">django.contrib.gis.db.backends.utils.SpatialOperator.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2aggregates_8py_source.html#l00021">django.contrib.gis.db.models.aggregates.GeoAggregate.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2functions_8py_source.html#l00164">django.contrib.gis.db.models.functions.Area.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2functions_8py_source.html#l00065">django.contrib.gis.db.models.functions.GeoFuncMixin.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2functions_8py_source.html#l00445">django.contrib.gis.db.models.functions.Length.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2lookups_8py_source.html#l00359">django.contrib.gis.db.models.lookups.DistanceLookupFromFunction.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2lookups_8py_source.html#l00078">django.contrib.gis.db.models.lookups.GISLookup.as_sql()</a>, <a class="el" href="contrib_2gis_2db_2models_2lookups_8py_source.html#l00010">django.contrib.gis.db.models.lookups.RasterBandTransform.as_sql()</a>, <a class="el" href="contrib_2postgres_2aggregates_2mixins_8py_source.html#l00027">django.contrib.postgres.aggregates.mixins.OrderableAggMixin.as_sql()</a>, <a class="el" href="fields_2array_8py_source.html#l00300">django.contrib.postgres.fields.array.ArrayLenTransform.as_sql()</a>, <a class="el" href="fields_2array_8py_source.html#l00332">django.contrib.postgres.fields.array.IndexTransform.as_sql()</a>, <a class="el" href="fields_2array_8py_source.html#l00358">django.contrib.postgres.fields.array.SliceTransform.as_sql()</a>, <a class="el" href="fields_2hstore_8py_source.html#l00088">django.contrib.postgres.fields.hstore.KeyTransform.as_sql()</a>, <a class="el" href="fields_2ranges_8py_source.html#l00036">django.contrib.postgres.fields.ranges.RangeBoundary.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00066">django.contrib.postgres.search.SearchConfig.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00317">django.contrib.postgres.search.SearchHeadline.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00218">django.contrib.postgres.search.SearchQuery.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00114">django.contrib.postgres.search.SearchVector.as_sql()</a>, <a class="el" href="django_2contrib_2postgres_2search_8py_source.html#l00025">django.contrib.postgres.search.SearchVectorExact.as_sql()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00026">django.db.backends.mysql.compiler.SQLDeleteCompiler.as_sql()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00056">django.db.backends.mysql.compiler.SQLUpdateCompiler.as_sql()</a>, <a class="el" href="db_2models_2aggregates_8py_source.html#l00117">django.db.models.aggregates.Aggregate.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00218">django.db.models.expressions.BaseExpression.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01644">django.db.models.expressions.Case.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01306">django.db.models.expressions.Col.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00736">django.db.models.expressions.CombinedExpression.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01285">django.db.models.expressions.DatabaseDefault.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00814">django.db.models.expressions.DurationExpression.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01756">django.db.models.expressions.Exists.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01383">django.db.models.expressions.ExpressionList.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01441">django.db.models.expressions.ExpressionWrapper.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01086">django.db.models.expressions.Func.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01461">django.db.models.expressions.NegatedExpression.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01795">django.db.models.expressions.OrderBy.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01221">django.db.models.expressions.RawSQL.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01364">django.db.models.expressions.Ref.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00927">django.db.models.expressions.ResolvedOuterRef.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01248">django.db.models.expressions.Star.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01725">django.db.models.expressions.Subquery.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00859">django.db.models.expressions.TemporalSubtraction.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01152">django.db.models.expressions.Value.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01556">django.db.models.expressions.When.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01914">django.db.models.expressions.Window.as_sql()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l02019">django.db.models.expressions.WindowFrame.as_sql()</a>, <a class="el" href="django_2db_2models_2fields_2json_8py_source.html#l00178">django.db.models.fields.json.ContainedBy.as_sql()</a>, <a class="el" href="django_2db_2models_2fields_2json_8py_source.html#l00163">django.db.models.fields.json.DataContains.as_sql()</a>, <a class="el" href="django_2db_2models_2fields_2json_8py_source.html#l00196">django.db.models.fields.json.HasKeyLookup.as_sql()</a>, <a class="el" href="related__lookups_8py_source.html#l00100">django.db.models.fields.related_lookups.RelatedIn.as_sql()</a>, <a class="el" href="related__lookups_8py_source.html#l00160">django.db.models.fields.related_lookups.RelatedLookupMixin.as_sql()</a>, <a class="el" href="comparison_8py_source.html#l00019">django.db.models.functions.comparison.Cast.as_sql()</a>, <a class="el" href="comparison_8py_source.html#l00120">django.db.models.functions.comparison.Collate.as_sql()</a>, <a class="el" href="comparison_8py_source.html#l00156">django.db.models.functions.comparison.JSONObject.as_sql()</a>, <a class="el" href="django_2db_2models_2functions_2datetime_8py_source.html#l00053">django.db.models.functions.datetime.Extract.as_sql()</a>, <a class="el" href="django_2db_2models_2functions_2datetime_8py_source.html#l00259">django.db.models.functions.datetime.TruncBase.as_sql()</a>, <a class="el" href="django_2db_2models_2functions_2datetime_8py_source.html#l00407">django.db.models.functions.datetime.TruncDate.as_sql()</a>, <a class="el" href="django_2db_2models_2functions_2datetime_8py_source.html#l00419">django.db.models.functions.datetime.TruncTime.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00244">django.db.models.lookups.BuiltinLookup.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00371">django.db.models.lookups.Exact.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00528">django.db.models.lookups.In.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00637">django.db.models.lookups.IsNull.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00663">django.db.models.lookups.Regex.as_sql()</a>, <a class="el" href="db_2models_2lookups_8py_source.html#l00696">django.db.models.lookups.YearLookup.as_sql()</a>, <a class="el" href="query__utils_8py_source.html#l00485">django.db.models.query_utils.FilteredRelation.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00035">django.db.models.sql.compiler.PositionRef.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00076">col_count</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l02106">django.db.models.sql.compiler.cursor_iter()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00090">has_extra_select</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01622">explain_query()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01537">has_results()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01522">results_iter()</a>.</p>

</div>
</div>
<a id="ae37702aee3a2c220b0d45022bece3120" name="ae37702aee3a2c220b0d45022bece3120"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae37702aee3a2c220b0d45022bece3120">&#9670;&#160;</a></span>explain_query()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.explain_query </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01622">1622</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1622</span>    <span class="keyword">def </span>explain_query(self):</div>
<div class="line"><span class="lineno"> 1623</span>        result = list(self.execute_sql())</div>
<div class="line"><span class="lineno"> 1624</span>        <span class="comment"># Some backends return 1 item tuples with strings, and others return</span></div>
<div class="line"><span class="lineno"> 1625</span>        <span class="comment"># tuples with integers and strings. Flatten them out into strings.</span></div>
<div class="line"><span class="lineno"> 1626</span>        format_ = self.query.explain_info.format</div>
<div class="line"><span class="lineno"> 1627</span>        output_formatter = json.dumps <span class="keywordflow">if</span> format_ <span class="keywordflow">and</span> format_.lower() == <span class="stringliteral">&quot;json&quot;</span> <span class="keywordflow">else</span> str</div>
<div class="line"><span class="lineno"> 1628</span>        <span class="keywordflow">for</span> row <span class="keywordflow">in</span> result:</div>
<div class="line"><span class="lineno"> 1629</span>            <span class="keywordflow">for</span> value <span class="keywordflow">in</span> row:</div>
<div class="line"><span class="lineno"> 1630</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(value, str):</div>
<div class="line"><span class="lineno"> 1631</span>                    <span class="keywordflow">yield</span> <span class="stringliteral">&quot; &quot;</span>.join([output_formatter(c) <span class="keywordflow">for</span> c <span class="keywordflow">in</span> value])</div>
<div class="line"><span class="lineno"> 1632</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1633</span>                    <span class="keywordflow">yield</span> value</div>
<div class="line"><span class="lineno"> 1634</span> </div>
<div class="line"><span class="lineno"> 1635</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l01546">execute_sql()</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

</div>
</div>
<a id="af700709c03bb6c5cd212d3602e909e3a" name="af700709c03bb6c5cd212d3602e909e3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af700709c03bb6c5cd212d3602e909e3a">&#9670;&#160;</a></span>find_ordering_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.find_ordering_name </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>opts</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>alias</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>default_order</em></span><span class="paramdefsep"> = </span><span class="paramdefval">&quot;ASC&quot;</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>already_seen</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return the table alias (the name might be ambiguous, the alias will
not be) and column name for ordering by the given 'name' parameter.
The 'name' is of the form 'field1__field2__...__fieldN'.
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01039">1039</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1041</span>    ):</div>
<div class="line"><span class="lineno"> 1042</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1043</span><span class="stringliteral">        Return the table alias (the name might be ambiguous, the alias will</span></div>
<div class="line"><span class="lineno"> 1044</span><span class="stringliteral">        not be) and column name for ordering by the given &#39;name&#39; parameter.</span></div>
<div class="line"><span class="lineno"> 1045</span><span class="stringliteral">        The &#39;name&#39; is of the form &#39;field1__field2__...__fieldN&#39;.</span></div>
<div class="line"><span class="lineno"> 1046</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1047</span>        name, order = get_order_dir(name, default_order)</div>
<div class="line"><span class="lineno"> 1048</span>        descending = order == <span class="stringliteral">&quot;DESC&quot;</span></div>
<div class="line"><span class="lineno"> 1049</span>        pieces = name.split(LOOKUP_SEP)</div>
<div class="line"><span class="lineno"> 1050</span>        (</div>
<div class="line"><span class="lineno"> 1051</span>            field,</div>
<div class="line"><span class="lineno"> 1052</span>            targets,</div>
<div class="line"><span class="lineno"> 1053</span>            alias,</div>
<div class="line"><span class="lineno"> 1054</span>            joins,</div>
<div class="line"><span class="lineno"> 1055</span>            path,</div>
<div class="line"><span class="lineno"> 1056</span>            opts,</div>
<div class="line"><span class="lineno"> 1057</span>            transform_function,</div>
<div class="line"><span class="lineno"> 1058</span>        ) = self._setup_joins(pieces, opts, alias)</div>
<div class="line"><span class="lineno"> 1059</span> </div>
<div class="line"><span class="lineno"> 1060</span>        <span class="comment"># If we get to this point and the field is a relation to another model,</span></div>
<div class="line"><span class="lineno"> 1061</span>        <span class="comment"># append the default ordering for that model unless it is the pk</span></div>
<div class="line"><span class="lineno"> 1062</span>        <span class="comment"># shortcut or the attribute name of the field that is specified or</span></div>
<div class="line"><span class="lineno"> 1063</span>        <span class="comment"># there are transforms to process.</span></div>
<div class="line"><span class="lineno"> 1064</span>        <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno"> 1065</span>            field.is_relation</div>
<div class="line"><span class="lineno"> 1066</span>            <span class="keywordflow">and</span> opts.ordering</div>
<div class="line"><span class="lineno"> 1067</span>            <span class="keywordflow">and</span> getattr(field, <span class="stringliteral">&quot;attname&quot;</span>, <span class="keywordtype">None</span>) != pieces[-1]</div>
<div class="line"><span class="lineno"> 1068</span>            <span class="keywordflow">and</span> name != <span class="stringliteral">&quot;pk&quot;</span></div>
<div class="line"><span class="lineno"> 1069</span>            <span class="keywordflow">and</span> <span class="keywordflow">not</span> getattr(transform_function, <span class="stringliteral">&quot;has_transforms&quot;</span>, <span class="keyword">False</span>)</div>
<div class="line"><span class="lineno"> 1070</span>        ):</div>
<div class="line"><span class="lineno"> 1071</span>            <span class="comment"># Firstly, avoid infinite loops.</span></div>
<div class="line"><span class="lineno"> 1072</span>            already_seen = already_seen <span class="keywordflow">or</span> set()</div>
<div class="line"><span class="lineno"> 1073</span>            join_tuple = tuple(</div>
<div class="line"><span class="lineno"> 1074</span>                getattr(self.query.alias_map[j], <span class="stringliteral">&quot;join_cols&quot;</span>, <span class="keywordtype">None</span>) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> joins</div>
<div class="line"><span class="lineno"> 1075</span>            )</div>
<div class="line"><span class="lineno"> 1076</span>            <span class="keywordflow">if</span> join_tuple <span class="keywordflow">in</span> already_seen:</div>
<div class="line"><span class="lineno"> 1077</span>                <span class="keywordflow">raise</span> FieldError(<span class="stringliteral">&quot;Infinite loop caused by ordering.&quot;</span>)</div>
<div class="line"><span class="lineno"> 1078</span>            already_seen.add(join_tuple)</div>
<div class="line"><span class="lineno"> 1079</span> </div>
<div class="line"><span class="lineno"> 1080</span>            results = []</div>
<div class="line"><span class="lineno"> 1081</span>            <span class="keywordflow">for</span> item <span class="keywordflow">in</span> opts.ordering:</div>
<div class="line"><span class="lineno"> 1082</span>                <span class="keywordflow">if</span> hasattr(item, <span class="stringliteral">&quot;resolve_expression&quot;</span>) <span class="keywordflow">and</span> <span class="keywordflow">not</span> isinstance(</div>
<div class="line"><span class="lineno"> 1083</span>                    item, OrderBy</div>
<div class="line"><span class="lineno"> 1084</span>                ):</div>
<div class="line"><span class="lineno"> 1085</span>                    item = item.desc() <span class="keywordflow">if</span> descending <span class="keywordflow">else</span> item.asc()</div>
<div class="line"><span class="lineno"> 1086</span>                <span class="keywordflow">if</span> isinstance(item, OrderBy):</div>
<div class="line"><span class="lineno"> 1087</span>                    results.append(</div>
<div class="line"><span class="lineno"> 1088</span>                        (item.prefix_references(f<span class="stringliteral">&quot;{name}{LOOKUP_SEP}&quot;</span>), <span class="keyword">False</span>)</div>
<div class="line"><span class="lineno"> 1089</span>                    )</div>
<div class="line"><span class="lineno"> 1090</span>                    <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 1091</span>                results.extend(</div>
<div class="line"><span class="lineno"> 1092</span>                    (expr.prefix_references(f<span class="stringliteral">&quot;{name}{LOOKUP_SEP}&quot;</span>), is_ref)</div>
<div class="line"><span class="lineno"> 1093</span>                    <span class="keywordflow">for</span> expr, is_ref <span class="keywordflow">in</span> self.find_ordering_name(</div>
<div class="line"><span class="lineno"> 1094</span>                        item, opts, alias, order, already_seen</div>
<div class="line"><span class="lineno"> 1095</span>                    )</div>
<div class="line"><span class="lineno"> 1096</span>                )</div>
<div class="line"><span class="lineno"> 1097</span>            <span class="keywordflow">return</span> results</div>
<div class="line"><span class="lineno"> 1098</span>        targets, alias, _ = self.query.trim_joins(targets, joins, path)</div>
<div class="line"><span class="lineno"> 1099</span>        <span class="keywordflow">return</span> [</div>
<div class="line"><span class="lineno"> 1100</span>            (OrderBy(transform_function(t, alias), descending=descending), <span class="keyword">False</span>)</div>
<div class="line"><span class="lineno"> 1101</span>            <span class="keywordflow">for</span> t <span class="keywordflow">in</span> targets</div>
<div class="line"><span class="lineno"> 1102</span>        ]</div>
<div class="line"><span class="lineno"> 1103</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l01104">_setup_joins()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01041">find_ordering_name()</a>, <a class="el" href="sql_2query_8py_source.html#l02632">django.db.models.sql.query.get_order_dir()</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00316">_order_by_pairs()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01041">find_ordering_name()</a>.</p>

</div>
</div>
<a id="a2f2bb7c08e1627240b5f2e46ab5623d2" name="a2f2bb7c08e1627240b5f2e46ab5623d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f2bb7c08e1627240b5f2e46ab5623d2">&#9670;&#160;</a></span>get_combinator_sql()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_combinator_sql </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>combinator</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>all</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00560">560</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  560</span>    <span class="keyword">def </span>get_combinator_sql(self, combinator, all):</div>
<div class="line"><span class="lineno">  561</span>        features = self.connection.features</div>
<div class="line"><span class="lineno">  562</span>        compilers = [</div>
<div class="line"><span class="lineno">  563</span>            query.get_compiler(self.using, self.connection, self.elide_empty)</div>
<div class="line"><span class="lineno">  564</span>            <span class="keywordflow">for</span> query <span class="keywordflow">in</span> self.query.combined_queries</div>
<div class="line"><span class="lineno">  565</span>        ]</div>
<div class="line"><span class="lineno">  566</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> features.supports_slicing_ordering_in_compound:</div>
<div class="line"><span class="lineno">  567</span>            <span class="keywordflow">for</span> compiler <span class="keywordflow">in</span> compilers:</div>
<div class="line"><span class="lineno">  568</span>                <span class="keywordflow">if</span> compiler.query.is_sliced:</div>
<div class="line"><span class="lineno">  569</span>                    <span class="keywordflow">raise</span> DatabaseError(</div>
<div class="line"><span class="lineno">  570</span>                        <span class="stringliteral">&quot;LIMIT/OFFSET not allowed in subqueries of compound statements.&quot;</span></div>
<div class="line"><span class="lineno">  571</span>                    )</div>
<div class="line"><span class="lineno">  572</span>                <span class="keywordflow">if</span> compiler.get_order_by():</div>
<div class="line"><span class="lineno">  573</span>                    <span class="keywordflow">raise</span> DatabaseError(</div>
<div class="line"><span class="lineno">  574</span>                        <span class="stringliteral">&quot;ORDER BY not allowed in subqueries of compound statements.&quot;</span></div>
<div class="line"><span class="lineno">  575</span>                    )</div>
<div class="line"><span class="lineno">  576</span>        <span class="keywordflow">elif</span> self.query.is_sliced <span class="keywordflow">and</span> combinator == <span class="stringliteral">&quot;union&quot;</span>:</div>
<div class="line"><span class="lineno">  577</span>            <span class="keywordflow">for</span> compiler <span class="keywordflow">in</span> compilers:</div>
<div class="line"><span class="lineno">  578</span>                <span class="comment"># A sliced union cannot have its parts elided as some of them</span></div>
<div class="line"><span class="lineno">  579</span>                <span class="comment"># might be sliced as well and in the event where only a single</span></div>
<div class="line"><span class="lineno">  580</span>                <span class="comment"># part produces a non-empty resultset it might be impossible to</span></div>
<div class="line"><span class="lineno">  581</span>                <span class="comment"># generate valid SQL.</span></div>
<div class="line"><span class="lineno">  582</span>                compiler.elide_empty = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  583</span>        parts = ()</div>
<div class="line"><span class="lineno">  584</span>        <span class="keywordflow">for</span> compiler <span class="keywordflow">in</span> compilers:</div>
<div class="line"><span class="lineno">  585</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  586</span>                <span class="comment"># If the columns list is limited, then all combined queries</span></div>
<div class="line"><span class="lineno">  587</span>                <span class="comment"># must have the same columns list. Set the selects defined on</span></div>
<div class="line"><span class="lineno">  588</span>                <span class="comment"># the query on all combined queries, if not already set.</span></div>
<div class="line"><span class="lineno">  589</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> compiler.query.values_select <span class="keywordflow">and</span> self.query.values_select:</div>
<div class="line"><span class="lineno">  590</span>                    compiler.query = compiler.query.clone()</div>
<div class="line"><span class="lineno">  591</span>                    compiler.query.set_values(</div>
<div class="line"><span class="lineno">  592</span>                        (</div>
<div class="line"><span class="lineno">  593</span>                            *self.query.extra_select,</div>
<div class="line"><span class="lineno">  594</span>                            *self.query.values_select,</div>
<div class="line"><span class="lineno">  595</span>                            *self.query.annotation_select,</div>
<div class="line"><span class="lineno">  596</span>                        )</div>
<div class="line"><span class="lineno">  597</span>                    )</div>
<div class="line"><span class="lineno">  598</span>                part_sql, part_args = compiler.as_sql(with_col_aliases=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  599</span>                <span class="keywordflow">if</span> compiler.query.combinator:</div>
<div class="line"><span class="lineno">  600</span>                    <span class="comment"># Wrap in a subquery if wrapping in parentheses isn&#39;t</span></div>
<div class="line"><span class="lineno">  601</span>                    <span class="comment"># supported.</span></div>
<div class="line"><span class="lineno">  602</span>                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> features.supports_parentheses_in_compound:</div>
<div class="line"><span class="lineno">  603</span>                        part_sql = <span class="stringliteral">&quot;SELECT * FROM ({})&quot;</span>.format(part_sql)</div>
<div class="line"><span class="lineno">  604</span>                    <span class="comment"># Add parentheses when combining with compound query if not</span></div>
<div class="line"><span class="lineno">  605</span>                    <span class="comment"># already added for all compound queries.</span></div>
<div class="line"><span class="lineno">  606</span>                    <span class="keywordflow">elif</span> (</div>
<div class="line"><span class="lineno">  607</span>                        self.query.subquery</div>
<div class="line"><span class="lineno">  608</span>                        <span class="keywordflow">or</span> <span class="keywordflow">not</span> features.supports_slicing_ordering_in_compound</div>
<div class="line"><span class="lineno">  609</span>                    ):</div>
<div class="line"><span class="lineno">  610</span>                        part_sql = <span class="stringliteral">&quot;({})&quot;</span>.format(part_sql)</div>
<div class="line"><span class="lineno">  611</span>                <span class="keywordflow">elif</span> (</div>
<div class="line"><span class="lineno">  612</span>                    self.query.subquery</div>
<div class="line"><span class="lineno">  613</span>                    <span class="keywordflow">and</span> features.supports_slicing_ordering_in_compound</div>
<div class="line"><span class="lineno">  614</span>                ):</div>
<div class="line"><span class="lineno">  615</span>                    part_sql = <span class="stringliteral">&quot;({})&quot;</span>.format(part_sql)</div>
<div class="line"><span class="lineno">  616</span>                parts += ((part_sql, part_args),)</div>
<div class="line"><span class="lineno">  617</span>            <span class="keywordflow">except</span> EmptyResultSet:</div>
<div class="line"><span class="lineno">  618</span>                <span class="comment"># Omit the empty queryset with UNION and with DIFFERENCE if the</span></div>
<div class="line"><span class="lineno">  619</span>                <span class="comment"># first queryset is nonempty.</span></div>
<div class="line"><span class="lineno">  620</span>                <span class="keywordflow">if</span> combinator == <span class="stringliteral">&quot;union&quot;</span> <span class="keywordflow">or</span> (combinator == <span class="stringliteral">&quot;difference&quot;</span> <span class="keywordflow">and</span> parts):</div>
<div class="line"><span class="lineno">  621</span>                    <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  622</span>                <span class="keywordflow">raise</span></div>
<div class="line"><span class="lineno">  623</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> parts:</div>
<div class="line"><span class="lineno">  624</span>            <span class="keywordflow">raise</span> EmptyResultSet</div>
<div class="line"><span class="lineno">  625</span>        combinator_sql = self.connection.ops.set_operators[combinator]</div>
<div class="line"><span class="lineno">  626</span>        <span class="keywordflow">if</span> all <span class="keywordflow">and</span> combinator == <span class="stringliteral">&quot;union&quot;</span>:</div>
<div class="line"><span class="lineno">  627</span>            combinator_sql += <span class="stringliteral">&quot; ALL&quot;</span></div>
<div class="line"><span class="lineno">  628</span>        braces = <span class="stringliteral">&quot;{}&quot;</span></div>
<div class="line"><span class="lineno">  629</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.query.subquery <span class="keywordflow">and</span> features.supports_slicing_ordering_in_compound:</div>
<div class="line"><span class="lineno">  630</span>            braces = <span class="stringliteral">&quot;({})&quot;</span></div>
<div class="line"><span class="lineno">  631</span>        sql_parts, args_parts = zip(</div>
<div class="line"><span class="lineno">  632</span>            *((braces.format(sql), args) <span class="keywordflow">for</span> sql, args <span class="keywordflow">in</span> parts)</div>
<div class="line"><span class="lineno">  633</span>        )</div>
<div class="line"><span class="lineno">  634</span>        result = [<span class="stringliteral">&quot; {} &quot;</span>.format(combinator_sql).join(sql_parts)]</div>
<div class="line"><span class="lineno">  635</span>        params = []</div>
<div class="line"><span class="lineno">  636</span>        <span class="keywordflow">for</span> part <span class="keywordflow">in</span> args_parts:</div>
<div class="line"><span class="lineno">  637</span>            params.extend(part)</div>
<div class="line"><span class="lineno">  638</span>        <span class="keywordflow">return</span> result, params</div>
<div class="line"><span class="lineno">  639</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00052">elide_empty</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, <a class="el" href="layermapping_8py_source.html#l00122">django.contrib.gis.utils.layermapping.LayerMapping.using</a>, <a class="el" href="loaddata_8py_source.html#l00094">django.core.management.commands.loaddata.Command.using</a>, <a class="el" href="deletion_8py_source.html#l00096">django.db.models.deletion.Collector.using</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00049">using</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>.</p>

</div>
</div>
<a id="ad5af4ddf5413beaf2d91b0bb5c1bf5d2" name="ad5af4ddf5413beaf2d91b0bb5c1bf5d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5af4ddf5413beaf2d91b0bb5c1bf5d2">&#9670;&#160;</a></span>get_converters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_converters </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>expressions</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01495">1495</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1495</span>    <span class="keyword">def </span>get_converters(self, expressions):</div>
<div class="line"><span class="lineno"> 1496</span>        converters = {}</div>
<div class="line"><span class="lineno"> 1497</span>        <span class="keywordflow">for</span> i, expression <span class="keywordflow">in</span> enumerate(expressions):</div>
<div class="line"><span class="lineno"> 1498</span>            <span class="keywordflow">if</span> expression:</div>
<div class="line"><span class="lineno"> 1499</span>                backend_converters = self.connection.ops.get_db_converters(expression)</div>
<div class="line"><span class="lineno"> 1500</span>                field_converters = expression.get_db_converters(self.connection)</div>
<div class="line"><span class="lineno"> 1501</span>                <span class="keywordflow">if</span> backend_converters <span class="keywordflow">or</span> field_converters:</div>
<div class="line"><span class="lineno"> 1502</span>                    converters[i] = (backend_converters + field_converters, expression)</div>
<div class="line"><span class="lineno"> 1503</span>        <span class="keywordflow">return</span> converters</div>
<div class="line"><span class="lineno"> 1504</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01825">django.db.models.sql.compiler.SQLInsertCompiler.execute_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01522">results_iter()</a>.</p>

</div>
</div>
<a id="a1fd79e7a3d13813fed13e69862f37770" name="a1fd79e7a3d13813fed13e69862f37770"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd79e7a3d13813fed13e69862f37770">&#9670;&#160;</a></span>get_default_columns()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_default_columns </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>select_mask</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>start_alias</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>opts</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>from_parent</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute the default columns for selecting every field in the base
model. Will sometimes be called to pull in related models (e.g. via
select_related), in which case "opts" and "start_alias" will be given
to provide a starting point for the traversal.

Return a list of strings, quoted appropriately for use in SQL
directly, as well as a set of aliases used in the select statement (if
'as_pairs' is True, return a list of (alias, col_name) pairs instead
of strings as the first component and None as the second component).
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00963">963</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  965</span>    ):</div>
<div class="line"><span class="lineno">  966</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  967</span><span class="stringliteral">        Compute the default columns for selecting every field in the base</span></div>
<div class="line"><span class="lineno">  968</span><span class="stringliteral">        model. Will sometimes be called to pull in related models (e.g. via</span></div>
<div class="line"><span class="lineno">  969</span><span class="stringliteral">        select_related), in which case &quot;opts&quot; and &quot;start_alias&quot; will be given</span></div>
<div class="line"><span class="lineno">  970</span><span class="stringliteral">        to provide a starting point for the traversal.</span></div>
<div class="line"><span class="lineno">  971</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  972</span><span class="stringliteral">        Return a list of strings, quoted appropriately for use in SQL</span></div>
<div class="line"><span class="lineno">  973</span><span class="stringliteral">        directly, as well as a set of aliases used in the select statement (if</span></div>
<div class="line"><span class="lineno">  974</span><span class="stringliteral">        &#39;as_pairs&#39; is True, return a list of (alias, col_name) pairs instead</span></div>
<div class="line"><span class="lineno">  975</span><span class="stringliteral">        of strings as the first component and None as the second component).</span></div>
<div class="line"><span class="lineno">  976</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  977</span>        result = []</div>
<div class="line"><span class="lineno">  978</span>        <span class="keywordflow">if</span> opts <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  979</span>            <span class="keywordflow">if</span> (opts := self.query.get_meta()) <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  980</span>                <span class="keywordflow">return</span> result</div>
<div class="line"><span class="lineno">  981</span>        start_alias = start_alias <span class="keywordflow">or</span> self.query.get_initial_alias()</div>
<div class="line"><span class="lineno">  982</span>        <span class="comment"># The &#39;seen_models&#39; is used to optimize checking the needed parent</span></div>
<div class="line"><span class="lineno">  983</span>        <span class="comment"># alias for a given field. This also includes None -&gt; start_alias to</span></div>
<div class="line"><span class="lineno">  984</span>        <span class="comment"># be used by local fields.</span></div>
<div class="line"><span class="lineno">  985</span>        seen_models = {<span class="keywordtype">None</span>: start_alias}</div>
<div class="line"><span class="lineno">  986</span> </div>
<div class="line"><span class="lineno">  987</span>        <span class="keywordflow">for</span> field <span class="keywordflow">in</span> opts.concrete_fields:</div>
<div class="line"><span class="lineno">  988</span>            model = field.model._meta.concrete_model</div>
<div class="line"><span class="lineno">  989</span>            <span class="comment"># A proxy model will have a different model and concrete_model. We</span></div>
<div class="line"><span class="lineno">  990</span>            <span class="comment"># will assign None if the field belongs to this model.</span></div>
<div class="line"><span class="lineno">  991</span>            <span class="keywordflow">if</span> model == opts.model:</div>
<div class="line"><span class="lineno">  992</span>                model = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  993</span>            <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  994</span>                from_parent</div>
<div class="line"><span class="lineno">  995</span>                <span class="keywordflow">and</span> model <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  996</span>                <span class="keywordflow">and</span> issubclass(</div>
<div class="line"><span class="lineno">  997</span>                    from_parent._meta.concrete_model, model._meta.concrete_model</div>
<div class="line"><span class="lineno">  998</span>                )</div>
<div class="line"><span class="lineno">  999</span>            ):</div>
<div class="line"><span class="lineno"> 1000</span>                <span class="comment"># Avoid loading data for already loaded parents.</span></div>
<div class="line"><span class="lineno"> 1001</span>                <span class="comment"># We end up here in the case select_related() resolution</span></div>
<div class="line"><span class="lineno"> 1002</span>                <span class="comment"># proceeds from parent model to child model. In that case the</span></div>
<div class="line"><span class="lineno"> 1003</span>                <span class="comment"># parent model data is already present in the SELECT clause,</span></div>
<div class="line"><span class="lineno"> 1004</span>                <span class="comment"># and we want to avoid reloading the same data again.</span></div>
<div class="line"><span class="lineno"> 1005</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 1006</span>            <span class="keywordflow">if</span> select_mask <span class="keywordflow">and</span> field <span class="keywordflow">not</span> <span class="keywordflow">in</span> select_mask:</div>
<div class="line"><span class="lineno"> 1007</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 1008</span>            alias = self.query.join_parent_model(opts, model, start_alias, seen_models)</div>
<div class="line"><span class="lineno"> 1009</span>            column = field.get_col(alias)</div>
<div class="line"><span class="lineno"> 1010</span>            result.append(column)</div>
<div class="line"><span class="lineno"> 1011</span>        <span class="keywordflow">return</span> result</div>
<div class="line"><span class="lineno"> 1012</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01165">get_related_selections()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00229">get_select()</a>.</p>

</div>
</div>
<a id="a5afc8cd4e50abc7c5a9f8ca83beba4d4" name="a5afc8cd4e50abc7c5a9f8ca83beba4d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5afc8cd4e50abc7c5a9f8ca83beba4d4">&#9670;&#160;</a></span>get_distinct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_distinct </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return a quoted list of fields to use in DISTINCT ON part of the query.

This method can alter the tables in the query, and thus it must be
called before get_from_clause().
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01013">1013</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1013</span>    <span class="keyword">def </span>get_distinct(self):</div>
<div class="line"><span class="lineno"> 1014</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1015</span><span class="stringliteral">        Return a quoted list of fields to use in DISTINCT ON part of the query.</span></div>
<div class="line"><span class="lineno"> 1016</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno"> 1017</span><span class="stringliteral">        This method can alter the tables in the query, and thus it must be</span></div>
<div class="line"><span class="lineno"> 1018</span><span class="stringliteral">        called before get_from_clause().</span></div>
<div class="line"><span class="lineno"> 1019</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1020</span>        result = []</div>
<div class="line"><span class="lineno"> 1021</span>        params = []</div>
<div class="line"><span class="lineno"> 1022</span>        opts = self.query.get_meta()</div>
<div class="line"><span class="lineno"> 1023</span> </div>
<div class="line"><span class="lineno"> 1024</span>        <span class="keywordflow">for</span> name <span class="keywordflow">in</span> self.query.distinct_fields:</div>
<div class="line"><span class="lineno"> 1025</span>            parts = name.split(LOOKUP_SEP)</div>
<div class="line"><span class="lineno"> 1026</span>            _, targets, alias, joins, path, _, transform_function = self._setup_joins(</div>
<div class="line"><span class="lineno"> 1027</span>                parts, opts, <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 1028</span>            )</div>
<div class="line"><span class="lineno"> 1029</span>            targets, alias, _ = self.query.trim_joins(targets, joins, path)</div>
<div class="line"><span class="lineno"> 1030</span>            <span class="keywordflow">for</span> target <span class="keywordflow">in</span> targets:</div>
<div class="line"><span class="lineno"> 1031</span>                <span class="keywordflow">if</span> name <span class="keywordflow">in</span> self.query.annotation_select:</div>
<div class="line"><span class="lineno"> 1032</span>                    result.append(self.connection.ops.quote_name(name))</div>
<div class="line"><span class="lineno"> 1033</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1034</span>                    r, p = self.compile(transform_function(target, alias))</div>
<div class="line"><span class="lineno"> 1035</span>                    result.append(r)</div>
<div class="line"><span class="lineno"> 1036</span>                    params.append(p)</div>
<div class="line"><span class="lineno"> 1037</span>        <span class="keywordflow">return</span> result, params</div>
<div class="line"><span class="lineno"> 1038</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l01104">_setup_joins()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>.</p>

</div>
</div>
<a id="a93cf0b3ee93507769a47085242c92e21" name="a93cf0b3ee93507769a47085242c92e21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93cf0b3ee93507769a47085242c92e21">&#9670;&#160;</a></span>get_extra_select()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_extra_select </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>order_by</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>select</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00520">520</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  520</span>    <span class="keyword">def </span>get_extra_select(self, order_by, select):</div>
<div class="line"><span class="lineno">  521</span>        extra_select = []</div>
<div class="line"><span class="lineno">  522</span>        <span class="keywordflow">if</span> self.query.distinct <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.query.distinct_fields:</div>
<div class="line"><span class="lineno">  523</span>            select_sql = [t[1] <span class="keywordflow">for</span> t <span class="keywordflow">in</span> select]</div>
<div class="line"><span class="lineno">  524</span>            <span class="keywordflow">for</span> expr, (sql, params, is_ref) <span class="keywordflow">in</span> order_by:</div>
<div class="line"><span class="lineno">  525</span>                without_ordering = self.ordering_parts.search(sql)[1]</div>
<div class="line"><span class="lineno">  526</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> is_ref <span class="keywordflow">and</span> (without_ordering, params) <span class="keywordflow">not</span> <span class="keywordflow">in</span> select_sql:</div>
<div class="line"><span class="lineno">  527</span>                    extra_select.append((expr, (without_ordering, params), <span class="keywordtype">None</span>))</div>
<div class="line"><span class="lineno">  528</span>        <span class="keywordflow">return</span> extra_select</div>
<div class="line"><span class="lineno">  529</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l00041">ordering_parts</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

</div>
</div>
<a id="a83d303ccaad416a1714f4ce46f691473" name="a83d303ccaad416a1714f4ce46f691473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83d303ccaad416a1714f4ce46f691473">&#9670;&#160;</a></span>get_from_clause()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_from_clause </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return a list of strings that are joined together to go after the
"FROM" part of the query, as well as a list any extra parameters that
need to be included. Subclasses, can override this to create a
from-clause via a "select".

This should only be called after any SQL construction methods that
might change the tables that are needed. This means the select columns,
ordering, and distinct must be done first.
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01119">1119</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1119</span>    <span class="keyword">def </span>get_from_clause(self):</div>
<div class="line"><span class="lineno"> 1120</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1121</span><span class="stringliteral">        Return a list of strings that are joined together to go after the</span></div>
<div class="line"><span class="lineno"> 1122</span><span class="stringliteral">        &quot;FROM&quot; part of the query, as well as a list any extra parameters that</span></div>
<div class="line"><span class="lineno"> 1123</span><span class="stringliteral">        need to be included. Subclasses, can override this to create a</span></div>
<div class="line"><span class="lineno"> 1124</span><span class="stringliteral">        from-clause via a &quot;select&quot;.</span></div>
<div class="line"><span class="lineno"> 1125</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno"> 1126</span><span class="stringliteral">        This should only be called after any SQL construction methods that</span></div>
<div class="line"><span class="lineno"> 1127</span><span class="stringliteral">        might change the tables that are needed. This means the select columns,</span></div>
<div class="line"><span class="lineno"> 1128</span><span class="stringliteral">        ordering, and distinct must be done first.</span></div>
<div class="line"><span class="lineno"> 1129</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1130</span>        result = []</div>
<div class="line"><span class="lineno"> 1131</span>        params = []</div>
<div class="line"><span class="lineno"> 1132</span>        <span class="keywordflow">for</span> alias <span class="keywordflow">in</span> tuple(self.query.alias_map):</div>
<div class="line"><span class="lineno"> 1133</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.query.alias_refcount[alias]:</div>
<div class="line"><span class="lineno"> 1134</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 1135</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno"> 1136</span>                from_clause = self.query.alias_map[alias]</div>
<div class="line"><span class="lineno"> 1137</span>            <span class="keywordflow">except</span> KeyError:</div>
<div class="line"><span class="lineno"> 1138</span>                <span class="comment"># Extra tables can end up in self.tables, but not in the</span></div>
<div class="line"><span class="lineno"> 1139</span>                <span class="comment"># alias_map if they aren&#39;t in a join. That&#39;s OK. We skip them.</span></div>
<div class="line"><span class="lineno"> 1140</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 1141</span>            clause_sql, clause_params = self.compile(from_clause)</div>
<div class="line"><span class="lineno"> 1142</span>            result.append(clause_sql)</div>
<div class="line"><span class="lineno"> 1143</span>            params.extend(clause_params)</div>
<div class="line"><span class="lineno"> 1144</span>        <span class="keywordflow">for</span> t <span class="keywordflow">in</span> self.query.extra_tables:</div>
<div class="line"><span class="lineno"> 1145</span>            alias, _ = self.query.table_alias(t)</div>
<div class="line"><span class="lineno"> 1146</span>            <span class="comment"># Only add the alias if it&#39;s not already present (the table_alias()</span></div>
<div class="line"><span class="lineno"> 1147</span>            <span class="comment"># call increments the refcount, so an alias refcount of one means</span></div>
<div class="line"><span class="lineno"> 1148</span>            <span class="comment"># this is the only reference).</span></div>
<div class="line"><span class="lineno"> 1149</span>            <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno"> 1150</span>                alias <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.query.alias_map</div>
<div class="line"><span class="lineno"> 1151</span>                <span class="keywordflow">or</span> self.query.alias_refcount[alias] == 1</div>
<div class="line"><span class="lineno"> 1152</span>            ):</div>
<div class="line"><span class="lineno"> 1153</span>                result.append(<span class="stringliteral">&quot;, %s&quot;</span> % self.quote_name_unless_alias(alias))</div>
<div class="line"><span class="lineno"> 1154</span>        <span class="keywordflow">return</span> result, params</div>
<div class="line"><span class="lineno"> 1155</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00530">quote_name_unless_alias()</a>.</p>

<p class="reference">Referenced by <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00026">django.db.backends.mysql.compiler.SQLDeleteCompiler.as_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>.</p>

</div>
</div>
<a id="a952d33943d1a7920e1884ce273e96e53" name="a952d33943d1a7920e1884ce273e96e53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a952d33943d1a7920e1884ce273e96e53">&#9670;&#160;</a></span>get_group_by()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_group_by </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>select</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>order_by</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return a list of 2-tuples of form (sql, params).

The logic of what exactly the GROUP BY clause contains is hard
to describe in other words than "if it passes the test suite,
then it is correct".
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00094">94</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   94</span>    <span class="keyword">def </span>get_group_by(self, select, order_by):</div>
<div class="line"><span class="lineno">   95</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   96</span><span class="stringliteral">        Return a list of 2-tuples of form (sql, params).</span></div>
<div class="line"><span class="lineno">   97</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   98</span><span class="stringliteral">        The logic of what exactly the GROUP BY clause contains is hard</span></div>
<div class="line"><span class="lineno">   99</span><span class="stringliteral">        to describe in other words than &quot;if it passes the test suite,</span></div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral">        then it is correct&quot;.</span></div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  102</span>        <span class="comment"># Some examples:</span></div>
<div class="line"><span class="lineno">  103</span>        <span class="comment">#     SomeModel.objects.annotate(Count(&#39;somecol&#39;))</span></div>
<div class="line"><span class="lineno">  104</span>        <span class="comment">#     GROUP BY: all fields of the model</span></div>
<div class="line"><span class="lineno">  105</span>        <span class="comment">#</span></div>
<div class="line"><span class="lineno">  106</span>        <span class="comment">#    SomeModel.objects.values(&#39;name&#39;).annotate(Count(&#39;somecol&#39;))</span></div>
<div class="line"><span class="lineno">  107</span>        <span class="comment">#    GROUP BY: name</span></div>
<div class="line"><span class="lineno">  108</span>        <span class="comment">#</span></div>
<div class="line"><span class="lineno">  109</span>        <span class="comment">#    SomeModel.objects.annotate(Count(&#39;somecol&#39;)).values(&#39;name&#39;)</span></div>
<div class="line"><span class="lineno">  110</span>        <span class="comment">#    GROUP BY: all cols of the model</span></div>
<div class="line"><span class="lineno">  111</span>        <span class="comment">#</span></div>
<div class="line"><span class="lineno">  112</span>        <span class="comment">#    SomeModel.objects.values(&#39;name&#39;, &#39;pk&#39;)</span></div>
<div class="line"><span class="lineno">  113</span>        <span class="comment">#    .annotate(Count(&#39;somecol&#39;)).values(&#39;pk&#39;)</span></div>
<div class="line"><span class="lineno">  114</span>        <span class="comment">#    GROUP BY: name, pk</span></div>
<div class="line"><span class="lineno">  115</span>        <span class="comment">#</span></div>
<div class="line"><span class="lineno">  116</span>        <span class="comment">#    SomeModel.objects.values(&#39;name&#39;).annotate(Count(&#39;somecol&#39;)).values(&#39;pk&#39;)</span></div>
<div class="line"><span class="lineno">  117</span>        <span class="comment">#    GROUP BY: name, pk</span></div>
<div class="line"><span class="lineno">  118</span>        <span class="comment">#</span></div>
<div class="line"><span class="lineno">  119</span>        <span class="comment"># In fact, the self.query.group_by is the minimal set to GROUP BY. It</span></div>
<div class="line"><span class="lineno">  120</span>        <span class="comment"># can&#39;t be ever restricted to a smaller set, but additional columns in</span></div>
<div class="line"><span class="lineno">  121</span>        <span class="comment"># HAVING, ORDER BY, and SELECT clauses are added to it. Unfortunately</span></div>
<div class="line"><span class="lineno">  122</span>        <span class="comment"># the end result is that it is impossible to force the query to have</span></div>
<div class="line"><span class="lineno">  123</span>        <span class="comment"># a chosen GROUP BY clause - you can almost do this by using the form:</span></div>
<div class="line"><span class="lineno">  124</span>        <span class="comment">#     .values(*wanted_cols).annotate(AnAggregate())</span></div>
<div class="line"><span class="lineno">  125</span>        <span class="comment"># but any later annotations, extra selects, values calls that</span></div>
<div class="line"><span class="lineno">  126</span>        <span class="comment"># refer some column outside of the wanted_cols, order_by, or even</span></div>
<div class="line"><span class="lineno">  127</span>        <span class="comment"># filter calls can alter the GROUP BY clause.</span></div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>        <span class="comment"># The query.group_by is either None (no GROUP BY at all), True</span></div>
<div class="line"><span class="lineno">  130</span>        <span class="comment"># (group by select fields), or a list of expressions to be added</span></div>
<div class="line"><span class="lineno">  131</span>        <span class="comment"># to the group by.</span></div>
<div class="line"><span class="lineno">  132</span>        <span class="keywordflow">if</span> self.query.group_by <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  133</span>            <span class="keywordflow">return</span> []</div>
<div class="line"><span class="lineno">  134</span>        expressions = []</div>
<div class="line"><span class="lineno">  135</span>        group_by_refs = set()</div>
<div class="line"><span class="lineno">  136</span>        <span class="keywordflow">if</span> self.query.group_by <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keyword">True</span>:</div>
<div class="line"><span class="lineno">  137</span>            <span class="comment"># If the group by is set to a list (by .values() call most likely),</span></div>
<div class="line"><span class="lineno">  138</span>            <span class="comment"># then we need to add everything in it to the GROUP BY clause.</span></div>
<div class="line"><span class="lineno">  139</span>            <span class="comment"># Backwards compatibility hack for setting query.group_by. Remove</span></div>
<div class="line"><span class="lineno">  140</span>            <span class="comment"># when we have public API way of forcing the GROUP BY clause.</span></div>
<div class="line"><span class="lineno">  141</span>            <span class="comment"># Converts string references to expressions.</span></div>
<div class="line"><span class="lineno">  142</span>            <span class="keywordflow">for</span> expr <span class="keywordflow">in</span> self.query.group_by:</div>
<div class="line"><span class="lineno">  143</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(expr, <span class="stringliteral">&quot;as_sql&quot;</span>):</div>
<div class="line"><span class="lineno">  144</span>                    expr = self.query.resolve_ref(expr)</div>
<div class="line"><span class="lineno">  145</span>                <span class="keywordflow">if</span> isinstance(expr, Ref):</div>
<div class="line"><span class="lineno">  146</span>                    <span class="keywordflow">if</span> expr.refs <span class="keywordflow">not</span> <span class="keywordflow">in</span> group_by_refs:</div>
<div class="line"><span class="lineno">  147</span>                        group_by_refs.add(expr.refs)</div>
<div class="line"><span class="lineno">  148</span>                        expressions.append(expr.source)</div>
<div class="line"><span class="lineno">  149</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  150</span>                    expressions.append(expr)</div>
<div class="line"><span class="lineno">  151</span>        <span class="comment"># Note that even if the group_by is set, it is only the minimal</span></div>
<div class="line"><span class="lineno">  152</span>        <span class="comment"># set to group by. So, we need to add cols in select, order_by, and</span></div>
<div class="line"><span class="lineno">  153</span>        <span class="comment"># having into the select in any case.</span></div>
<div class="line"><span class="lineno">  154</span>        selected_expr_positions = {}</div>
<div class="line"><span class="lineno">  155</span>        <span class="keywordflow">for</span> ordinal, (expr, _, alias) <span class="keywordflow">in</span> enumerate(select, start=1):</div>
<div class="line"><span class="lineno">  156</span>            <span class="keywordflow">if</span> alias:</div>
<div class="line"><span class="lineno">  157</span>                selected_expr_positions[expr] = ordinal</div>
<div class="line"><span class="lineno">  158</span>            <span class="comment"># Skip members of the select clause that are already explicitly</span></div>
<div class="line"><span class="lineno">  159</span>            <span class="comment"># grouped against.</span></div>
<div class="line"><span class="lineno">  160</span>            <span class="keywordflow">if</span> alias <span class="keywordflow">in</span> group_by_refs:</div>
<div class="line"><span class="lineno">  161</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  162</span>            expressions.extend(expr.get_group_by_cols())</div>
<div class="line"><span class="lineno">  163</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self._meta_ordering:</div>
<div class="line"><span class="lineno">  164</span>            <span class="keywordflow">for</span> expr, (sql, params, is_ref) <span class="keywordflow">in</span> order_by:</div>
<div class="line"><span class="lineno">  165</span>                <span class="comment"># Skip references to the SELECT clause, as all expressions in</span></div>
<div class="line"><span class="lineno">  166</span>                <span class="comment"># the SELECT clause are already part of the GROUP BY.</span></div>
<div class="line"><span class="lineno">  167</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> is_ref:</div>
<div class="line"><span class="lineno">  168</span>                    expressions.extend(expr.get_group_by_cols())</div>
<div class="line"><span class="lineno">  169</span>        having_group_by = self.having.get_group_by_cols() <span class="keywordflow">if</span> self.having <span class="keywordflow">else</span> ()</div>
<div class="line"><span class="lineno">  170</span>        <span class="keywordflow">for</span> expr <span class="keywordflow">in</span> having_group_by:</div>
<div class="line"><span class="lineno">  171</span>            expressions.append(expr)</div>
<div class="line"><span class="lineno">  172</span>        result = []</div>
<div class="line"><span class="lineno">  173</span>        seen = set()</div>
<div class="line"><span class="lineno">  174</span>        expressions = self.collapse_group_by(expressions, having_group_by)</div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>        allows_group_by_select_index = (</div>
<div class="line"><span class="lineno">  177</span>            self.connection.features.allows_group_by_select_index</div>
<div class="line"><span class="lineno">  178</span>        )</div>
<div class="line"><span class="lineno">  179</span>        <span class="keywordflow">for</span> expr <span class="keywordflow">in</span> expressions:</div>
<div class="line"><span class="lineno">  180</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  181</span>                sql, params = self.compile(expr)</div>
<div class="line"><span class="lineno">  182</span>            <span class="keywordflow">except</span> (EmptyResultSet, FullResultSet):</div>
<div class="line"><span class="lineno">  183</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  184</span>            <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  185</span>                allows_group_by_select_index</div>
<div class="line"><span class="lineno">  186</span>                <span class="keywordflow">and</span> (position := selected_expr_positions.get(expr)) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  187</span>            ):</div>
<div class="line"><span class="lineno">  188</span>                sql, params = str(position), ()</div>
<div class="line"><span class="lineno">  189</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  190</span>                sql, params = expr.select_format(self, sql, params)</div>
<div class="line"><span class="lineno">  191</span>            params_hash = make_hashable(params)</div>
<div class="line"><span class="lineno">  192</span>            <span class="keywordflow">if</span> (sql, params_hash) <span class="keywordflow">not</span> <span class="keywordflow">in</span> seen:</div>
<div class="line"><span class="lineno">  193</span>                result.append((sql, params))</div>
<div class="line"><span class="lineno">  194</span>                seen.add((sql, params_hash))</div>
<div class="line"><span class="lineno">  195</span>        <span class="keywordflow">return</span> result</div>
<div class="line"><span class="lineno">  196</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l00061">_meta_ordering</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00197">collapse_group_by()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">having</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

</div>
</div>
<a id="a85a625d03b1e87e5dc6f2ea7e93fef1a" name="a85a625d03b1e87e5dc6f2ea7e93fef1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85a625d03b1e87e5dc6f2ea7e93fef1a">&#9670;&#160;</a></span>get_order_by()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_order_by </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return a list of 2-tuples of the form (expr, (sql, params, is_ref)) for
the ORDER BY clause.

The order_by clause can alter the select clause (for example it can add
aliases to clauses that do not yet have one, or it can add totally new
select clauses).
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00459">459</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  459</span>    <span class="keyword">def </span>get_order_by(self):</div>
<div class="line"><span class="lineno">  460</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  461</span><span class="stringliteral">        Return a list of 2-tuples of the form (expr, (sql, params, is_ref)) for</span></div>
<div class="line"><span class="lineno">  462</span><span class="stringliteral">        the ORDER BY clause.</span></div>
<div class="line"><span class="lineno">  463</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  464</span><span class="stringliteral">        The order_by clause can alter the select clause (for example it can add</span></div>
<div class="line"><span class="lineno">  465</span><span class="stringliteral">        aliases to clauses that do not yet have one, or it can add totally new</span></div>
<div class="line"><span class="lineno">  466</span><span class="stringliteral">        select clauses).</span></div>
<div class="line"><span class="lineno">  467</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  468</span>        result = []</div>
<div class="line"><span class="lineno">  469</span>        seen = set()</div>
<div class="line"><span class="lineno">  470</span>        <span class="keywordflow">for</span> expr, is_ref <span class="keywordflow">in</span> self._order_by_pairs():</div>
<div class="line"><span class="lineno">  471</span>            resolved = expr.resolve_expression(self.query, allow_joins=<span class="keyword">True</span>, reuse=<span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">  472</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> is_ref <span class="keywordflow">and</span> self.query.combinator <span class="keywordflow">and</span> self.select:</div>
<div class="line"><span class="lineno">  473</span>                src = resolved.expression</div>
<div class="line"><span class="lineno">  474</span>                expr_src = expr.expression</div>
<div class="line"><span class="lineno">  475</span>                <span class="keywordflow">for</span> sel_expr, _, col_alias <span class="keywordflow">in</span> self.select:</div>
<div class="line"><span class="lineno">  476</span>                    <span class="keywordflow">if</span> src == sel_expr:</div>
<div class="line"><span class="lineno">  477</span>                        <span class="comment"># When values() is used the exact alias must be used to</span></div>
<div class="line"><span class="lineno">  478</span>                        <span class="comment"># reference annotations.</span></div>
<div class="line"><span class="lineno">  479</span>                        <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  480</span>                            self.query.has_select_fields</div>
<div class="line"><span class="lineno">  481</span>                            <span class="keywordflow">and</span> col_alias <span class="keywordflow">in</span> self.query.annotation_select</div>
<div class="line"><span class="lineno">  482</span>                            <span class="keywordflow">and</span> <span class="keywordflow">not</span> (</div>
<div class="line"><span class="lineno">  483</span>                                isinstance(expr_src, F) <span class="keywordflow">and</span> col_alias == expr_src.name</div>
<div class="line"><span class="lineno">  484</span>                            )</div>
<div class="line"><span class="lineno">  485</span>                        ):</div>
<div class="line"><span class="lineno">  486</span>                            <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  487</span>                        resolved.set_source_expressions(</div>
<div class="line"><span class="lineno">  488</span>                            [Ref(col_alias <span class="keywordflow">if</span> col_alias <span class="keywordflow">else</span> src.target.column, src)]</div>
<div class="line"><span class="lineno">  489</span>                        )</div>
<div class="line"><span class="lineno">  490</span>                        <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  491</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  492</span>                    <span class="comment"># Add column used in ORDER BY clause to the selected</span></div>
<div class="line"><span class="lineno">  493</span>                    <span class="comment"># columns and to each combined query.</span></div>
<div class="line"><span class="lineno">  494</span>                    order_by_idx = len(self.query.select) + 1</div>
<div class="line"><span class="lineno">  495</span>                    col_alias = f<span class="stringliteral">&quot;__orderbycol{order_by_idx}&quot;</span></div>
<div class="line"><span class="lineno">  496</span>                    <span class="keywordflow">for</span> q <span class="keywordflow">in</span> self.query.combined_queries:</div>
<div class="line"><span class="lineno">  497</span>                        <span class="comment"># If fields were explicitly selected through values()</span></div>
<div class="line"><span class="lineno">  498</span>                        <span class="comment"># combined queries cannot be augmented.</span></div>
<div class="line"><span class="lineno">  499</span>                        <span class="keywordflow">if</span> q.has_select_fields:</div>
<div class="line"><span class="lineno">  500</span>                            <span class="keywordflow">raise</span> DatabaseError(</div>
<div class="line"><span class="lineno">  501</span>                                <span class="stringliteral">&quot;ORDER BY term does not match any column in &quot;</span></div>
<div class="line"><span class="lineno">  502</span>                                <span class="stringliteral">&quot;the result set.&quot;</span></div>
<div class="line"><span class="lineno">  503</span>                            )</div>
<div class="line"><span class="lineno">  504</span>                        q.add_annotation(expr_src, col_alias)</div>
<div class="line"><span class="lineno">  505</span>                    self.query.add_select_col(resolved, col_alias)</div>
<div class="line"><span class="lineno">  506</span>                    resolved.set_source_expressions([Ref(col_alias, src)])</div>
<div class="line"><span class="lineno">  507</span>            sql, params = self.compile(resolved)</div>
<div class="line"><span class="lineno">  508</span>            <span class="comment"># Don&#39;t add the same column twice, but the order direction is</span></div>
<div class="line"><span class="lineno">  509</span>            <span class="comment"># not taken into account so we strip it. When this entire method</span></div>
<div class="line"><span class="lineno">  510</span>            <span class="comment"># is refactored into expressions, then we can check each part as we</span></div>
<div class="line"><span class="lineno">  511</span>            <span class="comment"># generate it.</span></div>
<div class="line"><span class="lineno">  512</span>            without_ordering = self.ordering_parts.search(sql)[1]</div>
<div class="line"><span class="lineno">  513</span>            params_hash = make_hashable(params)</div>
<div class="line"><span class="lineno">  514</span>            <span class="keywordflow">if</span> (without_ordering, params_hash) <span class="keywordflow">in</span> seen:</div>
<div class="line"><span class="lineno">  515</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  516</span>            seen.add((without_ordering, params_hash))</div>
<div class="line"><span class="lineno">  517</span>            result.append((resolved, (sql, params, is_ref)))</div>
<div class="line"><span class="lineno">  518</span>        <span class="keywordflow">return</span> result</div>
<div class="line"><span class="lineno">  519</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l00316">_order_by_pairs()</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00041">ordering_parts</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00020">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00099">django.contrib.gis.db.backends.oracle.operations.OracleOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2postgis_2operations_8py_source.html#l00167">django.contrib.gis.db.backends.postgis.operations.PostGISOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00066">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.select</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00058">select</a>.</p>

<p class="reference">Referenced by <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00056">django.db.backends.mysql.compiler.SQLUpdateCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00078">pre_sql_setup()</a>.</p>

</div>
</div>
<a id="afdb00329e7a13cfc55825ceb0302bb93" name="afdb00329e7a13cfc55825ceb0302bb93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdb00329e7a13cfc55825ceb0302bb93">&#9670;&#160;</a></span>get_qualify_sql()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_qualify_sql </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">640</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  640</span>    <span class="keyword">def </span>get_qualify_sql(self):</div>
<div class="line"><span class="lineno">  641</span>        where_parts = []</div>
<div class="line"><span class="lineno">  642</span>        <span class="keywordflow">if</span> self.where:</div>
<div class="line"><span class="lineno">  643</span>            where_parts.append(self.where)</div>
<div class="line"><span class="lineno">  644</span>        <span class="keywordflow">if</span> self.having:</div>
<div class="line"><span class="lineno">  645</span>            where_parts.append(self.having)</div>
<div class="line"><span class="lineno">  646</span>        inner_query = self.query.clone()</div>
<div class="line"><span class="lineno">  647</span>        inner_query.subquery = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  648</span>        inner_query.where = inner_query.where.__class__(where_parts)</div>
<div class="line"><span class="lineno">  649</span>        <span class="comment"># Augment the inner query with any window function references that</span></div>
<div class="line"><span class="lineno">  650</span>        <span class="comment"># might have been masked via values() and alias(). If any masked</span></div>
<div class="line"><span class="lineno">  651</span>        <span class="comment"># aliases are added they&#39;ll be masked again to avoid fetching</span></div>
<div class="line"><span class="lineno">  652</span>        <span class="comment"># the data in the `if qual_aliases` branch below.</span></div>
<div class="line"><span class="lineno">  653</span>        select = {</div>
<div class="line"><span class="lineno">  654</span>            expr: alias <span class="keywordflow">for</span> expr, _, alias <span class="keywordflow">in</span> self.get_select(with_col_aliases=<span class="keyword">True</span>)[0]</div>
<div class="line"><span class="lineno">  655</span>        }</div>
<div class="line"><span class="lineno">  656</span>        select_aliases = set(select.values())</div>
<div class="line"><span class="lineno">  657</span>        qual_aliases = set()</div>
<div class="line"><span class="lineno">  658</span>        replacements = {}</div>
<div class="line"><span class="lineno">  659</span> </div>
<div class="line"><span class="lineno">  660</span>        <span class="keyword">def </span>collect_replacements(expressions):</div>
<div class="line"><span class="lineno">  661</span>            <span class="keywordflow">while</span> expressions:</div>
<div class="line"><span class="lineno">  662</span>                expr = expressions.pop()</div>
<div class="line"><span class="lineno">  663</span>                <span class="keywordflow">if</span> expr <span class="keywordflow">in</span> replacements:</div>
<div class="line"><span class="lineno">  664</span>                    <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  665</span>                <span class="keywordflow">elif</span> select_alias := select.get(expr):</div>
<div class="line"><span class="lineno">  666</span>                    replacements[expr] = select_alias</div>
<div class="line"><span class="lineno">  667</span>                <span class="keywordflow">elif</span> isinstance(expr, Lookup):</div>
<div class="line"><span class="lineno">  668</span>                    expressions.extend(expr.get_source_expressions())</div>
<div class="line"><span class="lineno">  669</span>                <span class="keywordflow">elif</span> isinstance(expr, Ref):</div>
<div class="line"><span class="lineno">  670</span>                    <span class="keywordflow">if</span> expr.refs <span class="keywordflow">not</span> <span class="keywordflow">in</span> select_aliases:</div>
<div class="line"><span class="lineno">  671</span>                        expressions.extend(expr.get_source_expressions())</div>
<div class="line"><span class="lineno">  672</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  673</span>                    num_qual_alias = len(qual_aliases)</div>
<div class="line"><span class="lineno">  674</span>                    select_alias = f<span class="stringliteral">&quot;qual{num_qual_alias}&quot;</span></div>
<div class="line"><span class="lineno">  675</span>                    qual_aliases.add(select_alias)</div>
<div class="line"><span class="lineno">  676</span>                    inner_query.add_annotation(expr, select_alias)</div>
<div class="line"><span class="lineno">  677</span>                    replacements[expr] = select_alias</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>        collect_replacements(list(self.qualify.leaves()))</div>
<div class="line"><span class="lineno">  680</span>        self.qualify = self.qualify.replace_expressions(</div>
<div class="line"><span class="lineno">  681</span>            {expr: Ref(alias, expr) <span class="keywordflow">for</span> expr, alias <span class="keywordflow">in</span> replacements.items()}</div>
<div class="line"><span class="lineno">  682</span>        )</div>
<div class="line"><span class="lineno">  683</span>        order_by = []</div>
<div class="line"><span class="lineno">  684</span>        <span class="keywordflow">for</span> order_by_expr, *_ <span class="keywordflow">in</span> self.get_order_by():</div>
<div class="line"><span class="lineno">  685</span>            collect_replacements(order_by_expr.get_source_expressions())</div>
<div class="line"><span class="lineno">  686</span>            order_by.append(</div>
<div class="line"><span class="lineno">  687</span>                order_by_expr.replace_expressions(</div>
<div class="line"><span class="lineno">  688</span>                    {expr: Ref(alias, expr) <span class="keywordflow">for</span> expr, alias <span class="keywordflow">in</span> replacements.items()}</div>
<div class="line"><span class="lineno">  689</span>                )</div>
<div class="line"><span class="lineno">  690</span>            )</div>
<div class="line"><span class="lineno">  691</span>        inner_query_compiler = inner_query.get_compiler(</div>
<div class="line"><span class="lineno">  692</span>            self.using, connection=self.connection, elide_empty=self.elide_empty</div>
<div class="line"><span class="lineno">  693</span>        )</div>
<div class="line"><span class="lineno">  694</span>        inner_sql, inner_params = inner_query_compiler.as_sql(</div>
<div class="line"><span class="lineno">  695</span>            <span class="comment"># The limits must be applied to the outer query to avoid pruning</span></div>
<div class="line"><span class="lineno">  696</span>            <span class="comment"># results too eagerly.</span></div>
<div class="line"><span class="lineno">  697</span>            with_limits=<span class="keyword">False</span>,</div>
<div class="line"><span class="lineno">  698</span>            <span class="comment"># Force unique aliasing of selected columns to avoid collisions</span></div>
<div class="line"><span class="lineno">  699</span>            <span class="comment"># and make rhs predicates referencing easier.</span></div>
<div class="line"><span class="lineno">  700</span>            with_col_aliases=<span class="keyword">True</span>,</div>
<div class="line"><span class="lineno">  701</span>        )</div>
<div class="line"><span class="lineno">  702</span>        qualify_sql, qualify_params = self.compile(self.qualify)</div>
<div class="line"><span class="lineno">  703</span>        result = [</div>
<div class="line"><span class="lineno">  704</span>            <span class="stringliteral">&quot;SELECT * FROM (&quot;</span>,</div>
<div class="line"><span class="lineno">  705</span>            inner_sql,</div>
<div class="line"><span class="lineno">  706</span>            <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line"><span class="lineno">  707</span>            self.connection.ops.quote_name(<span class="stringliteral">&quot;qualify&quot;</span>),</div>
<div class="line"><span class="lineno">  708</span>            <span class="stringliteral">&quot;WHERE&quot;</span>,</div>
<div class="line"><span class="lineno">  709</span>            qualify_sql,</div>
<div class="line"><span class="lineno">  710</span>        ]</div>
<div class="line"><span class="lineno">  711</span>        <span class="keywordflow">if</span> qual_aliases:</div>
<div class="line"><span class="lineno">  712</span>            <span class="comment"># If some select aliases were unmasked for filtering purposes they</span></div>
<div class="line"><span class="lineno">  713</span>            <span class="comment"># must be masked back.</span></div>
<div class="line"><span class="lineno">  714</span>            cols = [self.connection.ops.quote_name(alias) <span class="keywordflow">for</span> alias <span class="keywordflow">in</span> select.values()]</div>
<div class="line"><span class="lineno">  715</span>            result = [</div>
<div class="line"><span class="lineno">  716</span>                <span class="stringliteral">&quot;SELECT&quot;</span>,</div>
<div class="line"><span class="lineno">  717</span>                <span class="stringliteral">&quot;, &quot;</span>.join(cols),</div>
<div class="line"><span class="lineno">  718</span>                <span class="stringliteral">&quot;FROM (&quot;</span>,</div>
<div class="line"><span class="lineno">  719</span>                *result,</div>
<div class="line"><span class="lineno">  720</span>                <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line"><span class="lineno">  721</span>                self.connection.ops.quote_name(<span class="stringliteral">&quot;qualify_mask&quot;</span>),</div>
<div class="line"><span class="lineno">  722</span>            ]</div>
<div class="line"><span class="lineno">  723</span>        params = list(inner_params) + qualify_params</div>
<div class="line"><span class="lineno">  724</span>        <span class="comment"># As the SQL spec is unclear on whether or not derived tables</span></div>
<div class="line"><span class="lineno">  725</span>        <span class="comment"># ordering must propagate it has to be explicitly repeated on the</span></div>
<div class="line"><span class="lineno">  726</span>        <span class="comment"># outer-most query to ensure it&#39;s preserved.</span></div>
<div class="line"><span class="lineno">  727</span>        <span class="keywordflow">if</span> order_by:</div>
<div class="line"><span class="lineno">  728</span>            ordering_sqls = []</div>
<div class="line"><span class="lineno">  729</span>            <span class="keywordflow">for</span> ordering <span class="keywordflow">in</span> order_by:</div>
<div class="line"><span class="lineno">  730</span>                ordering_sql, ordering_params = self.compile(ordering)</div>
<div class="line"><span class="lineno">  731</span>                ordering_sqls.append(ordering_sql)</div>
<div class="line"><span class="lineno">  732</span>                params.extend(ordering_params)</div>
<div class="line"><span class="lineno">  733</span>            result.extend([<span class="stringliteral">&quot;ORDER BY&quot;</span>, <span class="stringliteral">&quot;, &quot;</span>.join(ordering_sqls)])</div>
<div class="line"><span class="lineno">  734</span>        <span class="keywordflow">return</span> result, params</div>
<div class="line"><span class="lineno">  735</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00052">elide_empty</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00459">get_order_by()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00229">get_select()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">having</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">qualify</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, <a class="el" href="layermapping_8py_source.html#l00122">django.contrib.gis.utils.layermapping.LayerMapping.using</a>, <a class="el" href="loaddata_8py_source.html#l00094">django.core.management.commands.loaddata.Command.using</a>, <a class="el" href="deletion_8py_source.html#l00096">django.db.models.deletion.Collector.using</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00049">using</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">where</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>.</p>

</div>
</div>
<a id="aee7015626498e3df6714612271bb2b00" name="aee7015626498e3df6714612271bb2b00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee7015626498e3df6714612271bb2b00">&#9670;&#160;</a></span>get_related_selections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_related_selections </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>select</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>select_mask</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>opts</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>root_alias</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>cur_depth</em></span><span class="paramdefsep"> = </span><span class="paramdefval">1</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>requested</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>restricted</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Fill in the information needed for a select_related query. The current
depth is measured as the number of connections away from the root model
(for example, cur_depth=1 means we are looking at models with direct
connections to the root model).
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01156">1156</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1165</span>    ):</div>
<div class="line"><span class="lineno"> 1166</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1167</span><span class="stringliteral">        Fill in the information needed for a select_related query. The current</span></div>
<div class="line"><span class="lineno"> 1168</span><span class="stringliteral">        depth is measured as the number of connections away from the root model</span></div>
<div class="line"><span class="lineno"> 1169</span><span class="stringliteral">        (for example, cur_depth=1 means we are looking at models with direct</span></div>
<div class="line"><span class="lineno"> 1170</span><span class="stringliteral">        connections to the root model).</span></div>
<div class="line"><span class="lineno"> 1171</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1172</span> </div>
<div class="line"><span class="lineno"> 1173</span>        <span class="keyword">def </span>_get_field_choices():</div>
<div class="line"><span class="lineno"> 1174</span>            direct_choices = (f.name <span class="keywordflow">for</span> f <span class="keywordflow">in</span> opts.fields <span class="keywordflow">if</span> f.is_relation)</div>
<div class="line"><span class="lineno"> 1175</span>            reverse_choices = (</div>
<div class="line"><span class="lineno"> 1176</span>                f.field.related_query_name()</div>
<div class="line"><span class="lineno"> 1177</span>                <span class="keywordflow">for</span> f <span class="keywordflow">in</span> opts.related_objects</div>
<div class="line"><span class="lineno"> 1178</span>                <span class="keywordflow">if</span> f.field.unique</div>
<div class="line"><span class="lineno"> 1179</span>            )</div>
<div class="line"><span class="lineno"> 1180</span>            <span class="keywordflow">return</span> chain(</div>
<div class="line"><span class="lineno"> 1181</span>                direct_choices, reverse_choices, self.query._filtered_relations</div>
<div class="line"><span class="lineno"> 1182</span>            )</div>
<div class="line"><span class="lineno"> 1183</span> </div>
<div class="line"><span class="lineno"> 1184</span>        related_klass_infos = []</div>
<div class="line"><span class="lineno"> 1185</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> restricted <span class="keywordflow">and</span> cur_depth &gt; self.query.max_depth:</div>
<div class="line"><span class="lineno"> 1186</span>            <span class="comment"># We&#39;ve recursed far enough; bail out.</span></div>
<div class="line"><span class="lineno"> 1187</span>            <span class="keywordflow">return</span> related_klass_infos</div>
<div class="line"><span class="lineno"> 1188</span> </div>
<div class="line"><span class="lineno"> 1189</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> opts:</div>
<div class="line"><span class="lineno"> 1190</span>            opts = self.query.get_meta()</div>
<div class="line"><span class="lineno"> 1191</span>            root_alias = self.query.get_initial_alias()</div>
<div class="line"><span class="lineno"> 1192</span> </div>
<div class="line"><span class="lineno"> 1193</span>        <span class="comment"># Setup for the case when only particular related fields should be</span></div>
<div class="line"><span class="lineno"> 1194</span>        <span class="comment"># included in the related selection.</span></div>
<div class="line"><span class="lineno"> 1195</span>        fields_found = set()</div>
<div class="line"><span class="lineno"> 1196</span>        <span class="keywordflow">if</span> requested <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 1197</span>            restricted = isinstance(self.query.select_related, dict)</div>
<div class="line"><span class="lineno"> 1198</span>            <span class="keywordflow">if</span> restricted:</div>
<div class="line"><span class="lineno"> 1199</span>                requested = self.query.select_related</div>
<div class="line"><span class="lineno"> 1200</span> </div>
<div class="line"><span class="lineno"> 1201</span>        <span class="keyword">def </span>get_related_klass_infos(klass_info, related_klass_infos):</div>
<div class="line"><span class="lineno"> 1202</span>            klass_info[<span class="stringliteral">&quot;related_klass_infos&quot;</span>] = related_klass_infos</div>
<div class="line"><span class="lineno"> 1203</span> </div>
<div class="line"><span class="lineno"> 1204</span>        <span class="keywordflow">for</span> f <span class="keywordflow">in</span> opts.fields:</div>
<div class="line"><span class="lineno"> 1205</span>            fields_found.add(f.name)</div>
<div class="line"><span class="lineno"> 1206</span> </div>
<div class="line"><span class="lineno"> 1207</span>            <span class="keywordflow">if</span> restricted:</div>
<div class="line"><span class="lineno"> 1208</span>                next = requested.get(f.name, {})</div>
<div class="line"><span class="lineno"> 1209</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> f.is_relation:</div>
<div class="line"><span class="lineno"> 1210</span>                    <span class="comment"># If a non-related field is used like a relation,</span></div>
<div class="line"><span class="lineno"> 1211</span>                    <span class="comment"># or if a single non-relational field is given.</span></div>
<div class="line"><span class="lineno"> 1212</span>                    <span class="keywordflow">if</span> next <span class="keywordflow">or</span> f.name <span class="keywordflow">in</span> requested:</div>
<div class="line"><span class="lineno"> 1213</span>                        <span class="keywordflow">raise</span> FieldError(</div>
<div class="line"><span class="lineno"> 1214</span>                            <span class="stringliteral">&quot;Non-relational field given in select_related: &#39;%s&#39;. &quot;</span></div>
<div class="line"><span class="lineno"> 1215</span>                            <span class="stringliteral">&quot;Choices are: %s&quot;</span></div>
<div class="line"><span class="lineno"> 1216</span>                            % (</div>
<div class="line"><span class="lineno"> 1217</span>                                f.name,</div>
<div class="line"><span class="lineno"> 1218</span>                                <span class="stringliteral">&quot;, &quot;</span>.join(_get_field_choices()) <span class="keywordflow">or</span> <span class="stringliteral">&quot;(none)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1219</span>                            )</div>
<div class="line"><span class="lineno"> 1220</span>                        )</div>
<div class="line"><span class="lineno"> 1221</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1222</span>                next = <span class="keyword">False</span></div>
<div class="line"><span class="lineno"> 1223</span> </div>
<div class="line"><span class="lineno"> 1224</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> select_related_descend(f, restricted, requested, select_mask):</div>
<div class="line"><span class="lineno"> 1225</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 1226</span>            related_select_mask = select_mask.get(f) <span class="keywordflow">or</span> {}</div>
<div class="line"><span class="lineno"> 1227</span>            klass_info = {</div>
<div class="line"><span class="lineno"> 1228</span>                <span class="stringliteral">&quot;model&quot;</span>: f.remote_field.model,</div>
<div class="line"><span class="lineno"> 1229</span>                <span class="stringliteral">&quot;field&quot;</span>: f,</div>
<div class="line"><span class="lineno"> 1230</span>                <span class="stringliteral">&quot;reverse&quot;</span>: <span class="keyword">False</span>,</div>
<div class="line"><span class="lineno"> 1231</span>                <span class="stringliteral">&quot;local_setter&quot;</span>: f.set_cached_value,</div>
<div class="line"><span class="lineno"> 1232</span>                <span class="stringliteral">&quot;remote_setter&quot;</span>: (</div>
<div class="line"><span class="lineno"> 1233</span>                    f.remote_field.set_cached_value <span class="keywordflow">if</span> f.unique <span class="keywordflow">else</span> <span class="keyword">lambda</span> x, y: <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 1234</span>                ),</div>
<div class="line"><span class="lineno"> 1235</span>                <span class="stringliteral">&quot;from_parent&quot;</span>: <span class="keyword">False</span>,</div>
<div class="line"><span class="lineno"> 1236</span>            }</div>
<div class="line"><span class="lineno"> 1237</span>            related_klass_infos.append(klass_info)</div>
<div class="line"><span class="lineno"> 1238</span>            select_fields = []</div>
<div class="line"><span class="lineno"> 1239</span>            _, _, _, joins, _, _ = self.query.setup_joins([f.name], opts, root_alias)</div>
<div class="line"><span class="lineno"> 1240</span>            alias = joins[-1]</div>
<div class="line"><span class="lineno"> 1241</span>            columns = self.get_default_columns(</div>
<div class="line"><span class="lineno"> 1242</span>                related_select_mask, start_alias=alias, opts=f.remote_field.model._meta</div>
<div class="line"><span class="lineno"> 1243</span>            )</div>
<div class="line"><span class="lineno"> 1244</span>            <span class="keywordflow">for</span> col <span class="keywordflow">in</span> columns:</div>
<div class="line"><span class="lineno"> 1245</span>                select_fields.append(len(select))</div>
<div class="line"><span class="lineno"> 1246</span>                select.append((col, <span class="keywordtype">None</span>))</div>
<div class="line"><span class="lineno"> 1247</span>            klass_info[<span class="stringliteral">&quot;select_fields&quot;</span>] = select_fields</div>
<div class="line"><span class="lineno"> 1248</span>            next_klass_infos = self.get_related_selections(</div>
<div class="line"><span class="lineno"> 1249</span>                select,</div>
<div class="line"><span class="lineno"> 1250</span>                related_select_mask,</div>
<div class="line"><span class="lineno"> 1251</span>                f.remote_field.model._meta,</div>
<div class="line"><span class="lineno"> 1252</span>                alias,</div>
<div class="line"><span class="lineno"> 1253</span>                cur_depth + 1,</div>
<div class="line"><span class="lineno"> 1254</span>                next,</div>
<div class="line"><span class="lineno"> 1255</span>                restricted,</div>
<div class="line"><span class="lineno"> 1256</span>            )</div>
<div class="line"><span class="lineno"> 1257</span>            get_related_klass_infos(klass_info, next_klass_infos)</div>
<div class="line"><span class="lineno"> 1258</span> </div>
<div class="line"><span class="lineno"> 1259</span>        <span class="keywordflow">if</span> restricted:</div>
<div class="line"><span class="lineno"> 1260</span>            related_fields = [</div>
<div class="line"><span class="lineno"> 1261</span>                (o, o.field, o.related_model)</div>
<div class="line"><span class="lineno"> 1262</span>                <span class="keywordflow">for</span> o <span class="keywordflow">in</span> opts.related_objects</div>
<div class="line"><span class="lineno"> 1263</span>                <span class="keywordflow">if</span> o.field.unique <span class="keywordflow">and</span> <span class="keywordflow">not</span> o.many_to_many</div>
<div class="line"><span class="lineno"> 1264</span>            ]</div>
<div class="line"><span class="lineno"> 1265</span>            <span class="keywordflow">for</span> related_object, related_field, model <span class="keywordflow">in</span> related_fields:</div>
<div class="line"><span class="lineno"> 1266</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> select_related_descend(</div>
<div class="line"><span class="lineno"> 1267</span>                    related_object,</div>
<div class="line"><span class="lineno"> 1268</span>                    restricted,</div>
<div class="line"><span class="lineno"> 1269</span>                    requested,</div>
<div class="line"><span class="lineno"> 1270</span>                    select_mask,</div>
<div class="line"><span class="lineno"> 1271</span>                ):</div>
<div class="line"><span class="lineno"> 1272</span>                    <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 1273</span> </div>
<div class="line"><span class="lineno"> 1274</span>                related_select_mask = select_mask.get(related_object) <span class="keywordflow">or</span> {}</div>
<div class="line"><span class="lineno"> 1275</span>                related_field_name = related_field.related_query_name()</div>
<div class="line"><span class="lineno"> 1276</span>                fields_found.add(related_field_name)</div>
<div class="line"><span class="lineno"> 1277</span> </div>
<div class="line"><span class="lineno"> 1278</span>                join_info = self.query.setup_joins(</div>
<div class="line"><span class="lineno"> 1279</span>                    [related_field_name], opts, root_alias</div>
<div class="line"><span class="lineno"> 1280</span>                )</div>
<div class="line"><span class="lineno"> 1281</span>                alias = join_info.joins[-1]</div>
<div class="line"><span class="lineno"> 1282</span>                from_parent = issubclass(model, opts.model) <span class="keywordflow">and</span> model <span class="keywordflow">is</span> <span class="keywordflow">not</span> opts.model</div>
<div class="line"><span class="lineno"> 1283</span>                klass_info = {</div>
<div class="line"><span class="lineno"> 1284</span>                    <span class="stringliteral">&quot;model&quot;</span>: model,</div>
<div class="line"><span class="lineno"> 1285</span>                    <span class="stringliteral">&quot;field&quot;</span>: related_field,</div>
<div class="line"><span class="lineno"> 1286</span>                    <span class="stringliteral">&quot;reverse&quot;</span>: <span class="keyword">True</span>,</div>
<div class="line"><span class="lineno"> 1287</span>                    <span class="stringliteral">&quot;local_setter&quot;</span>: related_object.set_cached_value,</div>
<div class="line"><span class="lineno"> 1288</span>                    <span class="stringliteral">&quot;remote_setter&quot;</span>: related_field.set_cached_value,</div>
<div class="line"><span class="lineno"> 1289</span>                    <span class="stringliteral">&quot;from_parent&quot;</span>: from_parent,</div>
<div class="line"><span class="lineno"> 1290</span>                }</div>
<div class="line"><span class="lineno"> 1291</span>                related_klass_infos.append(klass_info)</div>
<div class="line"><span class="lineno"> 1292</span>                select_fields = []</div>
<div class="line"><span class="lineno"> 1293</span>                columns = self.get_default_columns(</div>
<div class="line"><span class="lineno"> 1294</span>                    related_select_mask,</div>
<div class="line"><span class="lineno"> 1295</span>                    start_alias=alias,</div>
<div class="line"><span class="lineno"> 1296</span>                    opts=model._meta,</div>
<div class="line"><span class="lineno"> 1297</span>                    from_parent=opts.model,</div>
<div class="line"><span class="lineno"> 1298</span>                )</div>
<div class="line"><span class="lineno"> 1299</span>                <span class="keywordflow">for</span> col <span class="keywordflow">in</span> columns:</div>
<div class="line"><span class="lineno"> 1300</span>                    select_fields.append(len(select))</div>
<div class="line"><span class="lineno"> 1301</span>                    select.append((col, <span class="keywordtype">None</span>))</div>
<div class="line"><span class="lineno"> 1302</span>                klass_info[<span class="stringliteral">&quot;select_fields&quot;</span>] = select_fields</div>
<div class="line"><span class="lineno"> 1303</span>                next = requested.get(related_field_name, {})</div>
<div class="line"><span class="lineno"> 1304</span>                next_klass_infos = self.get_related_selections(</div>
<div class="line"><span class="lineno"> 1305</span>                    select,</div>
<div class="line"><span class="lineno"> 1306</span>                    related_select_mask,</div>
<div class="line"><span class="lineno"> 1307</span>                    model._meta,</div>
<div class="line"><span class="lineno"> 1308</span>                    alias,</div>
<div class="line"><span class="lineno"> 1309</span>                    cur_depth + 1,</div>
<div class="line"><span class="lineno"> 1310</span>                    next,</div>
<div class="line"><span class="lineno"> 1311</span>                    restricted,</div>
<div class="line"><span class="lineno"> 1312</span>                )</div>
<div class="line"><span class="lineno"> 1313</span>                get_related_klass_infos(klass_info, next_klass_infos)</div>
<div class="line"><span class="lineno"> 1314</span> </div>
<div class="line"><span class="lineno"> 1315</span>            <span class="keyword">def </span>local_setter(final_field, obj, from_obj):</div>
<div class="line"><span class="lineno"> 1316</span>                <span class="comment"># Set a reverse fk object when relation is non-empty.</span></div>
<div class="line"><span class="lineno"> 1317</span>                <span class="keywordflow">if</span> from_obj:</div>
<div class="line"><span class="lineno"> 1318</span>                    final_field.remote_field.set_cached_value(from_obj, obj)</div>
<div class="line"><span class="lineno"> 1319</span> </div>
<div class="line"><span class="lineno"> 1320</span>            <span class="keyword">def </span>local_setter_noop(obj, from_obj):</div>
<div class="line"><span class="lineno"> 1321</span>                <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno"> 1322</span> </div>
<div class="line"><span class="lineno"> 1323</span>            <span class="keyword">def </span>remote_setter(name, obj, from_obj):</div>
<div class="line"><span class="lineno"> 1324</span>                setattr(from_obj, name, obj)</div>
<div class="line"><span class="lineno"> 1325</span> </div>
<div class="line"><span class="lineno"> 1326</span>            <span class="keywordflow">for</span> name <span class="keywordflow">in</span> list(requested):</div>
<div class="line"><span class="lineno"> 1327</span>                <span class="comment"># Filtered relations work only on the topmost level.</span></div>
<div class="line"><span class="lineno"> 1328</span>                <span class="keywordflow">if</span> cur_depth &gt; 1:</div>
<div class="line"><span class="lineno"> 1329</span>                    <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno"> 1330</span>                <span class="keywordflow">if</span> name <span class="keywordflow">in</span> self.query._filtered_relations:</div>
<div class="line"><span class="lineno"> 1331</span>                    fields_found.add(name)</div>
<div class="line"><span class="lineno"> 1332</span>                    final_field, _, join_opts, joins, _, _ = self.query.setup_joins(</div>
<div class="line"><span class="lineno"> 1333</span>                        [name], opts, root_alias</div>
<div class="line"><span class="lineno"> 1334</span>                    )</div>
<div class="line"><span class="lineno"> 1335</span>                    model = join_opts.model</div>
<div class="line"><span class="lineno"> 1336</span>                    alias = joins[-1]</div>
<div class="line"><span class="lineno"> 1337</span>                    from_parent = (</div>
<div class="line"><span class="lineno"> 1338</span>                        issubclass(model, opts.model) <span class="keywordflow">and</span> model <span class="keywordflow">is</span> <span class="keywordflow">not</span> opts.model</div>
<div class="line"><span class="lineno"> 1339</span>                    )</div>
<div class="line"><span class="lineno"> 1340</span>                    klass_info = {</div>
<div class="line"><span class="lineno"> 1341</span>                        <span class="stringliteral">&quot;model&quot;</span>: model,</div>
<div class="line"><span class="lineno"> 1342</span>                        <span class="stringliteral">&quot;field&quot;</span>: final_field,</div>
<div class="line"><span class="lineno"> 1343</span>                        <span class="stringliteral">&quot;reverse&quot;</span>: <span class="keyword">True</span>,</div>
<div class="line"><span class="lineno"> 1344</span>                        <span class="stringliteral">&quot;local_setter&quot;</span>: (</div>
<div class="line"><span class="lineno"> 1345</span>                            partial(local_setter, final_field)</div>
<div class="line"><span class="lineno"> 1346</span>                            <span class="keywordflow">if</span> len(joins) &lt;= 2</div>
<div class="line"><span class="lineno"> 1347</span>                            <span class="keywordflow">else</span> local_setter_noop</div>
<div class="line"><span class="lineno"> 1348</span>                        ),</div>
<div class="line"><span class="lineno"> 1349</span>                        <span class="stringliteral">&quot;remote_setter&quot;</span>: partial(remote_setter, name),</div>
<div class="line"><span class="lineno"> 1350</span>                        <span class="stringliteral">&quot;from_parent&quot;</span>: from_parent,</div>
<div class="line"><span class="lineno"> 1351</span>                    }</div>
<div class="line"><span class="lineno"> 1352</span>                    related_klass_infos.append(klass_info)</div>
<div class="line"><span class="lineno"> 1353</span>                    select_fields = []</div>
<div class="line"><span class="lineno"> 1354</span>                    field_select_mask = select_mask.get((name, final_field)) <span class="keywordflow">or</span> {}</div>
<div class="line"><span class="lineno"> 1355</span>                    columns = self.get_default_columns(</div>
<div class="line"><span class="lineno"> 1356</span>                        field_select_mask,</div>
<div class="line"><span class="lineno"> 1357</span>                        start_alias=alias,</div>
<div class="line"><span class="lineno"> 1358</span>                        opts=model._meta,</div>
<div class="line"><span class="lineno"> 1359</span>                        from_parent=opts.model,</div>
<div class="line"><span class="lineno"> 1360</span>                    )</div>
<div class="line"><span class="lineno"> 1361</span>                    <span class="keywordflow">for</span> col <span class="keywordflow">in</span> columns:</div>
<div class="line"><span class="lineno"> 1362</span>                        select_fields.append(len(select))</div>
<div class="line"><span class="lineno"> 1363</span>                        select.append((col, <span class="keywordtype">None</span>))</div>
<div class="line"><span class="lineno"> 1364</span>                    klass_info[<span class="stringliteral">&quot;select_fields&quot;</span>] = select_fields</div>
<div class="line"><span class="lineno"> 1365</span>                    next_requested = requested.get(name, {})</div>
<div class="line"><span class="lineno"> 1366</span>                    next_klass_infos = self.get_related_selections(</div>
<div class="line"><span class="lineno"> 1367</span>                        select,</div>
<div class="line"><span class="lineno"> 1368</span>                        field_select_mask,</div>
<div class="line"><span class="lineno"> 1369</span>                        opts=model._meta,</div>
<div class="line"><span class="lineno"> 1370</span>                        root_alias=alias,</div>
<div class="line"><span class="lineno"> 1371</span>                        cur_depth=cur_depth + 1,</div>
<div class="line"><span class="lineno"> 1372</span>                        requested=next_requested,</div>
<div class="line"><span class="lineno"> 1373</span>                        restricted=restricted,</div>
<div class="line"><span class="lineno"> 1374</span>                    )</div>
<div class="line"><span class="lineno"> 1375</span>                    get_related_klass_infos(klass_info, next_klass_infos)</div>
<div class="line"><span class="lineno"> 1376</span>            fields_not_found = set(requested).difference(fields_found)</div>
<div class="line"><span class="lineno"> 1377</span>            <span class="keywordflow">if</span> fields_not_found:</div>
<div class="line"><span class="lineno"> 1378</span>                invalid_fields = (<span class="stringliteral">&quot;&#39;%s&#39;&quot;</span> % s <span class="keywordflow">for</span> s <span class="keywordflow">in</span> fields_not_found)</div>
<div class="line"><span class="lineno"> 1379</span>                <span class="keywordflow">raise</span> FieldError(</div>
<div class="line"><span class="lineno"> 1380</span>                    <span class="stringliteral">&quot;Invalid field name(s) given in select_related: %s. &quot;</span></div>
<div class="line"><span class="lineno"> 1381</span>                    <span class="stringliteral">&quot;Choices are: %s&quot;</span></div>
<div class="line"><span class="lineno"> 1382</span>                    % (</div>
<div class="line"><span class="lineno"> 1383</span>                        <span class="stringliteral">&quot;, &quot;</span>.join(invalid_fields),</div>
<div class="line"><span class="lineno"> 1384</span>                        <span class="stringliteral">&quot;, &quot;</span>.join(_get_field_choices()) <span class="keywordflow">or</span> <span class="stringliteral">&quot;(none)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1385</span>                    )</div>
<div class="line"><span class="lineno"> 1386</span>                )</div>
<div class="line"><span class="lineno"> 1387</span>        <span class="keywordflow">return</span> related_klass_infos</div>
<div class="line"><span class="lineno"> 1388</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l00965">get_default_columns()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01165">get_related_selections()</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01165">get_related_selections()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00229">get_select()</a>.</p>

</div>
</div>
<a id="ae45920438395e09bd0e2211c58a50e04" name="ae45920438395e09bd0e2211c58a50e04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae45920438395e09bd0e2211c58a50e04">&#9670;&#160;</a></span>get_select()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_select </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>with_col_aliases</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return three values:
- a list of 3-tuples of (expression, (sql, params), alias)
- a klass_info structure,
- a dictionary of annotations

The (sql, params) is what the expression will produce, and alias is the
"AS alias" for the column (possibly None).

The klass_info structure contains the following information:
- The base model of the query.
- Which columns for that model are present in the query (by
  position of the select clause).
- related_klass_infos: [f, klass_info] to descent into

The annotations is a dictionary of {'attname': column position} values.
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00229">229</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  229</span>    <span class="keyword">def </span>get_select(self, with_col_aliases=False):</div>
<div class="line"><span class="lineno">  230</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  231</span><span class="stringliteral">        Return three values:</span></div>
<div class="line"><span class="lineno">  232</span><span class="stringliteral">        - a list of 3-tuples of (expression, (sql, params), alias)</span></div>
<div class="line"><span class="lineno">  233</span><span class="stringliteral">        - a klass_info structure,</span></div>
<div class="line"><span class="lineno">  234</span><span class="stringliteral">        - a dictionary of annotations</span></div>
<div class="line"><span class="lineno">  235</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  236</span><span class="stringliteral">        The (sql, params) is what the expression will produce, and alias is the</span></div>
<div class="line"><span class="lineno">  237</span><span class="stringliteral">        &quot;AS alias&quot; for the column (possibly None).</span></div>
<div class="line"><span class="lineno">  238</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  239</span><span class="stringliteral">        The klass_info structure contains the following information:</span></div>
<div class="line"><span class="lineno">  240</span><span class="stringliteral">        - The base model of the query.</span></div>
<div class="line"><span class="lineno">  241</span><span class="stringliteral">        - Which columns for that model are present in the query (by</span></div>
<div class="line"><span class="lineno">  242</span><span class="stringliteral">          position of the select clause).</span></div>
<div class="line"><span class="lineno">  243</span><span class="stringliteral">        - related_klass_infos: [f, klass_info] to descent into</span></div>
<div class="line"><span class="lineno">  244</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  245</span><span class="stringliteral">        The annotations is a dictionary of {&#39;attname&#39;: column position} values.</span></div>
<div class="line"><span class="lineno">  246</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  247</span>        select = []</div>
<div class="line"><span class="lineno">  248</span>        klass_info = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  249</span>        annotations = {}</div>
<div class="line"><span class="lineno">  250</span>        select_idx = 0</div>
<div class="line"><span class="lineno">  251</span>        <span class="keywordflow">for</span> alias, (sql, params) <span class="keywordflow">in</span> self.query.extra_select.items():</div>
<div class="line"><span class="lineno">  252</span>            annotations[alias] = select_idx</div>
<div class="line"><span class="lineno">  253</span>            select.append((RawSQL(sql, params), alias))</div>
<div class="line"><span class="lineno">  254</span>            select_idx += 1</div>
<div class="line"><span class="lineno">  255</span>        <span class="keyword">assert</span> <span class="keywordflow">not</span> (self.query.select <span class="keywordflow">and</span> self.query.default_cols)</div>
<div class="line"><span class="lineno">  256</span>        select_mask = self.query.get_select_mask()</div>
<div class="line"><span class="lineno">  257</span>        <span class="keywordflow">if</span> self.query.default_cols:</div>
<div class="line"><span class="lineno">  258</span>            cols = self.get_default_columns(select_mask)</div>
<div class="line"><span class="lineno">  259</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  260</span>            <span class="comment"># self.query.select is a special case. These columns never go to</span></div>
<div class="line"><span class="lineno">  261</span>            <span class="comment"># any model.</span></div>
<div class="line"><span class="lineno">  262</span>            cols = self.query.select</div>
<div class="line"><span class="lineno">  263</span>        <span class="keywordflow">if</span> cols:</div>
<div class="line"><span class="lineno">  264</span>            select_list = []</div>
<div class="line"><span class="lineno">  265</span>            <span class="keywordflow">for</span> col <span class="keywordflow">in</span> cols:</div>
<div class="line"><span class="lineno">  266</span>                select_list.append(select_idx)</div>
<div class="line"><span class="lineno">  267</span>                select.append((col, <span class="keywordtype">None</span>))</div>
<div class="line"><span class="lineno">  268</span>                select_idx += 1</div>
<div class="line"><span class="lineno">  269</span>            klass_info = {</div>
<div class="line"><span class="lineno">  270</span>                <span class="stringliteral">&quot;model&quot;</span>: self.query.model,</div>
<div class="line"><span class="lineno">  271</span>                <span class="stringliteral">&quot;select_fields&quot;</span>: select_list,</div>
<div class="line"><span class="lineno">  272</span>            }</div>
<div class="line"><span class="lineno">  273</span>        <span class="keywordflow">for</span> alias, annotation <span class="keywordflow">in</span> self.query.annotation_select.items():</div>
<div class="line"><span class="lineno">  274</span>            annotations[alias] = select_idx</div>
<div class="line"><span class="lineno">  275</span>            select.append((annotation, alias))</div>
<div class="line"><span class="lineno">  276</span>            select_idx += 1</div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span>        <span class="keywordflow">if</span> self.query.select_related:</div>
<div class="line"><span class="lineno">  279</span>            related_klass_infos = self.get_related_selections(select, select_mask)</div>
<div class="line"><span class="lineno">  280</span>            klass_info[<span class="stringliteral">&quot;related_klass_infos&quot;</span>] = related_klass_infos</div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>            <span class="keyword">def </span>get_select_from_parent(klass_info):</div>
<div class="line"><span class="lineno">  283</span>                <span class="keywordflow">for</span> ki <span class="keywordflow">in</span> klass_info[<span class="stringliteral">&quot;related_klass_infos&quot;</span>]:</div>
<div class="line"><span class="lineno">  284</span>                    <span class="keywordflow">if</span> ki[<span class="stringliteral">&quot;from_parent&quot;</span>]:</div>
<div class="line"><span class="lineno">  285</span>                        ki[<span class="stringliteral">&quot;select_fields&quot;</span>] = (</div>
<div class="line"><span class="lineno">  286</span>                            klass_info[<span class="stringliteral">&quot;select_fields&quot;</span>] + ki[<span class="stringliteral">&quot;select_fields&quot;</span>]</div>
<div class="line"><span class="lineno">  287</span>                        )</div>
<div class="line"><span class="lineno">  288</span>                    get_select_from_parent(ki)</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>            get_select_from_parent(klass_info)</div>
<div class="line"><span class="lineno">  291</span> </div>
<div class="line"><span class="lineno">  292</span>        ret = []</div>
<div class="line"><span class="lineno">  293</span>        col_idx = 1</div>
<div class="line"><span class="lineno">  294</span>        <span class="keywordflow">for</span> col, alias <span class="keywordflow">in</span> select:</div>
<div class="line"><span class="lineno">  295</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  296</span>                sql, params = self.compile(col)</div>
<div class="line"><span class="lineno">  297</span>            <span class="keywordflow">except</span> EmptyResultSet:</div>
<div class="line"><span class="lineno">  298</span>                empty_result_set_value = getattr(</div>
<div class="line"><span class="lineno">  299</span>                    col, <span class="stringliteral">&quot;empty_result_set_value&quot;</span>, NotImplemented</div>
<div class="line"><span class="lineno">  300</span>                )</div>
<div class="line"><span class="lineno">  301</span>                <span class="keywordflow">if</span> empty_result_set_value <span class="keywordflow">is</span> NotImplemented:</div>
<div class="line"><span class="lineno">  302</span>                    <span class="comment"># Select a predicate that&#39;s always False.</span></div>
<div class="line"><span class="lineno">  303</span>                    sql, params = <span class="stringliteral">&quot;0&quot;</span>, ()</div>
<div class="line"><span class="lineno">  304</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  305</span>                    sql, params = self.compile(Value(empty_result_set_value))</div>
<div class="line"><span class="lineno">  306</span>            <span class="keywordflow">except</span> FullResultSet:</div>
<div class="line"><span class="lineno">  307</span>                sql, params = self.compile(Value(<span class="keyword">True</span>))</div>
<div class="line"><span class="lineno">  308</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  309</span>                sql, params = col.select_format(self, sql, params)</div>
<div class="line"><span class="lineno">  310</span>            <span class="keywordflow">if</span> alias <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> with_col_aliases:</div>
<div class="line"><span class="lineno">  311</span>                alias = f<span class="stringliteral">&quot;col{col_idx}&quot;</span></div>
<div class="line"><span class="lineno">  312</span>                col_idx += 1</div>
<div class="line"><span class="lineno">  313</span>            ret.append((col, (sql, params), alias))</div>
<div class="line"><span class="lineno">  314</span>        <span class="keywordflow">return</span> ret, klass_info, annotations</div>
<div class="line"><span class="lineno">  315</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00965">get_default_columns()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01165">get_related_selections()</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00070">setup_query()</a>.</p>

</div>
</div>
<a id="acc146258b1413bd96cd04cad1855dd94" name="acc146258b1413bd96cd04cad1855dd94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc146258b1413bd96cd04cad1855dd94">&#9670;&#160;</a></span>get_select_for_update_of_arguments()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.get_select_for_update_of_arguments </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return a quoted list of arguments for the SELECT FOR UPDATE OF part of
the query.
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01389">1389</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1389</span>    <span class="keyword">def </span>get_select_for_update_of_arguments(self):</div>
<div class="line"><span class="lineno"> 1390</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1391</span><span class="stringliteral">        Return a quoted list of arguments for the SELECT FOR UPDATE OF part of</span></div>
<div class="line"><span class="lineno"> 1392</span><span class="stringliteral">        the query.</span></div>
<div class="line"><span class="lineno"> 1393</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1394</span> </div>
<div class="line"><span class="lineno"> 1395</span>        <span class="keyword">def </span>_get_parent_klass_info(klass_info):</div>
<div class="line"><span class="lineno"> 1396</span>            concrete_model = klass_info[<span class="stringliteral">&quot;model&quot;</span>]._meta.concrete_model</div>
<div class="line"><span class="lineno"> 1397</span>            <span class="keywordflow">for</span> parent_model, parent_link <span class="keywordflow">in</span> concrete_model._meta.parents.items():</div>
<div class="line"><span class="lineno"> 1398</span>                all_parents = parent_model._meta.all_parents</div>
<div class="line"><span class="lineno"> 1399</span>                <span class="keywordflow">yield</span> {</div>
<div class="line"><span class="lineno"> 1400</span>                    <span class="stringliteral">&quot;model&quot;</span>: parent_model,</div>
<div class="line"><span class="lineno"> 1401</span>                    <span class="stringliteral">&quot;field&quot;</span>: parent_link,</div>
<div class="line"><span class="lineno"> 1402</span>                    <span class="stringliteral">&quot;reverse&quot;</span>: <span class="keyword">False</span>,</div>
<div class="line"><span class="lineno"> 1403</span>                    <span class="stringliteral">&quot;select_fields&quot;</span>: [</div>
<div class="line"><span class="lineno"> 1404</span>                        select_index</div>
<div class="line"><span class="lineno"> 1405</span>                        <span class="keywordflow">for</span> select_index <span class="keywordflow">in</span> klass_info[<span class="stringliteral">&quot;select_fields&quot;</span>]</div>
<div class="line"><span class="lineno"> 1406</span>                        <span class="comment"># Selected columns from a model or its parents.</span></div>
<div class="line"><span class="lineno"> 1407</span>                        <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno"> 1408</span>                            self.select[select_index][0].target.model == parent_model</div>
<div class="line"><span class="lineno"> 1409</span>                            <span class="keywordflow">or</span> self.select[select_index][0].target.model <span class="keywordflow">in</span> all_parents</div>
<div class="line"><span class="lineno"> 1410</span>                        )</div>
<div class="line"><span class="lineno"> 1411</span>                    ],</div>
<div class="line"><span class="lineno"> 1412</span>                }</div>
<div class="line"><span class="lineno"> 1413</span> </div>
<div class="line"><span class="lineno"> 1414</span>        <span class="keyword">def </span>_get_first_selected_col_from_model(klass_info):</div>
<div class="line"><span class="lineno"> 1415</span>            <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1416</span><span class="stringliteral">            Find the first selected column from a model. If it doesn&#39;t exist,</span></div>
<div class="line"><span class="lineno"> 1417</span><span class="stringliteral">            don&#39;t lock a model.</span></div>
<div class="line"><span class="lineno"> 1418</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno"> 1419</span><span class="stringliteral">            select_fields is filled recursively, so it also contains fields</span></div>
<div class="line"><span class="lineno"> 1420</span><span class="stringliteral">            from the parent models.</span></div>
<div class="line"><span class="lineno"> 1421</span><span class="stringliteral">            &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1422</span>            concrete_model = klass_info[<span class="stringliteral">&quot;model&quot;</span>]._meta.concrete_model</div>
<div class="line"><span class="lineno"> 1423</span>            <span class="keywordflow">for</span> select_index <span class="keywordflow">in</span> klass_info[<span class="stringliteral">&quot;select_fields&quot;</span>]:</div>
<div class="line"><span class="lineno"> 1424</span>                <span class="keywordflow">if</span> self.select[select_index][0].target.model == concrete_model:</div>
<div class="line"><span class="lineno"> 1425</span>                    <span class="keywordflow">return</span> self.select[select_index][0]</div>
<div class="line"><span class="lineno"> 1426</span> </div>
<div class="line"><span class="lineno"> 1427</span>        <span class="keyword">def </span>_get_field_choices():</div>
<div class="line"><span class="lineno"> 1428</span>            <span class="stringliteral">&quot;&quot;&quot;Yield all allowed field paths in breadth-first search order.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1429</span>            queue = collections.deque([(<span class="keywordtype">None</span>, self.klass_info)])</div>
<div class="line"><span class="lineno"> 1430</span>            <span class="keywordflow">while</span> queue:</div>
<div class="line"><span class="lineno"> 1431</span>                parent_path, klass_info = queue.popleft()</div>
<div class="line"><span class="lineno"> 1432</span>                <span class="keywordflow">if</span> parent_path <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 1433</span>                    path = []</div>
<div class="line"><span class="lineno"> 1434</span>                    <span class="keywordflow">yield</span> <span class="stringliteral">&quot;self&quot;</span></div>
<div class="line"><span class="lineno"> 1435</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1436</span>                    field = klass_info[<span class="stringliteral">&quot;field&quot;</span>]</div>
<div class="line"><span class="lineno"> 1437</span>                    <span class="keywordflow">if</span> klass_info[<span class="stringliteral">&quot;reverse&quot;</span>]:</div>
<div class="line"><span class="lineno"> 1438</span>                        field = field.remote_field</div>
<div class="line"><span class="lineno"> 1439</span>                    path = parent_path + [field.name]</div>
<div class="line"><span class="lineno"> 1440</span>                    <span class="keywordflow">yield</span> LOOKUP_SEP.join(path)</div>
<div class="line"><span class="lineno"> 1441</span>                queue.extend(</div>
<div class="line"><span class="lineno"> 1442</span>                    (path, klass_info)</div>
<div class="line"><span class="lineno"> 1443</span>                    <span class="keywordflow">for</span> klass_info <span class="keywordflow">in</span> _get_parent_klass_info(klass_info)</div>
<div class="line"><span class="lineno"> 1444</span>                )</div>
<div class="line"><span class="lineno"> 1445</span>                queue.extend(</div>
<div class="line"><span class="lineno"> 1446</span>                    (path, klass_info)</div>
<div class="line"><span class="lineno"> 1447</span>                    <span class="keywordflow">for</span> klass_info <span class="keywordflow">in</span> klass_info.get(<span class="stringliteral">&quot;related_klass_infos&quot;</span>, [])</div>
<div class="line"><span class="lineno"> 1448</span>                )</div>
<div class="line"><span class="lineno"> 1449</span> </div>
<div class="line"><span class="lineno"> 1450</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.klass_info:</div>
<div class="line"><span class="lineno"> 1451</span>            <span class="keywordflow">return</span> []</div>
<div class="line"><span class="lineno"> 1452</span>        result = []</div>
<div class="line"><span class="lineno"> 1453</span>        invalid_names = []</div>
<div class="line"><span class="lineno"> 1454</span>        <span class="keywordflow">for</span> name <span class="keywordflow">in</span> self.query.select_for_update_of:</div>
<div class="line"><span class="lineno"> 1455</span>            klass_info = self.klass_info</div>
<div class="line"><span class="lineno"> 1456</span>            <span class="keywordflow">if</span> name == <span class="stringliteral">&quot;self&quot;</span>:</div>
<div class="line"><span class="lineno"> 1457</span>                col = _get_first_selected_col_from_model(klass_info)</div>
<div class="line"><span class="lineno"> 1458</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1459</span>                <span class="keywordflow">for</span> part <span class="keywordflow">in</span> name.split(LOOKUP_SEP):</div>
<div class="line"><span class="lineno"> 1460</span>                    klass_infos = (</div>
<div class="line"><span class="lineno"> 1461</span>                        *klass_info.get(<span class="stringliteral">&quot;related_klass_infos&quot;</span>, []),</div>
<div class="line"><span class="lineno"> 1462</span>                        *_get_parent_klass_info(klass_info),</div>
<div class="line"><span class="lineno"> 1463</span>                    )</div>
<div class="line"><span class="lineno"> 1464</span>                    <span class="keywordflow">for</span> related_klass_info <span class="keywordflow">in</span> klass_infos:</div>
<div class="line"><span class="lineno"> 1465</span>                        field = related_klass_info[<span class="stringliteral">&quot;field&quot;</span>]</div>
<div class="line"><span class="lineno"> 1466</span>                        <span class="keywordflow">if</span> related_klass_info[<span class="stringliteral">&quot;reverse&quot;</span>]:</div>
<div class="line"><span class="lineno"> 1467</span>                            field = field.remote_field</div>
<div class="line"><span class="lineno"> 1468</span>                        <span class="keywordflow">if</span> field.name == part:</div>
<div class="line"><span class="lineno"> 1469</span>                            klass_info = related_klass_info</div>
<div class="line"><span class="lineno"> 1470</span>                            <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno"> 1471</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1472</span>                        klass_info = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 1473</span>                        <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno"> 1474</span>                <span class="keywordflow">if</span> klass_info <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 1475</span>                    invalid_names.append(name)</div>
<div class="line"><span class="lineno"> 1476</span>                    <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 1477</span>                col = _get_first_selected_col_from_model(klass_info)</div>
<div class="line"><span class="lineno"> 1478</span>            <span class="keywordflow">if</span> col <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 1479</span>                <span class="keywordflow">if</span> self.connection.features.select_for_update_of_column:</div>
<div class="line"><span class="lineno"> 1480</span>                    result.append(self.compile(col)[0])</div>
<div class="line"><span class="lineno"> 1481</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1482</span>                    result.append(self.quote_name_unless_alias(col.alias))</div>
<div class="line"><span class="lineno"> 1483</span>        <span class="keywordflow">if</span> invalid_names:</div>
<div class="line"><span class="lineno"> 1484</span>            <span class="keywordflow">raise</span> FieldError(</div>
<div class="line"><span class="lineno"> 1485</span>                <span class="stringliteral">&quot;Invalid field name(s) given in select_for_update(of=(...)): %s. &quot;</span></div>
<div class="line"><span class="lineno"> 1486</span>                <span class="stringliteral">&quot;Only relational fields followed in the query are allowed. &quot;</span></div>
<div class="line"><span class="lineno"> 1487</span>                <span class="stringliteral">&quot;Choices are: %s.&quot;</span></div>
<div class="line"><span class="lineno"> 1488</span>                % (</div>
<div class="line"><span class="lineno"> 1489</span>                    <span class="stringliteral">&quot;, &quot;</span>.join(invalid_names),</div>
<div class="line"><span class="lineno"> 1490</span>                    <span class="stringliteral">&quot;, &quot;</span>.join(_get_field_choices()),</div>
<div class="line"><span class="lineno"> 1491</span>                )</div>
<div class="line"><span class="lineno"> 1492</span>            )</div>
<div class="line"><span class="lineno"> 1493</span>        <span class="keywordflow">return</span> result</div>
<div class="line"><span class="lineno"> 1494</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="django_2db_2models_2expressions_8py_source.html#l00803">django.db.models.expressions.DurationExpression.compile()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00060">klass_info</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00530">quote_name_unless_alias()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00020">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00099">django.contrib.gis.db.backends.oracle.operations.OracleOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2postgis_2operations_8py_source.html#l00167">django.contrib.gis.db.backends.postgis.operations.PostGISOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00066">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.select</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00058">select</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>.</p>

</div>
</div>
<a id="a730571b9b54a4d28aed6af579018b5d4" name="a730571b9b54a4d28aed6af579018b5d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a730571b9b54a4d28aed6af579018b5d4">&#9670;&#160;</a></span>has_results()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.has_results </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Backends (e.g. NoSQL) can override this in order to use optimized
versions of "query has any results."
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01537">1537</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1537</span>    <span class="keyword">def </span>has_results(self):</div>
<div class="line"><span class="lineno"> 1538</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1539</span><span class="stringliteral">        Backends (e.g. NoSQL) can override this in order to use optimized</span></div>
<div class="line"><span class="lineno"> 1540</span><span class="stringliteral">        versions of &quot;query has any results.&quot;</span></div>
<div class="line"><span class="lineno"> 1541</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1542</span>        <span class="keywordflow">return</span> bool(self.execute_sql(SINGLE))</div>
<div class="line"><span class="lineno"> 1543</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l01546">execute_sql()</a>.</p>

</div>
</div>
<a id="a1b43e91f203b2db610967351ce6e7d2e" name="a1b43e91f203b2db610967351ce6e7d2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b43e91f203b2db610967351ce6e7d2e">&#9670;&#160;</a></span>pre_sql_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.pre_sql_setup </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>with_col_aliases</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Do any necessary class setup immediately prior to producing SQL. This
is for things that can't necessarily be done in __init__ because we
might not have all the pieces in place at that time.
</pre> 
<p>Reimplemented in <a class="el" href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_update_compiler.html#a1e7a019696efa0aa48fac7a7410fdd28">django.db.models.sql.compiler.SQLUpdateCompiler</a>.</p>

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00078">78</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   78</span>    <span class="keyword">def </span>pre_sql_setup(self, with_col_aliases=False):</div>
<div class="line"><span class="lineno">   79</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   80</span><span class="stringliteral">        Do any necessary class setup immediately prior to producing SQL. This</span></div>
<div class="line"><span class="lineno">   81</span><span class="stringliteral">        is for things that can&#39;t necessarily be done in __init__ because we</span></div>
<div class="line"><span class="lineno">   82</span><span class="stringliteral">        might not have all the pieces in place at that time.</span></div>
<div class="line"><span class="lineno">   83</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   84</span>        self.setup_query(with_col_aliases=with_col_aliases)</div>
<div class="line"><span class="lineno">   85</span>        order_by = self.get_order_by()</div>
<div class="line"><span class="lineno">   86</span>        self.where, self.having, self.qualify = self.query.where.split_having_qualify(</div>
<div class="line"><span class="lineno">   87</span>            must_group_by=self.query.group_by <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   88</span>        )</div>
<div class="line"><span class="lineno">   89</span>        extra_select = self.get_extra_select(order_by, self.select)</div>
<div class="line"><span class="lineno">   90</span>        self.has_extra_select = bool(extra_select)</div>
<div class="line"><span class="lineno">   91</span>        group_by = self.get_group_by(self.select + extra_select, order_by)</div>
<div class="line"><span class="lineno">   92</span>        <span class="keywordflow">return</span> extra_select, order_by, group_by</div>
<div class="line"><span class="lineno">   93</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l00459">get_order_by()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00070">setup_query()</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01932">django.db.models.sql.compiler.SQLUpdateCompiler.as_sql()</a>.</p>

</div>
</div>
<a id="aee1ca8fa1097490d7dde9458af2087a2" name="aee1ca8fa1097490d7dde9458af2087a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee1ca8fa1097490d7dde9458af2087a2">&#9670;&#160;</a></span>quote_name_unless_alias()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.quote_name_unless_alias </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>name</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">A wrapper around connection.ops.quote_name that doesn't quote aliases
for table names. This avoids problems with some SQL dialects that treat
quoted strings specially (e.g. PostgreSQL).
</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00530">530</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  530</span>    <span class="keyword">def </span>quote_name_unless_alias(self, name):</div>
<div class="line"><span class="lineno">  531</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  532</span><span class="stringliteral">        A wrapper around connection.ops.quote_name that doesn&#39;t quote aliases</span></div>
<div class="line"><span class="lineno">  533</span><span class="stringliteral">        for table names. This avoids problems with some SQL dialects that treat</span></div>
<div class="line"><span class="lineno">  534</span><span class="stringliteral">        quoted strings specially (e.g. PostgreSQL).</span></div>
<div class="line"><span class="lineno">  535</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  536</span>        <span class="keywordflow">if</span> name <span class="keywordflow">in</span> self.quote_cache:</div>
<div class="line"><span class="lineno">  537</span>            <span class="keywordflow">return</span> self.quote_cache[name]</div>
<div class="line"><span class="lineno">  538</span>        <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  539</span>            (name <span class="keywordflow">in</span> self.query.alias_map <span class="keywordflow">and</span> name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.query.table_map)</div>
<div class="line"><span class="lineno">  540</span>            <span class="keywordflow">or</span> name <span class="keywordflow">in</span> self.query.extra_select</div>
<div class="line"><span class="lineno">  541</span>            <span class="keywordflow">or</span> (</div>
<div class="line"><span class="lineno">  542</span>                self.query.external_aliases.get(name)</div>
<div class="line"><span class="lineno">  543</span>                <span class="keywordflow">and</span> name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.query.table_map</div>
<div class="line"><span class="lineno">  544</span>            )</div>
<div class="line"><span class="lineno">  545</span>        ):</div>
<div class="line"><span class="lineno">  546</span>            self.quote_cache[name] = name</div>
<div class="line"><span class="lineno">  547</span>            <span class="keywordflow">return</span> name</div>
<div class="line"><span class="lineno">  548</span>        r = self.connection.ops.quote_name(name)</div>
<div class="line"><span class="lineno">  549</span>        self.quote_cache[name] = r</div>
<div class="line"><span class="lineno">  550</span>        <span class="keywordflow">return</span> r</div>
<div class="line"><span class="lineno">  551</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00190">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2mysql_2operations_8py_source.html#l00114">django.contrib.gis.db.backends.mysql.operations.MySQLOperations.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00183">django.contrib.gis.db.backends.oracle.operations.OracleOperations.connection</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2postgis_2base_8py_source.html#l00123">django.contrib.gis.db.backends.postgis.base.DatabaseWrapper.connection</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00134">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.connection</a>, <a class="el" href="smtp_8py_source.html#l00052">django.core.mail.backends.smtp.EmailBackend.connection</a>, <a class="el" href="django_2core_2mail_2message_8py_source.html#l00252">django.core.mail.message.EmailMessage.connection</a>, <a class="el" href="django_2db_2backends_2base_2base_8py_source.html#l00056">django.db.backends.base.base.BaseDatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2base_2client_8py_source.html#l00014">django.db.backends.base.client.BaseDatabaseClient.connection</a>, <a class="el" href="base_2creation_8py_source.html#l00024">django.db.backends.base.creation.BaseDatabaseCreation.connection</a>, <a class="el" href="django_2db_2backends_2base_2features_8py_source.html#l00393">django.db.backends.base.features.BaseDatabaseFeatures.connection</a>, <a class="el" href="db_2backends_2base_2introspection_8py_source.html#l00020">django.db.backends.base.introspection.BaseDatabaseIntrospection.connection</a>, <a class="el" href="db_2backends_2base_2operations_8py_source.html#l00062">django.db.backends.base.operations.BaseDatabaseOperations.connection</a>, <a class="el" href="db_2backends_2base_2schema_8py_source.html#l00149">django.db.backends.base.schema.BaseDatabaseSchemaEditor.connection</a>, <a class="el" href="base_2validation_8py_source.html#l00005">django.db.backends.base.validation.BaseDatabaseValidation.connection</a>, <a class="el" href="django_2db_2backends_2oracle_2base_8py_source.html#l00305">django.db.backends.oracle.base.DatabaseWrapper.connection</a>, <a class="el" href="django_2db_2backends_2postgresql_2base_8py_source.html#l00349">django.db.backends.postgresql.base.DatabaseWrapper.connection</a>, <a class="el" href="db_2backends_2postgresql_2operations_8py_source.html#l00076">django.db.backends.postgresql.operations.DatabaseOperations.connection</a>, <a class="el" href="db_2backends_2postgresql_2schema_8py_source.html#l00070">django.db.backends.postgresql.schema.DatabaseSchemaEditor.connection</a>, <a class="el" href="executor_8py_source.html#l00017">django.db.migrations.executor.MigrationExecutor.connection</a>, <a class="el" href="django_2db_2migrations_2loader_8py_source.html#l00052">django.db.migrations.loader.MigrationLoader.connection</a>, <a class="el" href="recorder_8py_source.html#l00049">django.db.migrations.recorder.MigrationRecorder.connection</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">connection</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00053">quote_cache</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01898">django.db.models.sql.compiler.SQLDeleteCompiler._as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00316">_order_by_pairs()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00026">django.db.backends.mysql.compiler.SQLDeleteCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01932">django.db.models.sql.compiler.SQLUpdateCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01119">get_from_clause()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01389">get_select_for_update_of_arguments()</a>.</p>

</div>
</div>
<a id="ae75172de9cb1885c3c8e9842460ee1a6" name="ae75172de9cb1885c3c8e9842460ee1a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae75172de9cb1885c3c8e9842460ee1a6">&#9670;&#160;</a></span>results_iter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.results_iter </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>results</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>tuple_expected</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>chunked_fetch</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>chunk_size</em></span><span class="paramdefsep"> = </span><span class="paramdefval">GET_ITERATOR_CHUNK_SIZE</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return an iterator over the results from executing this query.</pre> 
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l01516">1516</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1522</span>    ):</div>
<div class="line"><span class="lineno"> 1523</span>        <span class="stringliteral">&quot;&quot;&quot;Return an iterator over the results from executing this query.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 1524</span>        <span class="keywordflow">if</span> results <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 1525</span>            results = self.execute_sql(</div>
<div class="line"><span class="lineno"> 1526</span>                MULTI, chunked_fetch=chunked_fetch, chunk_size=chunk_size</div>
<div class="line"><span class="lineno"> 1527</span>            )</div>
<div class="line"><span class="lineno"> 1528</span>        fields = [s[0] <span class="keywordflow">for</span> s <span class="keywordflow">in</span> self.select[0 : self.col_count]]</div>
<div class="line"><span class="lineno"> 1529</span>        converters = self.get_converters(fields)</div>
<div class="line"><span class="lineno"> 1530</span>        rows = chain.from_iterable(results)</div>
<div class="line"><span class="lineno"> 1531</span>        <span class="keywordflow">if</span> converters:</div>
<div class="line"><span class="lineno"> 1532</span>            rows = self.apply_converters(rows, converters)</div>
<div class="line"><span class="lineno"> 1533</span>            <span class="keywordflow">if</span> tuple_expected:</div>
<div class="line"><span class="lineno"> 1534</span>                rows = map(tuple, rows)</div>
<div class="line"><span class="lineno"> 1535</span>        <span class="keywordflow">return</span> rows</div>
<div class="line"><span class="lineno"> 1536</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l01505">apply_converters()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00076">col_count</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01546">execute_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01495">get_converters()</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00020">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00099">django.contrib.gis.db.backends.oracle.operations.OracleOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2postgis_2operations_8py_source.html#l00167">django.contrib.gis.db.backends.postgis.operations.PostGISOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00066">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.select</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00058">select</a>.</p>

</div>
</div>
<a id="ab8a6cc3fb92bdd9c50431c79734ae9ca" name="ab8a6cc3fb92bdd9c50431c79734ae9ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8a6cc3fb92bdd9c50431c79734ae9ca">&#9670;&#160;</a></span>setup_query()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.setup_query </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>with_col_aliases</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00070">70</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   70</span>    <span class="keyword">def </span>setup_query(self, with_col_aliases=False):</div>
<div class="line"><span class="lineno">   71</span>        <span class="keywordflow">if</span> all(self.query.alias_refcount[a] == 0 <span class="keywordflow">for</span> a <span class="keywordflow">in</span> self.query.alias_map):</div>
<div class="line"><span class="lineno">   72</span>            self.query.get_initial_alias()</div>
<div class="line"><span class="lineno">   73</span>        self.select, self.klass_info, self.annotation_col_map = self.get_select(</div>
<div class="line"><span class="lineno">   74</span>            with_col_aliases=with_col_aliases,</div>
<div class="line"><span class="lineno">   75</span>        )</div>
<div class="line"><span class="lineno">   76</span>        self.col_count = len(self.select)</div>
<div class="line"><span class="lineno">   77</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="models_2sql_2compiler_8py_source.html#l00059">annotation_col_map</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00229">get_select()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00060">klass_info</a>, <a class="el" href="django_2contrib_2admin_2views_2main_8py_source.html#l00113">django.contrib.admin.views.main.ChangeList.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01746">django.db.models.expressions.Exists.query</a>, <a class="el" href="django_2db_2models_2expressions_8py_source.html#l01699">django.db.models.expressions.Subquery.query</a>, <a class="el" href="query_8py_source.html#l02061">django.db.models.query.RawQuerySet.query</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">query</a>, <a class="el" href="contrib_2gis_2db_2backends_2base_2operations_8py_source.html#l00020">django.contrib.gis.db.backends.base.operations.BaseSpatialOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2oracle_2operations_8py_source.html#l00099">django.contrib.gis.db.backends.oracle.operations.OracleOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2postgis_2operations_8py_source.html#l00167">django.contrib.gis.db.backends.postgis.operations.PostGISOperations.select</a>, <a class="el" href="contrib_2gis_2db_2backends_2spatialite_2operations_8py_source.html#l00066">django.contrib.gis.db.backends.spatialite.operations.SpatiaLiteOperations.select</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00058">select</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00078">pre_sql_setup()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a69f3df8bbdbbc7ede376f161a6705975" name="a69f3df8bbdbbc7ede376f161a6705975"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69f3df8bbdbbc7ede376f161a6705975">&#9670;&#160;</a></span>_meta_ordering</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler._meta_ordering = None</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00061">61</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00316">_order_by_pairs()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00094">get_group_by()</a>.</p>

</div>
</div>
<a id="aed00a9e6e1ed1364231a5fc4adb08962" name="aed00a9e6e1ed1364231a5fc4adb08962"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed00a9e6e1ed1364231a5fc4adb08962">&#9670;&#160;</a></span>annotation_col_map</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.annotation_col_map = None</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00059">59</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00070">setup_query()</a>.</p>

</div>
</div>
<a id="aa2eb6e33fdbd088980f3ff08a95498f0" name="aa2eb6e33fdbd088980f3ff08a95498f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2eb6e33fdbd088980f3ff08a95498f0">&#9670;&#160;</a></span>col_count</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.col_count = len(self.select)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00076">76</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01546">execute_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l01522">results_iter()</a>.</p>

</div>
</div>
<a id="a89cb97382b1f2aeeb9df5689e1743d6d" name="a89cb97382b1f2aeeb9df5689e1743d6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89cb97382b1f2aeeb9df5689e1743d6d">&#9670;&#160;</a></span>connection</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.connection = connection</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00048">48</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="_e_n_v_2_lib_2site-packages_2django_2test_2utils_8py_source.html#l00725">django.test.utils.CaptureQueriesContext.__exit__()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00106">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.__getattr__()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00316">_order_by_pairs()</a>, <a class="el" href="urllib3_2contrib_2pyopenssl_8py_source.html#l00378">urllib3.contrib.pyopenssl.WrappedSocket._real_close()</a>, <a class="el" href="pip_2__vendor_2urllib3_2contrib_2pyopenssl_8py_source.html#l00351">pip._vendor.urllib3.contrib.pyopenssl.WrappedSocket._send_until_done()</a>, <a class="el" href="urllib3_2contrib_2pyopenssl_8py_source.html#l00350">urllib3.contrib.pyopenssl.WrappedSocket._send_until_done()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01505">apply_converters()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01906">django.db.models.sql.compiler.SQLDeleteCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01745">django.db.models.sql.compiler.SQLInsertCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01932">django.db.models.sql.compiler.SQLUpdateCompiler.as_sql()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00007">django.db.backends.mysql.compiler.SQLCompiler.as_subquery_condition()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01610">as_subquery_condition()</a>, <a class="el" href="pip_2__vendor_2urllib3_2contrib_2pyopenssl_8py_source.html#l00374">pip._vendor.urllib3.contrib.pyopenssl.WrappedSocket.close()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00197">collapse_group_by()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00552">compile()</a>, <a class="el" href="testcases_8py_source.html#l00288">django.test.testcases.SimpleTestCase.ensure_connection_patch_method()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01546">execute_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01825">django.db.models.sql.compiler.SQLInsertCompiler.execute_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01640">django.db.models.sql.compiler.SQLInsertCompiler.field_as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00560">get_combinator_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01495">get_converters()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01013">get_distinct()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00094">get_group_by()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01389">get_select_for_update_of_arguments()</a>, <a class="el" href="pip_2__vendor_2urllib3_2contrib_2pyopenssl_8py_source.html#l00384">pip._vendor.urllib3.contrib.pyopenssl.WrappedSocket.getpeercert()</a>, <a class="el" href="urllib3_2contrib_2pyopenssl_8py_source.html#l00386">urllib3.contrib.pyopenssl.WrappedSocket.getpeercert()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l02017">django.db.models.sql.compiler.SQLUpdateCompiler.pre_sql_setup()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01672">django.db.models.sql.compiler.SQLInsertCompiler.prepare_value()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00530">quote_name_unless_alias()</a>, <a class="el" href="pip_2__vendor_2urllib3_2contrib_2pyopenssl_8py_source.html#l00300">pip._vendor.urllib3.contrib.pyopenssl.WrappedSocket.recv()</a>, <a class="el" href="urllib3_2contrib_2pyopenssl_8py_source.html#l00299">urllib3.contrib.pyopenssl.WrappedSocket.recv()</a>, <a class="el" href="pip_2__vendor_2urllib3_2contrib_2pyopenssl_8py_source.html#l00325">pip._vendor.urllib3.contrib.pyopenssl.WrappedSocket.recv_into()</a>, <a class="el" href="urllib3_2contrib_2pyopenssl_8py_source.html#l00324">urllib3.contrib.pyopenssl.WrappedSocket.recv_into()</a>, <a class="el" href="urllib3_2contrib_2pyopenssl_8py_source.html#l00403">urllib3.contrib.pyopenssl.WrappedSocket.selected_alpn_protocol()</a>, <a class="el" href="utils_2log_8py_source.html#l00137">django.utils.log.AdminEmailHandler.send_mail()</a>, <a class="el" href="pip_2__vendor_2urllib3_2contrib_2pyopenssl_8py_source.html#l00370">pip._vendor.urllib3.contrib.pyopenssl.WrappedSocket.shutdown()</a>, <a class="el" href="urllib3_2contrib_2pyopenssl_8py_source.html#l00369">urllib3.contrib.pyopenssl.WrappedSocket.shutdown()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2spatialite_2features_8py_source.html#l00013">django.contrib.gis.db.backends.spatialite.features.DatabaseFeatures.supports_area_geodetic()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00062">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_bbcontains_lookup()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00091">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_collect_aggr()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00066">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_contained_lookup()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00070">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_crosses_lookup()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00078">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_dwithin_lookup()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00095">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_extent_aggr()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2mysql_2features_8py_source.html#l00019">django.contrib.gis.db.backends.mysql.features.DatabaseFeatures.supports_geometry_field_unique_index()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00099">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_make_line_aggr()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00082">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_relate_lookup()</a>, <a class="el" href="django_2contrib_2gis_2db_2backends_2base_2features_8py_source.html#l00103">django.contrib.gis.db.backends.base.features.BaseSpatialFeatures.supports_union_aggr()</a>, <a class="el" href="pip_2__vendor_2urllib3_2contrib_2pyopenssl_8py_source.html#l00398">pip._vendor.urllib3.contrib.pyopenssl.WrappedSocket.version()</a>, and <a class="el" href="urllib3_2contrib_2pyopenssl_8py_source.html#l00400">urllib3.contrib.pyopenssl.WrappedSocket.version()</a>.</p>

</div>
</div>
<a id="a5d64266303ab2403b147d4c4928c6b73" name="a5d64266303ab2403b147d4c4928c6b73"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d64266303ab2403b147d4c4928c6b73">&#9670;&#160;</a></span>elide_empty</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.elide_empty = elide_empty</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00052">52</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00560">get_combinator_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>.</p>

</div>
</div>
<a id="aacc8cc950543aa605e45e4a0c3d7ff0b" name="aacc8cc950543aa605e45e4a0c3d7ff0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacc8cc950543aa605e45e4a0c3d7ff0b">&#9670;&#160;</a></span>has_extra_select</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.has_extra_select = bool(extra_select)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00090">90</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01546">execute_sql()</a>.</p>

</div>
</div>
<a id="a592d23e45a13ff9617aeee95a5fde16f" name="a592d23e45a13ff9617aeee95a5fde16f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a592d23e45a13ff9617aeee95a5fde16f">&#9670;&#160;</a></span>having</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.having</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">86</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00094">get_group_by()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>.</p>

</div>
</div>
<a id="a8c0bd8f7b828e9ea5e5bc7ff43ed2b0e" name="a8c0bd8f7b828e9ea5e5bc7ff43ed2b0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c0bd8f7b828e9ea5e5bc7ff43ed2b0e">&#9670;&#160;</a></span>klass_info</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.klass_info = None</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00060">60</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l01389">get_select_for_update_of_arguments()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00070">setup_query()</a>.</p>

</div>
</div>
<a id="acb6143d6d626f4ee09f3abcf8ed43a52" name="acb6143d6d626f4ee09f3abcf8ed43a52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb6143d6d626f4ee09f3abcf8ed43a52">&#9670;&#160;</a></span>ordering_parts</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.ordering_parts</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=  _lazy_re_compile(</div>
<div class="line">        <span class="stringliteral">r&quot;^(.*)\s(?:ASC|DESC).*&quot;</span>,</div>
<div class="line">        re.MULTILINE | re.DOTALL,</div>
<div class="line">    )</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00041">41</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00520">get_extra_select()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00459">get_order_by()</a>.</p>

</div>
</div>
<a id="a0bdcdd7f91079ec8c23746fc41ad9189" name="a0bdcdd7f91079ec8c23746fc41ad9189"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bdcdd7f91079ec8c23746fc41ad9189">&#9670;&#160;</a></span>qualify</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.qualify</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=  self.query.where.split_having_qualify(</div>
<div class="line">            must_group_by=self.query.group_by <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line">        )</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">86</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>.</p>

</div>
</div>
<a id="a46a3cece6bcd7f5bb21882128edd4cbb" name="a46a3cece6bcd7f5bb21882128edd4cbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46a3cece6bcd7f5bb21882128edd4cbb">&#9670;&#160;</a></span>query</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.query = query</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00047">47</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="query_8py_source.html#l00469">django.db.models.query.QuerySet.__or__()</a>, <a class="el" href="query_8py_source.html#l00488">django.db.models.query.QuerySet.__xor__()</a>, <a class="el" href="query_8py_source.html#l02012">django.db.models.query.QuerySet._check_operator_queryset()</a>, <a class="el" href="query_8py_source.html#l02016">django.db.models.query.QuerySet._check_ordering_first_last_queryset_aggregation()</a>, <a class="el" href="query_8py_source.html#l01907">django.db.models.query.QuerySet._clone()</a>, <a class="el" href="query_8py_source.html#l01520">django.db.models.query.QuerySet._combinator_query()</a>, <a class="el" href="query_8py_source.html#l01486">django.db.models.query.QuerySet._filter_or_exclude()</a>, <a class="el" href="query_8py_source.html#l01983">django.db.models.query.QuerySet._has_filters()</a>, <a class="el" href="query_8py_source.html#l01946">django.db.models.query.QuerySet._merge_sanity_check()</a>, <a class="el" href="query_8py_source.html#l02005">django.db.models.query.QuerySet._not_support_combined_queries()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00316">_order_by_pairs()</a>, <a class="el" href="query_8py_source.html#l01203">django.db.models.query.QuerySet._raw_delete()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01104">_setup_joins()</a>, <a class="el" href="query_8py_source.html#l01264">django.db.models.query.QuerySet._update()</a>, <a class="el" href="query_8py_source.html#l00581">django.db.models.query.QuerySet.aggregate()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00026">django.db.backends.mysql.compiler.SQLDeleteCompiler.as_sql()</a>, <a class="el" href="backends_2mysql_2compiler_8py_source.html#l00056">django.db.backends.mysql.compiler.SQLUpdateCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l02082">django.db.models.sql.compiler.SQLAggregateCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01745">django.db.models.sql.compiler.SQLInsertCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01932">django.db.models.sql.compiler.SQLUpdateCompiler.as_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01610">as_subquery_condition()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01890">django.db.models.sql.compiler.SQLDeleteCompiler.contains_self_reference_subquery()</a>, <a class="el" href="query_8py_source.html#l00609">django.db.models.query.QuerySet.count()</a>, <a class="el" href="query_8py_source.html#l01164">django.db.models.query.QuerySet.delete()</a>, <a class="el" href="query_8py_source.html#l01704">django.db.models.query.QuerySet.distinct()</a>, <a class="el" href="query_8py_source.html#l01070">django.db.models.query.QuerySet.earliest()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01825">django.db.models.sql.compiler.SQLInsertCompiler.execute_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01996">django.db.models.sql.compiler.SQLUpdateCompiler.execute_sql()</a>, <a class="el" href="query_8py_source.html#l01283">django.db.models.query.QuerySet.exists()</a>, <a class="el" href="query_8py_source.html#l01323">django.db.models.query.QuerySet.explain()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01622">explain_query()</a>, <a class="el" href="query_8py_source.html#l01725">django.db.models.query.QuerySet.extra()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01041">find_ordering_name()</a>, <a class="el" href="query_8py_source.html#l00625">django.db.models.query.QuerySet.get()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00560">get_combinator_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00965">get_default_columns()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01013">get_distinct()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00520">get_extra_select()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01119">get_from_clause()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00094">get_group_by()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00459">get_order_by()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01165">get_related_selections()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00229">get_select()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01389">get_select_for_update_of_arguments()</a>, <a class="el" href="query_8py_source.html#l01116">django.db.models.query.QuerySet.in_bulk()</a>, <a class="el" href="query_8py_source.html#l01078">django.db.models.query.QuerySet.latest()</a>, <a class="el" href="query_8py_source.html#l01759">django.db.models.query.QuerySet.only()</a>, <a class="el" href="query_8py_source.html#l01695">django.db.models.query.QuerySet.order_by()</a>, <a class="el" href="query_8py_source.html#l01791">django.db.models.query.QuerySet.ordered()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01701">django.db.models.sql.compiler.SQLInsertCompiler.pre_save_val()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l02017">django.db.models.sql.compiler.SQLUpdateCompiler.pre_sql_setup()</a>, <a class="el" href="query_8py_source.html#l01599">django.db.models.query.QuerySet.prefetch_related()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01672">django.db.models.sql.compiler.SQLInsertCompiler.prepare_value()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00530">quote_name_unless_alias()</a>, <a class="el" href="pip_2__vendor_2urllib3_2util_2url_8py_source.html#l00115">pip._vendor.urllib3.util.url.Url.request_uri()</a>, <a class="el" href="urllib3_2util_2url_8py_source.html#l00122">urllib3.util.url.Url.request_uri()</a>, <a class="el" href="query_8py_source.html#l01965">django.db.models.query.QuerySet.resolve_expression()</a>, <a class="el" href="query_8py_source.html#l01734">django.db.models.query.QuerySet.reverse()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00070">setup_query()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01873">django.db.models.sql.compiler.SQLDeleteCompiler.single_alias()</a>, and <a class="el" href="query_8py_source.html#l01218">django.db.models.query.QuerySet.update()</a>.</p>

</div>
</div>
<a id="a8cf6c5b29a716283d527c8ff66445ea4" name="a8cf6c5b29a716283d527c8ff66445ea4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cf6c5b29a716283d527c8ff66445ea4">&#9670;&#160;</a></span>quote_cache</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">dict django.db.models.sql.compiler.SQLCompiler.quote_cache = {&quot;*&quot;: &quot;*&quot;}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00053">53</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00530">quote_name_unless_alias()</a>.</p>

</div>
</div>
<a id="a8376432a6364ad4e09f274311faae015" name="a8376432a6364ad4e09f274311faae015"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8376432a6364ad4e09f274311faae015">&#9670;&#160;</a></span>select</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.select = None</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00058">58</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="models_2sql_2compiler_8py_source.html#l00316">_order_by_pairs()</a>, <a class="el" href="sql_2query_8py_source.html#l02167">django.db.models.sql.query.Query.add_select_col()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="sql_2query_8py_source.html#l00973">django.db.models.sql.query.Query.change_aliases()</a>, <a class="el" href="sql_2query_8py_source.html#l02150">django.db.models.sql.query.Query.clear_select_clause()</a>, <a class="el" href="sql_2query_8py_source.html#l02158">django.db.models.sql.query.Query.clear_select_fields()</a>, <a class="el" href="sql_2query_8py_source.html#l00445">django.db.models.sql.query.Query.get_aggregation()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00459">get_order_by()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01389">get_select_for_update_of_arguments()</a>, <a class="el" href="sql_2query_8py_source.html#l00321">django.db.models.sql.query.Query.output_field()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01522">results_iter()</a>, <a class="el" href="sql_2query_8py_source.html#l02280">django.db.models.sql.query.Query.set_group_by()</a>, <a class="el" href="sql_2query_8py_source.html#l02171">django.db.models.sql.query.Query.set_select()</a>, and <a class="el" href="models_2sql_2compiler_8py_source.html#l00070">setup_query()</a>.</p>

</div>
</div>
<a id="a348fe92525c8429db7aebc5d026878ad" name="a348fe92525c8429db7aebc5d026878ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a348fe92525c8429db7aebc5d026878ad">&#9670;&#160;</a></span>using</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.using = using</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00049">49</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="transaction_8py_source.html#l00182">django.db.transaction.Atomic.__enter__()</a>, <a class="el" href="transaction_8py_source.html#l00224">django.db.transaction.Atomic.__exit__()</a>, <a class="el" href="sql_2query_8py_source.html#l00170">django.db.models.sql.query.RawQuery.__iter__()</a>, <a class="el" href="sql_2query_8py_source.html#l00196">django.db.models.sql.query.RawQuery._execute_query()</a>, <a class="el" href="query_8py_source.html#l00875">django.db.models.query.QuerySet.bulk_update()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l01996">django.db.models.sql.compiler.SQLUpdateCompiler.execute_sql()</a>, <a class="el" href="sql_2query_8py_source.html#l00164">django.db.models.sql.query.RawQuery.get_columns()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00560">get_combinator_sql()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>, and <a class="el" href="django_2template_2response_8py_source.html#l00069">django.template.response.SimpleTemplateResponse.resolve_template()</a>.</p>

</div>
</div>
<a id="af21b78f80b16870af227f7d4c86bf60d" name="af21b78f80b16870af227f7d4c86bf60d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af21b78f80b16870af227f7d4c86bf60d">&#9670;&#160;</a></span>where</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.sql.compiler.SQLCompiler.where</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="models_2sql_2compiler_8py_source.html#l00086">86</a> of file <a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="sql_2query_8py_source.html#l02329">django.db.models.sql.query.Query.add_extra()</a>, <a class="el" href="sql_2query_8py_source.html#l01595">django.db.models.sql.query.Query.add_q()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00736">as_sql()</a>, <a class="el" href="sql_2query_8py_source.html#l00973">django.db.models.sql.query.Query.change_aliases()</a>, <a class="el" href="sql_2query_8py_source.html#l01617">django.db.models.sql.query.Query.clear_where()</a>, <a class="el" href="sql_2query_8py_source.html#l00375">django.db.models.sql.query.Query.clone()</a>, <a class="el" href="subqueries_8py_source.html#l00026">django.db.models.sql.subqueries.DeleteQuery.delete_batch()</a>, <a class="el" href="sql_2query_8py_source.html#l00445">django.db.models.sql.query.Query.get_aggregation()</a>, <a class="el" href="sql_2query_8py_source.html#l01235">django.db.models.sql.query.Query.get_external_cols()</a>, <a class="el" href="models_2sql_2compiler_8py_source.html#l00640">get_qualify_sql()</a>, <a class="el" href="sql_2query_8py_source.html#l00632">django.db.models.sql.query.Query.has_filters()</a>, <a class="el" href="sql_2query_8py_source.html#l02105">django.db.models.sql.query.Query.is_empty()</a>, <a class="el" href="sql_2query_8py_source.html#l02100">django.db.models.sql.query.Query.set_empty()</a>, and <a class="el" href="sql_2query_8py_source.html#l02536">django.db.models.sql.query.Query.trim_start()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>project/ENV/Lib/site-packages/django/db/models/sql/<a class="el" href="models_2sql_2compiler_8py_source.html">compiler.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacedjango.html">django</a></li><li class="navelem"><a class="el" href="namespacedjango_1_1db.html">db</a></li><li class="navelem"><a class="el" href="namespacedjango_1_1db_1_1models.html">models</a></li><li class="navelem"><a class="el" href="namespacedjango_1_1db_1_1models_1_1sql.html">sql</a></li><li class="navelem"><a class="el" href="namespacedjango_1_1db_1_1models_1_1sql_1_1compiler.html">compiler</a></li><li class="navelem"><a class="el" href="classdjango_1_1db_1_1models_1_1sql_1_1compiler_1_1_s_q_l_compiler.html">SQLCompiler</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
