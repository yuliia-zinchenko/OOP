<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Read&amp;Watch: django.db.models.query Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Read&amp;Watch<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('namespacedjango_1_1db_1_1models_1_1query.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">django.db.models.query Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_base_iterable.html">BaseIterable</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_empty_query_set.html">EmptyQuerySet</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_flat_values_list_iterable.html">FlatValuesListIterable</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_instance_check_meta.html">InstanceCheckMeta</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_model_iterable.html">ModelIterable</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_named_values_list_iterable.html">NamedValuesListIterable</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_prefetch.html">Prefetch</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_query_set.html">QuerySet</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_raw_model_iterable.html">RawModelIterable</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_raw_query_set.html">RawQuerySet</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_related_populator.html">RelatedPopulator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_values_iterable.html">ValuesIterable</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdjango_1_1db_1_1models_1_1query_1_1_values_list_iterable.html">ValuesListIterable</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a07a5d1a7cbe7fb79abc2b9f4dc9ff7a0" id="r_a07a5d1a7cbe7fb79abc2b9f4dc9ff7a0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a07a5d1a7cbe7fb79abc2b9f4dc9ff7a0">normalize_prefetch_lookups</a> (lookups, prefix=None)</td></tr>
<tr class="separator:a07a5d1a7cbe7fb79abc2b9f4dc9ff7a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe275c57f2e3b9c812965ba7a90779a4" id="r_afe275c57f2e3b9c812965ba7a90779a4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe275c57f2e3b9c812965ba7a90779a4">prefetch_related_objects</a> (model_instances, *related_lookups)</td></tr>
<tr class="separator:afe275c57f2e3b9c812965ba7a90779a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa06ab6da35e90b466921b9e5a2b0c263" id="r_aa06ab6da35e90b466921b9e5a2b0c263"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa06ab6da35e90b466921b9e5a2b0c263">aprefetch_related_objects</a> (model_instances, *related_lookups)</td></tr>
<tr class="separator:aa06ab6da35e90b466921b9e5a2b0c263"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafde37236cb6c0ca8dcaee6d8b5656c0" id="r_aafde37236cb6c0ca8dcaee6d8b5656c0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aafde37236cb6c0ca8dcaee6d8b5656c0">get_prefetcher</a> (instance, through_attr, to_attr)</td></tr>
<tr class="separator:aafde37236cb6c0ca8dcaee6d8b5656c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb2f29bb510cb6187adf038b22c2f269" id="r_afb2f29bb510cb6187adf038b22c2f269"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afb2f29bb510cb6187adf038b22c2f269">prefetch_one_level</a> (instances, prefetcher, lookup, level)</td></tr>
<tr class="separator:afb2f29bb510cb6187adf038b22c2f269"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8c8f87ea3ee226bb101700308190961" id="r_aa8c8f87ea3ee226bb101700308190961"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa8c8f87ea3ee226bb101700308190961">get_related_populators</a> (klass_info, select, db)</td></tr>
<tr class="separator:aa8c8f87ea3ee226bb101700308190961"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2f163a15a2c223a6feb0c61366a10c7d" id="r_a2f163a15a2c223a6feb0c61366a10c7d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2f163a15a2c223a6feb0c61366a10c7d">MAX_GET_RESULTS</a> = 21</td></tr>
<tr class="separator:a2f163a15a2c223a6feb0c61366a10c7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bf8163b3e3cd7ce4f4932b07da77ac9" id="r_a6bf8163b3e3cd7ce4f4932b07da77ac9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6bf8163b3e3cd7ce4f4932b07da77ac9">REPR_OUTPUT_SIZE</a> = 20</td></tr>
<tr class="separator:a6bf8163b3e3cd7ce4f4932b07da77ac9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">The main QuerySet implementation. This provides the public API for the ORM.
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="aa06ab6da35e90b466921b9e5a2b0c263" name="aa06ab6da35e90b466921b9e5a2b0c263"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa06ab6da35e90b466921b9e5a2b0c263">&#9670;&#160;</a></span>aprefetch_related_objects()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.query.aprefetch_related_objects </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>model_instances</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">*</td>          <td class="paramname"><span class="paramname"><em>related_lookups</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">See prefetch_related_objects().</pre> 
<p class="definition">Definition at line <a class="el" href="query_8py_source.html#l02433">2433</a> of file <a class="el" href="query_8py_source.html">query.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2433</span><span class="keyword">async def </span>aprefetch_related_objects(model_instances, *related_lookups):</div>
<div class="line"><span class="lineno"> 2434</span>    <span class="stringliteral">&quot;&quot;&quot;See prefetch_related_objects().&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 2435</span>    <span class="keywordflow">return</span> await sync_to_async(prefetch_related_objects)(</div>
<div class="line"><span class="lineno"> 2436</span>        model_instances, *related_lookups</div>
<div class="line"><span class="lineno"> 2437</span>    )</div>
<div class="line"><span class="lineno"> 2438</span> </div>
<div class="line"><span class="lineno"> 2439</span> </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="query_8py_source.html#l00545">django.db.models.query.QuerySet.aiterator()</a>.</p>

</div>
</div>
<a id="aafde37236cb6c0ca8dcaee6d8b5656c0" name="aafde37236cb6c0ca8dcaee6d8b5656c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafde37236cb6c0ca8dcaee6d8b5656c0">&#9670;&#160;</a></span>get_prefetcher()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.query.get_prefetcher </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>instance</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>through_attr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>to_attr</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">For the attribute 'through_attr' on the given instance, find
an object that has a get_prefetch_querysets().
Return a 4 tuple containing:
(the object with get_prefetch_querysets (or None),
 the descriptor object representing this relationship (or None),
 a boolean that is False if the attribute was not found at all,
 a function that takes an instance and returns a boolean that is True if
 the attribute has already been fetched for that instance)
</pre> 
<p class="definition">Definition at line <a class="el" href="query_8py_source.html#l02440">2440</a> of file <a class="el" href="query_8py_source.html">query.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2440</span><span class="keyword">def </span>get_prefetcher(instance, through_attr, to_attr):</div>
<div class="line"><span class="lineno"> 2441</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 2442</span><span class="stringliteral">    For the attribute &#39;through_attr&#39; on the given instance, find</span></div>
<div class="line"><span class="lineno"> 2443</span><span class="stringliteral">    an object that has a get_prefetch_querysets().</span></div>
<div class="line"><span class="lineno"> 2444</span><span class="stringliteral">    Return a 4 tuple containing:</span></div>
<div class="line"><span class="lineno"> 2445</span><span class="stringliteral">    (the object with get_prefetch_querysets (or None),</span></div>
<div class="line"><span class="lineno"> 2446</span><span class="stringliteral">     the descriptor object representing this relationship (or None),</span></div>
<div class="line"><span class="lineno"> 2447</span><span class="stringliteral">     a boolean that is False if the attribute was not found at all,</span></div>
<div class="line"><span class="lineno"> 2448</span><span class="stringliteral">     a function that takes an instance and returns a boolean that is True if</span></div>
<div class="line"><span class="lineno"> 2449</span><span class="stringliteral">     the attribute has already been fetched for that instance)</span></div>
<div class="line"><span class="lineno"> 2450</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 2451</span> </div>
<div class="line"><span class="lineno"> 2452</span>    <span class="keyword">def </span>is_to_attr_fetched(model, to_attr):</div>
<div class="line"><span class="lineno"> 2453</span>        <span class="comment"># Special case cached_property instances because hasattr() triggers</span></div>
<div class="line"><span class="lineno"> 2454</span>        <span class="comment"># attribute computation and assignment.</span></div>
<div class="line"><span class="lineno"> 2455</span>        <span class="keywordflow">if</span> isinstance(getattr(model, to_attr, <span class="keywordtype">None</span>), cached_property):</div>
<div class="line"><span class="lineno"> 2456</span> </div>
<div class="line"><span class="lineno"> 2457</span>            <span class="keyword">def </span>has_cached_property(instance):</div>
<div class="line"><span class="lineno"> 2458</span>                <span class="keywordflow">return</span> to_attr <span class="keywordflow">in</span> instance.__dict__</div>
<div class="line"><span class="lineno"> 2459</span> </div>
<div class="line"><span class="lineno"> 2460</span>            <span class="keywordflow">return</span> has_cached_property</div>
<div class="line"><span class="lineno"> 2461</span> </div>
<div class="line"><span class="lineno"> 2462</span>        <span class="keyword">def </span>has_to_attr_attribute(instance):</div>
<div class="line"><span class="lineno"> 2463</span>            <span class="keywordflow">return</span> hasattr(instance, to_attr)</div>
<div class="line"><span class="lineno"> 2464</span> </div>
<div class="line"><span class="lineno"> 2465</span>        <span class="keywordflow">return</span> has_to_attr_attribute</div>
<div class="line"><span class="lineno"> 2466</span> </div>
<div class="line"><span class="lineno"> 2467</span>    prefetcher = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 2468</span>    is_fetched = is_to_attr_fetched(instance.__class__, to_attr)</div>
<div class="line"><span class="lineno"> 2469</span> </div>
<div class="line"><span class="lineno"> 2470</span>    <span class="comment"># For singly related objects, we have to avoid getting the attribute</span></div>
<div class="line"><span class="lineno"> 2471</span>    <span class="comment"># from the object, as this will trigger the query. So we first try</span></div>
<div class="line"><span class="lineno"> 2472</span>    <span class="comment"># on the class, in order to get the descriptor object.</span></div>
<div class="line"><span class="lineno"> 2473</span>    rel_obj_descriptor = getattr(instance.__class__, through_attr, <span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno"> 2474</span>    <span class="keywordflow">if</span> rel_obj_descriptor <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 2475</span>        attr_found = hasattr(instance, through_attr)</div>
<div class="line"><span class="lineno"> 2476</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2477</span>        attr_found = <span class="keyword">True</span></div>
<div class="line"><span class="lineno"> 2478</span>        <span class="keywordflow">if</span> rel_obj_descriptor:</div>
<div class="line"><span class="lineno"> 2479</span>            <span class="comment"># singly related object, descriptor object has the</span></div>
<div class="line"><span class="lineno"> 2480</span>            <span class="comment"># get_prefetch_querysets() method.</span></div>
<div class="line"><span class="lineno"> 2481</span>            <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno"> 2482</span>                hasattr(rel_obj_descriptor, <span class="stringliteral">&quot;get_prefetch_querysets&quot;</span>)</div>
<div class="line"><span class="lineno"> 2483</span>                <span class="comment"># RemovedInDjango60Warning.</span></div>
<div class="line"><span class="lineno"> 2484</span>                <span class="keywordflow">or</span> hasattr(rel_obj_descriptor, <span class="stringliteral">&quot;get_prefetch_queryset&quot;</span>)</div>
<div class="line"><span class="lineno"> 2485</span>            ):</div>
<div class="line"><span class="lineno"> 2486</span>                prefetcher = rel_obj_descriptor</div>
<div class="line"><span class="lineno"> 2487</span>                <span class="comment"># If to_attr is set, check if the value has already been set,</span></div>
<div class="line"><span class="lineno"> 2488</span>                <span class="comment"># which is done with has_to_attr_attribute(). Do not use the</span></div>
<div class="line"><span class="lineno"> 2489</span>                <span class="comment"># method from the descriptor, as the cache_name it defines</span></div>
<div class="line"><span class="lineno"> 2490</span>                <span class="comment"># checks the field name, not the to_attr value.</span></div>
<div class="line"><span class="lineno"> 2491</span>                <span class="keywordflow">if</span> through_attr == to_attr:</div>
<div class="line"><span class="lineno"> 2492</span>                    is_fetched = rel_obj_descriptor.is_cached</div>
<div class="line"><span class="lineno"> 2493</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2494</span>                <span class="comment"># descriptor doesn&#39;t support prefetching, so we go ahead and get</span></div>
<div class="line"><span class="lineno"> 2495</span>                <span class="comment"># the attribute on the instance rather than the class to</span></div>
<div class="line"><span class="lineno"> 2496</span>                <span class="comment"># support many related managers</span></div>
<div class="line"><span class="lineno"> 2497</span>                rel_obj = getattr(instance, through_attr)</div>
<div class="line"><span class="lineno"> 2498</span>                <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno"> 2499</span>                    hasattr(rel_obj, <span class="stringliteral">&quot;get_prefetch_querysets&quot;</span>)</div>
<div class="line"><span class="lineno"> 2500</span>                    <span class="comment"># RemovedInDjango60Warning.</span></div>
<div class="line"><span class="lineno"> 2501</span>                    <span class="keywordflow">or</span> hasattr(rel_obj, <span class="stringliteral">&quot;get_prefetch_queryset&quot;</span>)</div>
<div class="line"><span class="lineno"> 2502</span>                ):</div>
<div class="line"><span class="lineno"> 2503</span>                    prefetcher = rel_obj</div>
<div class="line"><span class="lineno"> 2504</span>                <span class="keywordflow">if</span> through_attr == to_attr:</div>
<div class="line"><span class="lineno"> 2505</span> </div>
<div class="line"><span class="lineno"> 2506</span>                    <span class="keyword">def </span>in_prefetched_cache(instance):</div>
<div class="line"><span class="lineno"> 2507</span>                        <span class="keywordflow">return</span> through_attr <span class="keywordflow">in</span> instance._prefetched_objects_cache</div>
<div class="line"><span class="lineno"> 2508</span> </div>
<div class="line"><span class="lineno"> 2509</span>                    is_fetched = in_prefetched_cache</div>
<div class="line"><span class="lineno"> 2510</span>    <span class="keywordflow">return</span> prefetcher, rel_obj_descriptor, attr_found, is_fetched</div>
<div class="line"><span class="lineno"> 2511</span> </div>
<div class="line"><span class="lineno"> 2512</span> </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="query_8py_source.html#l02279">prefetch_related_objects()</a>.</p>

</div>
</div>
<a id="aa8c8f87ea3ee226bb101700308190961" name="aa8c8f87ea3ee226bb101700308190961"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8c8f87ea3ee226bb101700308190961">&#9670;&#160;</a></span>get_related_populators()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.query.get_related_populators </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>klass_info</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>select</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>db</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="query_8py_source.html#l02726">2726</a> of file <a class="el" href="query_8py_source.html">query.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2726</span><span class="keyword">def </span>get_related_populators(klass_info, select, db):</div>
<div class="line"><span class="lineno"> 2727</span>    iterators = []</div>
<div class="line"><span class="lineno"> 2728</span>    related_klass_infos = klass_info.get(<span class="stringliteral">&quot;related_klass_infos&quot;</span>, [])</div>
<div class="line"><span class="lineno"> 2729</span>    <span class="keywordflow">for</span> rel_klass_info <span class="keywordflow">in</span> related_klass_infos:</div>
<div class="line"><span class="lineno"> 2730</span>        rel_cls = RelatedPopulator(rel_klass_info, select, db)</div>
<div class="line"><span class="lineno"> 2731</span>        iterators.append(rel_cls)</div>
<div class="line"><span class="lineno"> 2732</span>    <span class="keywordflow">return</span> iterators</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="query_8py_source.html#l00085">django.db.models.query.ModelIterable.__iter__()</a>.</p>

</div>
</div>
<a id="a07a5d1a7cbe7fb79abc2b9f4dc9ff7a0" name="a07a5d1a7cbe7fb79abc2b9f4dc9ff7a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07a5d1a7cbe7fb79abc2b9f4dc9ff7a0">&#9670;&#160;</a></span>normalize_prefetch_lookups()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.query.normalize_prefetch_lookups </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>lookups</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>prefix</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Normalize lookups into Prefetch objects.</pre> 
<p class="definition">Definition at line <a class="el" href="query_8py_source.html#l02267">2267</a> of file <a class="el" href="query_8py_source.html">query.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2267</span><span class="keyword">def </span>normalize_prefetch_lookups(lookups, prefix=None):</div>
<div class="line"><span class="lineno"> 2268</span>    <span class="stringliteral">&quot;&quot;&quot;Normalize lookups into Prefetch objects.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 2269</span>    ret = []</div>
<div class="line"><span class="lineno"> 2270</span>    <span class="keywordflow">for</span> lookup <span class="keywordflow">in</span> lookups:</div>
<div class="line"><span class="lineno"> 2271</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(lookup, Prefetch):</div>
<div class="line"><span class="lineno"> 2272</span>            lookup = Prefetch(lookup)</div>
<div class="line"><span class="lineno"> 2273</span>        <span class="keywordflow">if</span> prefix:</div>
<div class="line"><span class="lineno"> 2274</span>            lookup.add_prefix(prefix)</div>
<div class="line"><span class="lineno"> 2275</span>        ret.append(lookup)</div>
<div class="line"><span class="lineno"> 2276</span>    <span class="keywordflow">return</span> ret</div>
<div class="line"><span class="lineno"> 2277</span> </div>
<div class="line"><span class="lineno"> 2278</span> </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="query_8py_source.html#l02279">prefetch_related_objects()</a>.</p>

</div>
</div>
<a id="afb2f29bb510cb6187adf038b22c2f269" name="afb2f29bb510cb6187adf038b22c2f269"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb2f29bb510cb6187adf038b22c2f269">&#9670;&#160;</a></span>prefetch_one_level()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.query.prefetch_one_level </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>instances</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>prefetcher</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>lookup</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>level</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Helper function for prefetch_related_objects().

Run prefetches on all instances using the prefetcher object,
assigning results to relevant caches in instance.

Return the prefetched objects along with any additional prefetches that
must be done due to prefetch_related lookups found from default managers.
</pre> 
<p class="definition">Definition at line <a class="el" href="query_8py_source.html#l02513">2513</a> of file <a class="el" href="query_8py_source.html">query.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2513</span><span class="keyword">def </span>prefetch_one_level(instances, prefetcher, lookup, level):</div>
<div class="line"><span class="lineno"> 2514</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 2515</span><span class="stringliteral">    Helper function for prefetch_related_objects().</span></div>
<div class="line"><span class="lineno"> 2516</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno"> 2517</span><span class="stringliteral">    Run prefetches on all instances using the prefetcher object,</span></div>
<div class="line"><span class="lineno"> 2518</span><span class="stringliteral">    assigning results to relevant caches in instance.</span></div>
<div class="line"><span class="lineno"> 2519</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno"> 2520</span><span class="stringliteral">    Return the prefetched objects along with any additional prefetches that</span></div>
<div class="line"><span class="lineno"> 2521</span><span class="stringliteral">    must be done due to prefetch_related lookups found from default managers.</span></div>
<div class="line"><span class="lineno"> 2522</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 2523</span>    <span class="comment"># prefetcher must have a method get_prefetch_querysets() which takes a list</span></div>
<div class="line"><span class="lineno"> 2524</span>    <span class="comment"># of instances, and returns a tuple:</span></div>
<div class="line"><span class="lineno"> 2525</span> </div>
<div class="line"><span class="lineno"> 2526</span>    <span class="comment"># (queryset of instances of self.model that are related to passed in instances,</span></div>
<div class="line"><span class="lineno"> 2527</span>    <span class="comment">#  callable that gets value to be matched for returned instances,</span></div>
<div class="line"><span class="lineno"> 2528</span>    <span class="comment">#  callable that gets value to be matched for passed in instances,</span></div>
<div class="line"><span class="lineno"> 2529</span>    <span class="comment">#  boolean that is True for singly related objects,</span></div>
<div class="line"><span class="lineno"> 2530</span>    <span class="comment">#  cache or field name to assign to,</span></div>
<div class="line"><span class="lineno"> 2531</span>    <span class="comment">#  boolean that is True when the previous argument is a cache name vs a field name).</span></div>
<div class="line"><span class="lineno"> 2532</span> </div>
<div class="line"><span class="lineno"> 2533</span>    <span class="comment"># The &#39;values to be matched&#39; must be hashable as they will be used</span></div>
<div class="line"><span class="lineno"> 2534</span>    <span class="comment"># in a dictionary.</span></div>
<div class="line"><span class="lineno"> 2535</span> </div>
<div class="line"><span class="lineno"> 2536</span>    <span class="keywordflow">if</span> hasattr(prefetcher, <span class="stringliteral">&quot;get_prefetch_querysets&quot;</span>):</div>
<div class="line"><span class="lineno"> 2537</span>        (</div>
<div class="line"><span class="lineno"> 2538</span>            rel_qs,</div>
<div class="line"><span class="lineno"> 2539</span>            rel_obj_attr,</div>
<div class="line"><span class="lineno"> 2540</span>            instance_attr,</div>
<div class="line"><span class="lineno"> 2541</span>            single,</div>
<div class="line"><span class="lineno"> 2542</span>            cache_name,</div>
<div class="line"><span class="lineno"> 2543</span>            is_descriptor,</div>
<div class="line"><span class="lineno"> 2544</span>        ) = prefetcher.get_prefetch_querysets(</div>
<div class="line"><span class="lineno"> 2545</span>            instances, lookup.get_current_querysets(level)</div>
<div class="line"><span class="lineno"> 2546</span>        )</div>
<div class="line"><span class="lineno"> 2547</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2548</span>        warnings.warn(</div>
<div class="line"><span class="lineno"> 2549</span>            <span class="stringliteral">&quot;The usage of get_prefetch_queryset() in prefetch_related_objects() is &quot;</span></div>
<div class="line"><span class="lineno"> 2550</span>            <span class="stringliteral">&quot;deprecated. Implement get_prefetch_querysets() instead.&quot;</span>,</div>
<div class="line"><span class="lineno"> 2551</span>            RemovedInDjango60Warning,</div>
<div class="line"><span class="lineno"> 2552</span>            stacklevel=2,</div>
<div class="line"><span class="lineno"> 2553</span>        )</div>
<div class="line"><span class="lineno"> 2554</span>        queryset = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 2555</span>        <span class="keywordflow">if</span> querysets := lookup.get_current_querysets(level):</div>
<div class="line"><span class="lineno"> 2556</span>            queryset = querysets[0]</div>
<div class="line"><span class="lineno"> 2557</span>        (</div>
<div class="line"><span class="lineno"> 2558</span>            rel_qs,</div>
<div class="line"><span class="lineno"> 2559</span>            rel_obj_attr,</div>
<div class="line"><span class="lineno"> 2560</span>            instance_attr,</div>
<div class="line"><span class="lineno"> 2561</span>            single,</div>
<div class="line"><span class="lineno"> 2562</span>            cache_name,</div>
<div class="line"><span class="lineno"> 2563</span>            is_descriptor,</div>
<div class="line"><span class="lineno"> 2564</span>        ) = prefetcher.get_prefetch_queryset(instances, queryset)</div>
<div class="line"><span class="lineno"> 2565</span>    <span class="comment"># We have to handle the possibility that the QuerySet we just got back</span></div>
<div class="line"><span class="lineno"> 2566</span>    <span class="comment"># contains some prefetch_related lookups. We don&#39;t want to trigger the</span></div>
<div class="line"><span class="lineno"> 2567</span>    <span class="comment"># prefetch_related functionality by evaluating the query. Rather, we need</span></div>
<div class="line"><span class="lineno"> 2568</span>    <span class="comment"># to merge in the prefetch_related lookups.</span></div>
<div class="line"><span class="lineno"> 2569</span>    <span class="comment"># Copy the lookups in case it is a Prefetch object which could be reused</span></div>
<div class="line"><span class="lineno"> 2570</span>    <span class="comment"># later (happens in nested prefetch_related).</span></div>
<div class="line"><span class="lineno"> 2571</span>    additional_lookups = [</div>
<div class="line"><span class="lineno"> 2572</span>        copy.copy(additional_lookup)</div>
<div class="line"><span class="lineno"> 2573</span>        <span class="keywordflow">for</span> additional_lookup <span class="keywordflow">in</span> getattr(rel_qs, <span class="stringliteral">&quot;_prefetch_related_lookups&quot;</span>, ())</div>
<div class="line"><span class="lineno"> 2574</span>    ]</div>
<div class="line"><span class="lineno"> 2575</span>    <span class="keywordflow">if</span> additional_lookups:</div>
<div class="line"><span class="lineno"> 2576</span>        <span class="comment"># Don&#39;t need to clone because the manager should have given us a fresh</span></div>
<div class="line"><span class="lineno"> 2577</span>        <span class="comment"># instance, so we access an internal instead of using public interface</span></div>
<div class="line"><span class="lineno"> 2578</span>        <span class="comment"># for performance reasons.</span></div>
<div class="line"><span class="lineno"> 2579</span>        rel_qs._prefetch_related_lookups = ()</div>
<div class="line"><span class="lineno"> 2580</span> </div>
<div class="line"><span class="lineno"> 2581</span>    all_related_objects = list(rel_qs)</div>
<div class="line"><span class="lineno"> 2582</span> </div>
<div class="line"><span class="lineno"> 2583</span>    rel_obj_cache = {}</div>
<div class="line"><span class="lineno"> 2584</span>    <span class="keywordflow">for</span> rel_obj <span class="keywordflow">in</span> all_related_objects:</div>
<div class="line"><span class="lineno"> 2585</span>        rel_attr_val = rel_obj_attr(rel_obj)</div>
<div class="line"><span class="lineno"> 2586</span>        rel_obj_cache.setdefault(rel_attr_val, []).append(rel_obj)</div>
<div class="line"><span class="lineno"> 2587</span> </div>
<div class="line"><span class="lineno"> 2588</span>    to_attr, as_attr = lookup.get_current_to_attr(level)</div>
<div class="line"><span class="lineno"> 2589</span>    <span class="comment"># Make sure `to_attr` does not conflict with a field.</span></div>
<div class="line"><span class="lineno"> 2590</span>    <span class="keywordflow">if</span> as_attr <span class="keywordflow">and</span> instances:</div>
<div class="line"><span class="lineno"> 2591</span>        <span class="comment"># We assume that objects retrieved are homogeneous (which is the premise</span></div>
<div class="line"><span class="lineno"> 2592</span>        <span class="comment"># of prefetch_related), so what applies to first object applies to all.</span></div>
<div class="line"><span class="lineno"> 2593</span>        model = instances[0].__class__</div>
<div class="line"><span class="lineno"> 2594</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno"> 2595</span>            model._meta.get_field(to_attr)</div>
<div class="line"><span class="lineno"> 2596</span>        <span class="keywordflow">except</span> exceptions.FieldDoesNotExist:</div>
<div class="line"><span class="lineno"> 2597</span>            <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno"> 2598</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2599</span>            msg = <span class="stringliteral">&quot;to_attr={} conflicts with a field on the {} model.&quot;</span></div>
<div class="line"><span class="lineno"> 2600</span>            <span class="keywordflow">raise</span> ValueError(msg.format(to_attr, model.__name__))</div>
<div class="line"><span class="lineno"> 2601</span> </div>
<div class="line"><span class="lineno"> 2602</span>    <span class="comment"># Whether or not we&#39;re prefetching the last part of the lookup.</span></div>
<div class="line"><span class="lineno"> 2603</span>    leaf = len(lookup.prefetch_through.split(LOOKUP_SEP)) - 1 == level</div>
<div class="line"><span class="lineno"> 2604</span> </div>
<div class="line"><span class="lineno"> 2605</span>    <span class="keywordflow">for</span> obj <span class="keywordflow">in</span> instances:</div>
<div class="line"><span class="lineno"> 2606</span>        instance_attr_val = instance_attr(obj)</div>
<div class="line"><span class="lineno"> 2607</span>        vals = rel_obj_cache.get(instance_attr_val, [])</div>
<div class="line"><span class="lineno"> 2608</span> </div>
<div class="line"><span class="lineno"> 2609</span>        <span class="keywordflow">if</span> single:</div>
<div class="line"><span class="lineno"> 2610</span>            val = vals[0] <span class="keywordflow">if</span> vals <span class="keywordflow">else</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 2611</span>            <span class="keywordflow">if</span> as_attr:</div>
<div class="line"><span class="lineno"> 2612</span>                <span class="comment"># A to_attr has been given for the prefetch.</span></div>
<div class="line"><span class="lineno"> 2613</span>                setattr(obj, to_attr, val)</div>
<div class="line"><span class="lineno"> 2614</span>            <span class="keywordflow">elif</span> is_descriptor:</div>
<div class="line"><span class="lineno"> 2615</span>                <span class="comment"># cache_name points to a field name in obj.</span></div>
<div class="line"><span class="lineno"> 2616</span>                <span class="comment"># This field is a descriptor for a related object.</span></div>
<div class="line"><span class="lineno"> 2617</span>                setattr(obj, cache_name, val)</div>
<div class="line"><span class="lineno"> 2618</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2619</span>                <span class="comment"># No to_attr has been given for this prefetch operation and the</span></div>
<div class="line"><span class="lineno"> 2620</span>                <span class="comment"># cache_name does not point to a descriptor. Store the value of</span></div>
<div class="line"><span class="lineno"> 2621</span>                <span class="comment"># the field in the object&#39;s field cache.</span></div>
<div class="line"><span class="lineno"> 2622</span>                obj._state.fields_cache[cache_name] = val</div>
<div class="line"><span class="lineno"> 2623</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2624</span>            <span class="keywordflow">if</span> as_attr:</div>
<div class="line"><span class="lineno"> 2625</span>                setattr(obj, to_attr, vals)</div>
<div class="line"><span class="lineno"> 2626</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2627</span>                manager = getattr(obj, to_attr)</div>
<div class="line"><span class="lineno"> 2628</span>                <span class="keywordflow">if</span> leaf <span class="keywordflow">and</span> lookup.queryset <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 2629</span>                    qs = manager._apply_rel_filters(lookup.queryset)</div>
<div class="line"><span class="lineno"> 2630</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2631</span>                    qs = manager.get_queryset()</div>
<div class="line"><span class="lineno"> 2632</span>                qs._result_cache = vals</div>
<div class="line"><span class="lineno"> 2633</span>                <span class="comment"># We don&#39;t want the individual qs doing prefetch_related now,</span></div>
<div class="line"><span class="lineno"> 2634</span>                <span class="comment"># since we have merged this into the current work.</span></div>
<div class="line"><span class="lineno"> 2635</span>                qs._prefetch_done = <span class="keyword">True</span></div>
<div class="line"><span class="lineno"> 2636</span>                obj._prefetched_objects_cache[cache_name] = qs</div>
<div class="line"><span class="lineno"> 2637</span>    <span class="keywordflow">return</span> all_related_objects, additional_lookups</div>
<div class="line"><span class="lineno"> 2638</span> </div>
<div class="line"><span class="lineno"> 2639</span> </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="query_8py_source.html#l02279">prefetch_related_objects()</a>.</p>

</div>
</div>
<a id="afe275c57f2e3b9c812965ba7a90779a4" name="afe275c57f2e3b9c812965ba7a90779a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe275c57f2e3b9c812965ba7a90779a4">&#9670;&#160;</a></span>prefetch_related_objects()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">django.db.models.query.prefetch_related_objects </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>model_instances</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">*</td>          <td class="paramname"><span class="paramname"><em>related_lookups</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Populate prefetched object caches for a list of model instances based on
the lookups/Prefetch instances given.
</pre> 
<p class="definition">Definition at line <a class="el" href="query_8py_source.html#l02279">2279</a> of file <a class="el" href="query_8py_source.html">query.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2279</span><span class="keyword">def </span>prefetch_related_objects(model_instances, *related_lookups):</div>
<div class="line"><span class="lineno"> 2280</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 2281</span><span class="stringliteral">    Populate prefetched object caches for a list of model instances based on</span></div>
<div class="line"><span class="lineno"> 2282</span><span class="stringliteral">    the lookups/Prefetch instances given.</span></div>
<div class="line"><span class="lineno"> 2283</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno"> 2284</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> model_instances:</div>
<div class="line"><span class="lineno"> 2285</span>        <span class="keywordflow">return</span>  <span class="comment"># nothing to do</span></div>
<div class="line"><span class="lineno"> 2286</span> </div>
<div class="line"><span class="lineno"> 2287</span>    <span class="comment"># We need to be able to dynamically add to the list of prefetch_related</span></div>
<div class="line"><span class="lineno"> 2288</span>    <span class="comment"># lookups that we look up (see below).  So we need some book keeping to</span></div>
<div class="line"><span class="lineno"> 2289</span>    <span class="comment"># ensure we don&#39;t do duplicate work.</span></div>
<div class="line"><span class="lineno"> 2290</span>    done_queries = {}  <span class="comment"># dictionary of things like &#39;foo__bar&#39;: [results]</span></div>
<div class="line"><span class="lineno"> 2291</span> </div>
<div class="line"><span class="lineno"> 2292</span>    auto_lookups = set()  <span class="comment"># we add to this as we go through.</span></div>
<div class="line"><span class="lineno"> 2293</span>    followed_descriptors = set()  <span class="comment"># recursion protection</span></div>
<div class="line"><span class="lineno"> 2294</span> </div>
<div class="line"><span class="lineno"> 2295</span>    all_lookups = normalize_prefetch_lookups(reversed(related_lookups))</div>
<div class="line"><span class="lineno"> 2296</span>    <span class="keywordflow">while</span> all_lookups:</div>
<div class="line"><span class="lineno"> 2297</span>        lookup = all_lookups.pop()</div>
<div class="line"><span class="lineno"> 2298</span>        <span class="keywordflow">if</span> lookup.prefetch_to <span class="keywordflow">in</span> done_queries:</div>
<div class="line"><span class="lineno"> 2299</span>            <span class="keywordflow">if</span> lookup.queryset <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 2300</span>                <span class="keywordflow">raise</span> ValueError(</div>
<div class="line"><span class="lineno"> 2301</span>                    <span class="stringliteral">&quot;&#39;%s&#39; lookup was already seen with a different queryset. &quot;</span></div>
<div class="line"><span class="lineno"> 2302</span>                    <span class="stringliteral">&quot;You may need to adjust the ordering of your lookups.&quot;</span></div>
<div class="line"><span class="lineno"> 2303</span>                    % lookup.prefetch_to</div>
<div class="line"><span class="lineno"> 2304</span>                )</div>
<div class="line"><span class="lineno"> 2305</span> </div>
<div class="line"><span class="lineno"> 2306</span>            <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 2307</span> </div>
<div class="line"><span class="lineno"> 2308</span>        <span class="comment"># Top level, the list of objects to decorate is the result cache</span></div>
<div class="line"><span class="lineno"> 2309</span>        <span class="comment"># from the primary QuerySet. It won&#39;t be for deeper levels.</span></div>
<div class="line"><span class="lineno"> 2310</span>        obj_list = model_instances</div>
<div class="line"><span class="lineno"> 2311</span> </div>
<div class="line"><span class="lineno"> 2312</span>        through_attrs = lookup.prefetch_through.split(LOOKUP_SEP)</div>
<div class="line"><span class="lineno"> 2313</span>        <span class="keywordflow">for</span> level, through_attr <span class="keywordflow">in</span> enumerate(through_attrs):</div>
<div class="line"><span class="lineno"> 2314</span>            <span class="comment"># Prepare main instances</span></div>
<div class="line"><span class="lineno"> 2315</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> obj_list:</div>
<div class="line"><span class="lineno"> 2316</span>                <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno"> 2317</span> </div>
<div class="line"><span class="lineno"> 2318</span>            prefetch_to = lookup.get_current_prefetch_to(level)</div>
<div class="line"><span class="lineno"> 2319</span>            <span class="keywordflow">if</span> prefetch_to <span class="keywordflow">in</span> done_queries:</div>
<div class="line"><span class="lineno"> 2320</span>                <span class="comment"># Skip any prefetching, and any object preparation</span></div>
<div class="line"><span class="lineno"> 2321</span>                obj_list = done_queries[prefetch_to]</div>
<div class="line"><span class="lineno"> 2322</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 2323</span> </div>
<div class="line"><span class="lineno"> 2324</span>            <span class="comment"># Prepare objects:</span></div>
<div class="line"><span class="lineno"> 2325</span>            good_objects = <span class="keyword">True</span></div>
<div class="line"><span class="lineno"> 2326</span>            <span class="keywordflow">for</span> obj <span class="keywordflow">in</span> obj_list:</div>
<div class="line"><span class="lineno"> 2327</span>                <span class="comment"># Since prefetching can re-use instances, it is possible to have</span></div>
<div class="line"><span class="lineno"> 2328</span>                <span class="comment"># the same instance multiple times in obj_list, so obj might</span></div>
<div class="line"><span class="lineno"> 2329</span>                <span class="comment"># already be prepared.</span></div>
<div class="line"><span class="lineno"> 2330</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(obj, <span class="stringliteral">&quot;_prefetched_objects_cache&quot;</span>):</div>
<div class="line"><span class="lineno"> 2331</span>                    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno"> 2332</span>                        obj._prefetched_objects_cache = {}</div>
<div class="line"><span class="lineno"> 2333</span>                    <span class="keywordflow">except</span> (AttributeError, TypeError):</div>
<div class="line"><span class="lineno"> 2334</span>                        <span class="comment"># Must be an immutable object from</span></div>
<div class="line"><span class="lineno"> 2335</span>                        <span class="comment"># values_list(flat=True), for example (TypeError) or</span></div>
<div class="line"><span class="lineno"> 2336</span>                        <span class="comment"># a QuerySet subclass that isn&#39;t returning Model</span></div>
<div class="line"><span class="lineno"> 2337</span>                        <span class="comment"># instances (AttributeError), either in Django or a 3rd</span></div>
<div class="line"><span class="lineno"> 2338</span>                        <span class="comment"># party. prefetch_related() doesn&#39;t make sense, so quit.</span></div>
<div class="line"><span class="lineno"> 2339</span>                        good_objects = <span class="keyword">False</span></div>
<div class="line"><span class="lineno"> 2340</span>                        <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno"> 2341</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> good_objects:</div>
<div class="line"><span class="lineno"> 2342</span>                <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno"> 2343</span> </div>
<div class="line"><span class="lineno"> 2344</span>            <span class="comment"># Descend down tree</span></div>
<div class="line"><span class="lineno"> 2345</span> </div>
<div class="line"><span class="lineno"> 2346</span>            <span class="comment"># We assume that objects retrieved are homogeneous (which is the premise</span></div>
<div class="line"><span class="lineno"> 2347</span>            <span class="comment"># of prefetch_related), so what applies to first object applies to all.</span></div>
<div class="line"><span class="lineno"> 2348</span>            first_obj = obj_list[0]</div>
<div class="line"><span class="lineno"> 2349</span>            to_attr = lookup.get_current_to_attr(level)[0]</div>
<div class="line"><span class="lineno"> 2350</span>            prefetcher, descriptor, attr_found, is_fetched = get_prefetcher(</div>
<div class="line"><span class="lineno"> 2351</span>                first_obj, through_attr, to_attr</div>
<div class="line"><span class="lineno"> 2352</span>            )</div>
<div class="line"><span class="lineno"> 2353</span> </div>
<div class="line"><span class="lineno"> 2354</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> attr_found:</div>
<div class="line"><span class="lineno"> 2355</span>                <span class="keywordflow">raise</span> AttributeError(</div>
<div class="line"><span class="lineno"> 2356</span>                    <span class="stringliteral">&quot;Cannot find &#39;%s&#39; on %s object, &#39;%s&#39; is an invalid &quot;</span></div>
<div class="line"><span class="lineno"> 2357</span>                    <span class="stringliteral">&quot;parameter to prefetch_related()&quot;</span></div>
<div class="line"><span class="lineno"> 2358</span>                    % (</div>
<div class="line"><span class="lineno"> 2359</span>                        through_attr,</div>
<div class="line"><span class="lineno"> 2360</span>                        first_obj.__class__.__name__,</div>
<div class="line"><span class="lineno"> 2361</span>                        lookup.prefetch_through,</div>
<div class="line"><span class="lineno"> 2362</span>                    )</div>
<div class="line"><span class="lineno"> 2363</span>                )</div>
<div class="line"><span class="lineno"> 2364</span> </div>
<div class="line"><span class="lineno"> 2365</span>            <span class="keywordflow">if</span> level == len(through_attrs) - 1 <span class="keywordflow">and</span> prefetcher <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 2366</span>                <span class="comment"># Last one, this *must* resolve to something that supports</span></div>
<div class="line"><span class="lineno"> 2367</span>                <span class="comment"># prefetching, otherwise there is no point adding it and the</span></div>
<div class="line"><span class="lineno"> 2368</span>                <span class="comment"># developer asking for it has made a mistake.</span></div>
<div class="line"><span class="lineno"> 2369</span>                <span class="keywordflow">raise</span> ValueError(</div>
<div class="line"><span class="lineno"> 2370</span>                    <span class="stringliteral">&quot;&#39;%s&#39; does not resolve to an item that supports &quot;</span></div>
<div class="line"><span class="lineno"> 2371</span>                    <span class="stringliteral">&quot;prefetching - this is an invalid parameter to &quot;</span></div>
<div class="line"><span class="lineno"> 2372</span>                    <span class="stringliteral">&quot;prefetch_related().&quot;</span> % lookup.prefetch_through</div>
<div class="line"><span class="lineno"> 2373</span>                )</div>
<div class="line"><span class="lineno"> 2374</span> </div>
<div class="line"><span class="lineno"> 2375</span>            obj_to_fetch = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 2376</span>            <span class="keywordflow">if</span> prefetcher <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 2377</span>                obj_to_fetch = [obj <span class="keywordflow">for</span> obj <span class="keywordflow">in</span> obj_list <span class="keywordflow">if</span> <span class="keywordflow">not</span> is_fetched(obj)]</div>
<div class="line"><span class="lineno"> 2378</span> </div>
<div class="line"><span class="lineno"> 2379</span>            <span class="keywordflow">if</span> obj_to_fetch:</div>
<div class="line"><span class="lineno"> 2380</span>                obj_list, additional_lookups = prefetch_one_level(</div>
<div class="line"><span class="lineno"> 2381</span>                    obj_to_fetch,</div>
<div class="line"><span class="lineno"> 2382</span>                    prefetcher,</div>
<div class="line"><span class="lineno"> 2383</span>                    lookup,</div>
<div class="line"><span class="lineno"> 2384</span>                    level,</div>
<div class="line"><span class="lineno"> 2385</span>                )</div>
<div class="line"><span class="lineno"> 2386</span>                <span class="comment"># We need to ensure we don&#39;t keep adding lookups from the</span></div>
<div class="line"><span class="lineno"> 2387</span>                <span class="comment"># same relationships to stop infinite recursion. So, if we</span></div>
<div class="line"><span class="lineno"> 2388</span>                <span class="comment"># are already on an automatically added lookup, don&#39;t add</span></div>
<div class="line"><span class="lineno"> 2389</span>                <span class="comment"># the new lookups from relationships we&#39;ve seen already.</span></div>
<div class="line"><span class="lineno"> 2390</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> (</div>
<div class="line"><span class="lineno"> 2391</span>                    prefetch_to <span class="keywordflow">in</span> done_queries</div>
<div class="line"><span class="lineno"> 2392</span>                    <span class="keywordflow">and</span> lookup <span class="keywordflow">in</span> auto_lookups</div>
<div class="line"><span class="lineno"> 2393</span>                    <span class="keywordflow">and</span> descriptor <span class="keywordflow">in</span> followed_descriptors</div>
<div class="line"><span class="lineno"> 2394</span>                ):</div>
<div class="line"><span class="lineno"> 2395</span>                    done_queries[prefetch_to] = obj_list</div>
<div class="line"><span class="lineno"> 2396</span>                    new_lookups = normalize_prefetch_lookups(</div>
<div class="line"><span class="lineno"> 2397</span>                        reversed(additional_lookups), prefetch_to</div>
<div class="line"><span class="lineno"> 2398</span>                    )</div>
<div class="line"><span class="lineno"> 2399</span>                    auto_lookups.update(new_lookups)</div>
<div class="line"><span class="lineno"> 2400</span>                    all_lookups.extend(new_lookups)</div>
<div class="line"><span class="lineno"> 2401</span>                followed_descriptors.add(descriptor)</div>
<div class="line"><span class="lineno"> 2402</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2403</span>                <span class="comment"># Either a singly related object that has already been fetched</span></div>
<div class="line"><span class="lineno"> 2404</span>                <span class="comment"># (e.g. via select_related), or hopefully some other property</span></div>
<div class="line"><span class="lineno"> 2405</span>                <span class="comment"># that doesn&#39;t support prefetching but needs to be traversed.</span></div>
<div class="line"><span class="lineno"> 2406</span> </div>
<div class="line"><span class="lineno"> 2407</span>                <span class="comment"># We replace the current list of parent objects with the list</span></div>
<div class="line"><span class="lineno"> 2408</span>                <span class="comment"># of related objects, filtering out empty or missing values so</span></div>
<div class="line"><span class="lineno"> 2409</span>                <span class="comment"># that we can continue with nullable or reverse relations.</span></div>
<div class="line"><span class="lineno"> 2410</span>                new_obj_list = []</div>
<div class="line"><span class="lineno"> 2411</span>                <span class="keywordflow">for</span> obj <span class="keywordflow">in</span> obj_list:</div>
<div class="line"><span class="lineno"> 2412</span>                    <span class="keywordflow">if</span> through_attr <span class="keywordflow">in</span> getattr(obj, <span class="stringliteral">&quot;_prefetched_objects_cache&quot;</span>, ()):</div>
<div class="line"><span class="lineno"> 2413</span>                        <span class="comment"># If related objects have been prefetched, use the</span></div>
<div class="line"><span class="lineno"> 2414</span>                        <span class="comment"># cache rather than the object&#39;s through_attr.</span></div>
<div class="line"><span class="lineno"> 2415</span>                        new_obj = list(obj._prefetched_objects_cache.get(through_attr))</div>
<div class="line"><span class="lineno"> 2416</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2417</span>                        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno"> 2418</span>                            new_obj = getattr(obj, through_attr)</div>
<div class="line"><span class="lineno"> 2419</span>                        <span class="keywordflow">except</span> exceptions.ObjectDoesNotExist:</div>
<div class="line"><span class="lineno"> 2420</span>                            <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 2421</span>                    <span class="keywordflow">if</span> new_obj <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 2422</span>                        <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno"> 2423</span>                    <span class="comment"># We special-case `list` rather than something more generic</span></div>
<div class="line"><span class="lineno"> 2424</span>                    <span class="comment"># like `Iterable` because we don&#39;t want to accidentally match</span></div>
<div class="line"><span class="lineno"> 2425</span>                    <span class="comment"># user models that define __iter__.</span></div>
<div class="line"><span class="lineno"> 2426</span>                    <span class="keywordflow">if</span> isinstance(new_obj, list):</div>
<div class="line"><span class="lineno"> 2427</span>                        new_obj_list.extend(new_obj)</div>
<div class="line"><span class="lineno"> 2428</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 2429</span>                        new_obj_list.append(new_obj)</div>
<div class="line"><span class="lineno"> 2430</span>                obj_list = new_obj_list</div>
<div class="line"><span class="lineno"> 2431</span> </div>
<div class="line"><span class="lineno"> 2432</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="query_8py_source.html#l02440">get_prefetcher()</a>, <a class="el" href="query_8py_source.html#l02267">normalize_prefetch_lookups()</a>, and <a class="el" href="query_8py_source.html#l02513">prefetch_one_level()</a>.</p>

<p class="reference">Referenced by <a class="el" href="query_8py_source.html#l00511">django.db.models.query.QuerySet._iterator()</a>, <a class="el" href="query_8py_source.html#l01318">django.db.models.query.QuerySet._prefetch_related_objects()</a>, and <a class="el" href="query_8py_source.html#l02094">django.db.models.query.RawQuerySet._prefetch_related_objects()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a2f163a15a2c223a6feb0c61366a10c7d" name="a2f163a15a2c223a6feb0c61366a10c7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f163a15a2c223a6feb0c61366a10c7d">&#9670;&#160;</a></span>MAX_GET_RESULTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int django.db.models.query.MAX_GET_RESULTS = 21</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="query_8py_source.html#l00040">40</a> of file <a class="el" href="query_8py_source.html">query.py</a>.</p>

</div>
</div>
<a id="a6bf8163b3e3cd7ce4f4932b07da77ac9" name="a6bf8163b3e3cd7ce4f4932b07da77ac9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bf8163b3e3cd7ce4f4932b07da77ac9">&#9670;&#160;</a></span>REPR_OUTPUT_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int django.db.models.query.REPR_OUTPUT_SIZE = 20</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="query_8py_source.html#l00043">43</a> of file <a class="el" href="query_8py_source.html">query.py</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacedjango.html">django</a></li><li class="navelem"><a class="el" href="namespacedjango_1_1db.html">db</a></li><li class="navelem"><a class="el" href="namespacedjango_1_1db_1_1models.html">models</a></li><li class="navelem"><a class="el" href="namespacedjango_1_1db_1_1models_1_1query.html">query</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
